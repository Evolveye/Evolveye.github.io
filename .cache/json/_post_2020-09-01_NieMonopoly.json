{"data":{"mdx":{"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"published\": true,\n  \"title\": \"NieMonopoly\",\n  \"author\": \"Paweł Stolarski\",\n  \"date\": \"2020-09-01T00:00:00.000Z\",\n  \"categories\": [\"Gry\", \"Projekty\", \"Sprawozdania\"],\n  \"tags\": [\"cactu\", \"backend\", \"serwer\", \"rust\", \"react\"],\n  \"sneakPeek\": \"\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Aside = makeShortcode(\"Aside\");\nvar Info = makeShortcode(\"Info\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Zanim podejmie si\\u0119 pisania du\\u017Cego projektu w nowopoznanej technologii,\\nwarto jest (moim zdaniem oczywi\\u015Bcie) zrobi\\u0107 uprzednio jaki\\u015B mniejszy tw\\xF3r (\\\"kalkualtor\\\").\"), mdx(\"p\", null, \"W moim przypadku, du\\u017Cym projektem b\\u0119dzie praca in\\u017Cynierska.\\nMa\\u0142ym za\\u015B, podstawowy backend pod tworzenie gry -- w tym przypadku monopoly.\"), mdx(\"h2\", null, \"Za\\u0142ozenia projektu\"), mdx(\"p\", null, \"Skoro gra ta ma pe\\u0142ni\\u0107 dla mnie rol\\u0119 rozgrzewki i wst\\u0119pu do programowania w j\\u0119zyku Rust,\\nto powinna w sobie zawiera\\u0107 r\\xF3\\u017Cne elementy ucz\\u0105ce korzystania z tego jezyka.\\nNie mo\\u017Ce by\\u0107 to projekt zbyt prosty (alby wr\\u0119cz zbyt trywialny biedny kalkulatorze),\\nponiewa\\u017C takowy nie nauczy mnie nic w tematach \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ownership\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"borrowing\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lifetime\"), \", \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"cokolwiek\"), \".\"), mdx(\"p\", null, \"Postanowi\\u0142em wi\\u0119c zrobi\\u0107 sam backend dla gry jak\\u0105 b\\u0119dzie co\\u015B na wz\\xF3r monopoly.\\nFrontent za\\u015B przygotuj\\u0119 z pomoc\\u0105 aplikacji Reacta. Skoro za\\u015B pojawiaj\\u0105 si\\u0119 poj\\u0119cia \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"frontu\"), \" i \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"backu\"), \",\\nto mo\\u017Cna si\\u0119 \\u0142atwo domy\\u015Ble\\u0107, \\u017Ce \\u017Ce projekt b\\u0119dzie wymaga\\u0107 ruchu sieciowego -- ten\\u017Ce r\\xF3wnie\\u017C napisze w Ruscie.\"), mdx(\"p\", null, \"I to w\\u0142a\\u015Bnie na ruchu sieciowym postanwoi\\u0142em tak na prawd\\u0119 pozosta\\u0107.\\nCelem jest nauczy\\u0107 si\\u0119 porusza\\u0107 po nowym j\\u0119zyku. Tworzenie gry zostawi\\u0119 sobie na inn\\u0105 okazj\\u0119.\\nDoprecyzowujac wi\\u0119c -- chc\\u0119 zbudowa\\u0107 prymitywn\\u0105 wersj\\u0119 serwera http+ws, kt\\xF3ry obs\\u0142ugiwa\\u0142by\\npoprawnie reactowe aplikacje, oraz kt\\xF3ry dostarczy obs\\u0142ugi ws podobnej do biblioteki socket.io.\\nJednak dla prostoty przekazu b\\u0119d\\u0119 u\\u017Cywa\\u0107 s\\u0142owa \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gra\"), \".\"), mdx(\"h2\", null, \"Pocz\\u0105tek prac\"), mdx(\"p\", null, \"Zacz\\u0105\\u0107 nale\\u017Cy od przygotowa\\u0144 \\u015Brodowiska pracy. Podej\\u015B\\u0107 mo\\u017Ce by\\u0107 pare.\\nW jednym podej\\u015Bciu, pliki zar\\xF3wno frantu jak i backendu mog\\u0105 by\\u0107 w jednym folderze.\\nW drugim za\\u015B podej\\u015Bciu, mo\\u017Cna te \\u015Brodowiska rozdzieli\\u0107 -- i ja uwa\\u017Cam, \\u017Ce to podejscie jest lepsze.\\nTrzecim, mog\\u0142aby byc hybryda, pliki wsp\\xF3\\u0142dzielone przez serwer i clienta --\\ntakie rozwi\\u0105zanie mog\\u0142oby si\\u0119 sprawdzi\\u0107 w projektach gdzie \\\"zaplecze\\\" by\\u0142oby tworzone w przyk\\u0142adowo Node.js.\"), mdx(\"p\", null, \"Je\\u015Bli prace nad gr\\u0105 by\\u0142yby prowadzone przez 2 zespo\\u0142y, nie powinny one sobie wchodzi\\u0107 w drog\\u0119.\\nStrony clienta i serwera b\\u0119d\\u0105 tworzone z u\\u017Cyciem zupe\\u0142nie r\\xF3\\u017Cnych technologii i r\\xF3\\u017Cnymi\\npodejsciami do zarz\\u0105dzania plikami. Dodatkowo jestem zdania, \\u017Ce backend powinien by\\u0107 dla frontu\\nskryty za warstw\\u0105 abstrakcji i tak na prawd\\u0119 \\u017Cadna ze stron nie powinna musie\\u0107 wiedzie\\u0107 jak budowana jest ta druga.\\nW zwi\\u0105zku z tym root projektu powinien moim zdaniem wygl\\u0105da\\u0107 mniej wi\\u0119cej tak:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"root/\\n |- backend/\\n |- frontend/\\n  ` readme.md\\n\")), mdx(\"p\", null, \"Po utworzeniu takiej struktury, w folderach \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"backend\"), \" i \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"frontend\"), \" u\\u017Cy\\u0142em polece\\u0144 kolejno \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cargo init\"), \" oraz \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npx create-react-app\"), \".\\nPo tej czynno\\u015Bci otrzyma\\u0142em podstawow\\u0105 struktur\\u0119 dla obu \\u015Brodowisk.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"root/\\n |- backend/\\n |   |- src/\\n |   |- target/\\n |   |- .gitignore\\n |   |- Cargo.lock\\n |    ` Cargo.toml\\n |\\n |- frontend/\\n |   |- build/\\n |   |- node_modules/\\n |   |- publix/\\n |   |- src/\\n |   |- .gitignore\\n |   |- package.json\\n |    ` package-lock.json\\n |\\n  ` readme.md\\n\")), mdx(\"p\", null, \"Z tak\\u0105 baz\\u0105 mo\\u017Cna przyst\\u0105pi\\u0107 do pisania kodu. Od czego jednak zacz\\u0105\\u0107?\"), mdx(\"p\", null, \"Tak jak z ka\\u017Cdym projektem -- moje podej\\u015Bcie jest takie, aby budowa\\u0107 go od og\\xF3\\u0142u do szczeg\\xF3\\u0142u.\\nCo w pierwszej kolejno\\u015Bci powinienem mie\\u0107, aby robi\\u0107 cokolwiek wi\\u0119cej?\\nJak projekt zostanie przedstawiony u\\u017Cytkownikowi? Na czym ca\\u0142y projekt b\\u0119dzie si\\u0119 opiera\\u0107?\\nW obecnym scenariuszu, jest to strona internetowa -- to na niej wszystko b\\u0119dzie si\\u0119 opiera\\u0107.\"), mdx(\"p\", null, \"Jednak wpisanie \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm start\"), \" to w zasadzie nic. Aplikacja Reacta sama stworzy serwer i otworzy stron\\u0119 w przeglaarce.\\nAby podej\\u015B\\u0107 do sprawy sensownie, to pliki powinien serwowa\\u0107 samodzielnie napisany serwer. Pliki -- w\\u0142a\\u015Bnie -- jakie.\\nJako, ze projekt opiera sie na Reakcie, to hostowane pliki najpro\\u015Bciej b\\u0119dzie znale\\u017A\\u0107 w folderze \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"frontend/build/\"), \".\\nMaj\\u0105c to na uwadze, zamiast startowa\\u0107 aplikacj\\u0119, lepiej b\\u0119dzie u\\u017Cy\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm build\"), \".\"), mdx(\"p\", null, \"Kolej nadesz\\u0142a na rozwa\\u017Cania nad serwerem. W tym przypadku, backend ma by\\u0107 jednolity -- nie rozbudowwywalny.\\nPisz\\u0105c to mam na my\\u015Bli to, \\u017Ce ma stanowi\\u0107 jeden zwarty produkt. Nie ma by\\u0107 cz\\u0119\\u015Bci\\u0105 czego\\u015B innego. Taki monolit.\\nNie ma pe\\u0142ni\\u0107 rol\\u0119 modu\\u0142u dla innego projektu. Dodatkowo warto zauwa\\u017Cy\\u0107, \\u017Ce serwer b\\u0119dzie pe\\u0142ni\\u0107 funkcj\\u0119 ca\\u0142ej aplikacji.\\nTo serwer wy\\u015Ble plik strony kt\\xF3r\\u0105 zinterpretuje przegladarka, to serwer przechwyci rz\\u0105danie aktualizacji protoko\\u0142u do WebSocket,\\noraz to serwer b\\u0119dzie odbiera\\u0107 i odpowiada\\u0107 na eventy ws.\"), mdx(\"p\", null, \"Czego by nie zrobi\\u0107 po stronie clienta, to serwer b\\u0119dzie tym zarz\\u0105dza\\u0107. Pomys\\u0142 mam wi\\u0119c taki:\\nw pliku \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"main.rs\"), \", (czyli g\\u0142\\xF3wnym pliku backendu) zaciagna\\u0107 2 modu\\u0142y\\n(bo tak wygl\\u0105da do\\u0142\\u0105czanie innych plik\\xF3w, po prsotu s\\u0105 to modu\\u0142y) odpowiedzialne za serwer, oraz za gr\\u0119.\\nOba te modu\\u0142y zintegruje si\\u0119 w \\\"mainie\\\" tworz\\u0105c struktur\\u0119 serwera, przekazuj\\u0105c jej handler zdarze\\u0144 ws gry, oraz w\\u0142\\u0105czaj\\u0105c serwer.\"), mdx(\"p\", null, mdx(\"del\", {\n    parentName: \"p\"\n  }, \"Zdaj\\u0119 sobie spraw\\u0119 z tego, ze du\\u017Co razy u\\u017Cy\\u0142em s\\u0142owa \", mdx(\"inlineCode\", {\n    parentName: \"del\"\n  }, \"serwer\"), \". Na tym jednak nie koniec.\")), mdx(\"p\", null, \"Frontend z kolei ma pe\\u0142ni\\u0107 jedynie funkcje interpretacyjne tego co dosta\\u0142 z serwera.\\nNie mo\\u017Ce by\\u0107 po stronie clienta zawarta \\u017Cadna logika kt\\xF3ra moze wp\\u0142yn\\u0105\\u0107 na serwer.\\nClient powinien m\\xF3c jedynie wysy\\u0142a\\u0107 sygna\\u0142y \\u017Ce podj\\u0105\\u0142 jakie\\u015B dzia\\u0142ania.\"), mdx(Aside, {\n    mdxType: \"Aside\"\n  }, \"Oczywi\\u015Bcie jest to spore uproszczenie. Client co prawda nie powinien wykonywac logiki, kt\\xF3ra wp\\u0142wya\\u0142aby na serwer, lecz powinien wykopnywa\\u0107 logik\\u0119 wp\\u0142ywajac\\u0105 na samego siebie. Jest to bardzo pomocne przy pracy z interfejsami sieciowymi. Umo\\u017Cliwia eliminacj\\u0119 lag\\xF3w.\"), mdx(\"p\", null, \"Do rysowania planszy najpro\\u015Bciej b\\u0119dzie wykorzysta\\u0107 \\\"no\\u0142dowe\\\" (node-owe(?)) modu\\u0142y \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"react-three-fiber\"), \" oraz \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"drei\"), \".\\nModu\\u0142y te dostarczaj\\u0105 kolejnej niesamowitej warstwy abstrakcji do abstrakcji dostarczanej przez three.js,\\nkt\\xF3re z kolei dostarcza jej dla WebGL dostarczajacego abstrakcji wywo\\u0142aniom systemowym dosta... do\\u015B\\u0107.\\nWa\\u017Cne, \\u017Ce mo\\u017Cna w tej technologii napisa\\u0107 kr\\xF3tki robi\\u0105cy sporo kod daj\\u0105cy w rezultacie ca\\u0142kiem wydajn\\u0105 aplikacj\\u0119.\"), mdx(\"p\", null, \"Warto nadmieni\\u0107, \\u017Ce pomys\\u0142 z organizacj\\u0105 serwera i clienta mo\\u017Cna przedstawi\\u0107 w modelu MVC.\\nNa serwerze nie jest prostym m\\xF3wi\\u0107 o \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"widoku\"), \", lecz za\\u0142\\xF3\\u017Cmy, \\u017Ce jest to spos\\xF3b u\\u017Cywania modu\\u0142\\xF3w w mainie\\n(tak na prawd\\u0119, powinno si\\u0119 na to patrze\\u0107 raczej przez pryzmat odpowiedzi serwera do clienta,\\nlecz w tym opisie ca\\u0142kiem odseparowa\\u0142em backcend od frontendu).\\nKontrolerami b\\u0119d\\u0105 g\\u0142\\xF3wna struktura serwera oraz gry. Oba one przyjmuj\\u0105 informacje i zarz\\u0105dzaj\\u0105 modelami,\\nkt\\xF3rymi s\\u0105 mp. \\\"handler\\\" socket\\xF3w oraz plansza gry.\\nPo stronie clienta za\\u015B komponentem widoku b\\u0119dzie jednocze\\u015Bnie kontrolerem.\\nPlik \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"App.js\"), \" b\\u0119dzie widokiem poniewa\\u017C b\\u0119dzie defniowa\\u0107 szkielet i styl aplikacji poprzez metod\\u0119 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"render\"), \",\\noraz kontrolerem poniewa\\u017C b\\u0119dzie zarz\\u0105dza\\u0144 po\\u0142\\u0105czeniami ws jak i b\\u0119dzie konfigurowa\\u0107 ustawienia innych mod\\xF3\\u0142\\xF3w.\\nZa model b\\u0119dzie odpowiada\\u0107 przyk\\u0142adowo \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Tile.js\"), \" odpowiedzialny za pojedynczy kafelek gry.\\nZdaj\\u0119 sobie oczywi\\u015Bcie spraw\\u0119 z tego, \\u017Ce nie ejst to wzorcowe podejscie.\\nUwa\\u017Cam jednak, \\u017Ce jest to podejscie wystarczajaco dobre dla ma\\u0142ej, skromnej aplikacji -- warto przypomnie\\u0107,\\n\\u017Ce koniec ko\\u0144c\\xF3w to nie b\\u0119dzie gra. Front b\\u0119dzie tu jedynie pe\\u0142ni\\u0107 podstawowe dzia\\u0142ania komunikacyjne z serwerem.\"), mdx(Info, {\n    mdxType: \"Info\"\n  }, \"Dalsz\\u0105 cz\\u0119\\u015B\\u0107 wpisu b\\u0119d\\u0119 kontynuowa\\u0107 w czasie przesz\\u0142ym -- tekst do tego momentu by\\u0142 wst\\u0119pem organizacyjnym pisanym przed przyst\\u0105pieniem do pracy a jego dalsze cz\\u0119\\u015Bci zosta\\u0142y napisane juz po fakcie.\"), mdx(\"h2\", null, \"To samo s\\u0142odkie, czyli tworzenie -- ale w skr\\xF3cie\"), mdx(\"p\", null, \"Znalezienie lekkiej i dobrze dzia\\u0142aj\\u0105cej biblioteki/frameworka dla ruchu http+ws nie jest proste.\\nBiblioteki g\\u0142\\xF3wnie obs\\u0142uguj\\u0105 tylko jeden z tych ruch\\xF3w sieciowych.\\nTak dla przyk\\u0142adu \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/hyper/0.13.7/hyper/\"\n  }), \"hyper\"), \" obs\\u0142uguje ruch http,\\nlecz taki \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/ws/0.9.1/ws/\"\n  }), \"ws\"), \" jak nazwa wskazuje potrafi zapanowa\\u0107 tylko nad websocketami.\\nTo mo\\u017Ce \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://actix.rs/\"\n  }), \"Actix\"), \"? Potrafi obs\\u0142ugiwa\\u0107 oba ruchy. Jest to prawd\\u0105, lecz podobnie jak \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://rocket.rs/\"\n  }), \"Rocket\"), \"\\nprzeznacozny na ten czas jedynie do http, Actix jest \\\"kombajnem\\\". Albo inaczej --\\nframeworki te dostarczaj\\u0105 takiej abstrakcji, \\u017Ce nienauczy\\u0142ym si\\u0119 z nich Rusta samego w sobie, czyli tego na czym mi zale\\u017Cy.\\nZnalezione rozwi\\u0105zanie? U\\u017Cy\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"hyper\"), \" wraz z \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/tokio-tungstenite/0.11.0/tokio_tungstenite/\"\n  }), \"tokio_tungstenite\"), \".\\nDodatkowo (jak z nazwy tego drugiego wynika) trzeba zaci\\u0105gna\\u0107 \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/tokio/0.2.22/tokio/\"\n  }), \"tokio\"), \", lecz to nie problem -- nawet wskazane.\\nSkoro tokio, to tak\\u017Ce \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/futures/0.3.5/futures/\"\n  }), \"futures\"), \".\\nJako, \\u017Ce do stworzenia aktualizacji protoko\\u0142u potrzebne s\\u0105 szyfrowanie \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/sha-1/0.9.1/sha1/\"\n  }), \"sha-1\"), \"\\noraz kodowanie \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/base64/0.12.3/base64/\"\n  }), \"bash64\"), \" to je takze nale\\u017Ca\\u0142o zaci\\u0105gna\\u0107 z sieci.\"), mdx(\"p\", null, \"Dysponuj\\u0105c tymi paczkami stworzy\\u0142em serwer http+ws pisz\\u0105c aktualizacj\\u0119 protoko\\u0142u jak i przechowywanie socket\\xF3w samodzielnie.\\nCiekawa rzecz, chcia\\u0142em si\\u0119 tego nauczy\\u0107 lecz bez jakiego\\u015B du\\u017Cego ci\\u015Bnienia i teraz mia\\u0142em okazj\\u0119 to zrobi\\u0107.\\nW celu zrobienia tego poprawnie przydatnym \\u017Ar\\xF3d\\u0142em okaza\\u0142 si\\u0119 \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers\"\n  }), \"MDN\"), \".\"), mdx(\"p\", null, mdx(\"figure\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"873px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/b680064ca8dd95ecb7572bff12c1d73a/35751/mime_types.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"159.2%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAAA7CAAAOwgEVKEqAAAAFEklEQVRIx3VW6VobRxDUI8SAtPcxe9+nLpABOwbbSX7l/R+mUj2LQWDlR3+zWu30VndV1+wqzQukZYe66zEMLbq2QtNPaMcJQ12g7jtkeYk0yZBlGTzPg2lasCxbh1x7no+mafX/K2NjwLB8FP2Aqq1Rdg3SukFStQijAI7twHEcvcnm9Xq9wYZ7ljCxvlnDD0J8f37Ccb/HSt7i2i6KrCOKGC43Wty44cb3m5cwDPNdyDN+EODb01fsdjusBLIkdC0XJldBIy+RzeuzOE9ynlhebDsuDocZWZpgZdtE6Cqk8xcURYkijRGEClEYQrkuYt9DyPVGEJ+hPF9NAuj6Cp5rYyU92hBZfPsDc1Ug8lyW7KJMU9xWKe7qHNsiRaECpIEP8yNCScgcIwkNuFcnNFiumu4xlDkS2SQ9ZT+3eYwxizEwjmWGQ5nqpIL2Y8K+rxG4DhOyZ4btIbn7iQNZLlQI2/VRUwKnOiPKDHkYwOdzErZlXUTYdzW5YMkuH9oQYXJ8xsSSFXtmO55GKMn2RNbE7Cn1Z5HA9aUeMuEw1PA956Vk04ZqOxR5BKV83eQw9FHlinIiYs+G8QHV2/XmtYeeIwjJoCRM5plqTzkVSuswjkL0TYympjYDEfRlHb4iZA91QkeXzATbE3qWGKtF2GkcYSpJSpmgyyJNli6ZiV+DyW5uNrqiti8pv5ceGmQ12n7BWCwsWxRqmSTYZsJ0gjFdVgkhSPQp2pRVZOa6HhE28IVlaWSchCgf/sHd1KPKUoSKyNoGjyNjavHAtSsy1HkGxbmNGOol5FpmeRG2lg17KCVPO1QsT72ULD0c6wQty06SgH10dRimqU1hYywhZcvzuuS3HhL67hvmskDiS8mUTRxjx5JHysdjjzQp69+NQmZZSNmOvW7DwjIRJrs7DC17GAdMSFKSCHNDQqqYQx8gj8XK7N+YXmbZwY7titn/Fx1aiDglaaHghXQdToNPgZf8XZYKQeTB8alFy7xsDswxjfRP330TdtT3dJuITuNpGUQ0g5oJK4byF0alHRdHjwi3c6cltxLK5Y+kz5E1CmHia4QeCchqTkpHDRahvmdenJQloSBU/pnbaB3SbURnDs0hJyn7IsEs+uOasT+a3Yt+KKPXLCUvo8ceNhkPKyKMvaWHgYesDJFXRMko6wi+ci+Tci4bXTITJn2BvGEPfyVkL6su1iUHuY+woIXF7uWSf5GiDVZ0KG4z7NDQQBUTiVAjlj5T2HWmYDoWPdL6UOr7Hs5jp61v5RGhOLSYw9gQZaL0oSNny8TJmesUO7ZD0c5kSuRQOw9JKrMv9uWLsE3DwNXaRHj8iS1JUezD2rBoDjFORYwDj4Ej14Rz+senK1xdXb+LT7wnR0LLjwLL2GA1TzPGeYfTz3/x/PiA28MB83aHh9Md/n78jB/3n/F8f8LD8chzY8TIL4rXmJZ14v6/vvOg322xqusaSVZgePgTh92EuippsgWmocfn/YAT47jtcX8cMdF5Up41afoWSZLqT5UvfGnHvZrla35OhHTmqPDhhjZLWNP2LaQVj846QMz7ceIhUOKdBq6vb15DyhaVzHPP6QrFDylY0SFHr6RVqWg5U4SEMl9GTyLmb0/O8P/5FPn69IitlBzSHMWu/LynW4d6k0PUMikTmR4YOTcEZNDmiwzjPcsiG/nSeHr+iv2e3zbyVRVFEc/UJZHLsZN752Hzvozjpf/kniRs2pYVVvgPBS5z3iJRY7oAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"BARDZO długa lista typów MIME\",\n    \"title\": \"BARDZO długa lista typów MIME\",\n    \"src\": \"/static/b680064ca8dd95ecb7572bff12c1d73a/35751/mime_types.png\",\n    \"srcSet\": [\"/static/b680064ca8dd95ecb7572bff12c1d73a/63868/mime_types.png 250w\", \"/static/b680064ca8dd95ecb7572bff12c1d73a/0b533/mime_types.png 500w\", \"/static/b680064ca8dd95ecb7572bff12c1d73a/35751/mime_types.png 873w\"],\n    \"sizes\": \"(max-width: 873px) 100vw, 873px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }), \"BARDZO d\\u0142uga lista typ\\xF3w MIME\"), \"\\n  \")), mdx(\"p\", null, \"Jednakowo\\u017C na pocz\\u0105tku nie zaimplementowa\\u0142em rozg\\u0142aszania broadcast. Jest ono na tyle nietypowym przypadkiem,\\n\\u017Ce poza samym socketem wymaga dost\\u0119pu do wszystkich innych. Tak wi\\u0119c sam socket powinien mie\\u0107 jaki\\u015B\\nbez- lub po\\u015Bredni dost\\u0119p do wektora wszystkich innych socket\\xF3w.\"), mdx(\"p\", null, \"Zabra\\u0142em si\\u0119 wi\\u0119c do frontu. W pierwszej kolejnosci posz\\u0142o \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm i three.js react-three.fiber drei\"), \".\\nW zasadzie front nie jest niczym nadzwyczajnym. Ot zale\\u017Ca\\u0142o mi na wy\\u015Bwietlaniu element\\xF3w na ekranie.\\nNajwa\\u017Cniejszym jednak by\\u0142 dla mnie kontroler WebSocket -- chia\\u0142em aby dzia\\u0142a\\u0142 podobnie co \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://socket.io/\"\n  }), \"socket.io\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"componentDidMount() {\\n  this.ws.on( `founded game`, gameData => {\\n  this.ws.on( `board update`, boardData => {\\n  this.ws.on( `move`, moveData => {\\n\\n  this.ws.emit( `searchGame`, { square:9 } )\\n  setInterval( () => this.ws.emit( `move`, this.player?.boardId ), 1000 )\\n\\n  window.game = this\\n}\\n\")), mdx(\"p\", null, \"Co prawda teraz przy wpisywaniu powy\\u017Cszego listingu pomy\\u015Bla\\u0142em o tym aby wpisa\\u0107 na pocz\\u0105tku\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"const { ws } = this\"), \" albo aby metody \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ws\"), \" zwraca\\u0142y sw\\xF3j kontekst\\naby mo\\u017Cna by\\u0142o \\u0142a\\u0144cuchowo u\\u017Cywa\\u0107 kolejnych metod. C\\xF3\\u017C, moze p\\xF3\\u017Aniej.\"), mdx(\"p\", null, mdx(\"figure\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1000px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/bcc5603e8f33c95ef6056539ab3f6276/1f05d/plansza.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"37.2%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABtklEQVQY0wGrAVT+ABYaImRVQqSOeZeRlp+ZlpeRjp+ak5iCY0E6NBsdJCMkKCMjJyMjJyQkKCMkJyMjJiQlKCIjJyIjJyEiJgASFBuDe2zdwpyki4OsqW+lpmq3pm/cv5pNS0kYGh8kJSgbHCIVGR4VFiAbFyYfGygVGCAZHCEhIiYlJSkAFBUYd3h9vsaBT7wkQMQwP8kuW54vy7SfREtPHBwfHh8lQj85Z1VXdGNUc3xKeH9MbmBSOjQ3HB0hGBshABITF4B/gcPMi0fBLkjNOT/RN1emOdS9pkhNURsbHx8gI6yppba8hknBNErbME/UL5LNU9vKk7SplG1eTQAUFRl6en29x4Y4vi0/zzQ00jROpDbPtqFHTVEWFho1ODrOzsm5toNtrEih2nfF26LFz7OlpppuamM5NDEAExUZfHh3zMuIfbVAgbxHcrpHh6hI0LibSUxNEBMZZFtQz7SO3baC4tG4y8LFj4aJTERHHRodExQYGh0jABQYIHpnUc+3j8G6o8S7pr2zn8jApMKlfE1EPBAVHq6Sb+e+ia2QbGhcUDIvLxUTFBcXGyAiJiQlKSIjJtnAoNvgtNguAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Wynik tego, co udało mi się zrobić na froncie\",\n    \"title\": \"Wynik tego, co udało mi się zrobić na froncie\",\n    \"src\": \"/static/bcc5603e8f33c95ef6056539ab3f6276/00d43/plansza.png\",\n    \"srcSet\": [\"/static/bcc5603e8f33c95ef6056539ab3f6276/63868/plansza.png 250w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/0b533/plansza.png 500w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/00d43/plansza.png 1000w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/aa440/plansza.png 1500w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/e8950/plansza.png 2000w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/1f05d/plansza.png 2273w\"],\n    \"sizes\": \"(max-width: 1000px) 100vw, 1000px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }), \"Wynik tego, co uda\\u0142o mi si\\u0119 zrobi\\u0107 na froncie\"), \"\\n  \")), mdx(\"p\", null, \"Maj\\u0105c plansz\\u0119 kolej przysz\\u0142a na graczy -- skacz\\u0105ce prostopad\\u0142o\\u015Bciany.\\nZrobienie jednego gracza to bu\\u0142ka z mas\\u0142em -- informacja do serwera, \\u017Ce chc\\u0119 skoczy\\u0107,\\n\\\"rzut ko\\u015Bci\\u0105\\\" i wysolosowanie nowej pozycji, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"socket.emit\"), \" do clienta, i ustawienie pozycji. \\u0141atwe.\"), mdx(\"p\", null, \"Problem jednak zacz\\u0105\\u0142 si\\u0119 przy komunikacji wi\\u0119kszej ilo\\u015Bci graczy.\\nTo jest moment kt\\xF3ry mnie zdemotywowa\\u0142 do dalszego dzia\\u0142ania.\\nKto\\u015B m\\xF3g\\u0142by powiedzie\\u0107 \\\"No przecie\\u0107 to to samo co dla jednego, tylko \\u017Ce dla wielu\\\".\\nW skr\\xF3cie tak, to prawda. Obs\\u0142uga wielu graczy r\\xF3\\u017Cni\\u0142aby si\\u0119 od wersji z pojedynczym graczem tym,\\n\\u017Ce wiadomo\\u015B\\u0107 o skoku konkretnego gracza nale\\u017Ca\\u0142oby \\\"broadcastowa\\u0107\\\".\"), mdx(\"p\", null, \"Problem w tym, \\u017Ce zrobienie tego nie jest takie oczywiste. Koncepcyjnie to serwer powinien m\\xF3c\\nwysy\\u0142a\\u0107 wiadomo\\u015Bci do socket\\xF3w. W zwiazku z tym, jako \\u017Ce broadcast nomen omen musi komunikowa\\u0107 si\\u0119 ze wszystkimi,\\nto umieszczenie metody \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"broadcast\"), \" w strukturze (albo rustowo -- w cesze(?)) kontrolera WebSocket jest racjonalne.\\nCo dalej? C\\xF3\\u017C. Programista JSa da\\u0142by zwyk\\u0142\\u0105 referencj\\u0119 w sockecie do tejze metody. W C++ da\\u0142oby rad\\u0119 wska\\u017Anikiem.\\nTutaj? Mhmm. Nie chc\\u0119 u\\u017Cywa\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"unsafe\"), \" kodu, wi\\u0119c pomin\\u0119 takie elementy.\"), mdx(\"p\", null, \"W pierwszym podej\\u015Bciu wydzieli\\u0142em \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"receiver\"), \" ze struktury socketa i bezpo\\u015Brednio jego wrzuci\\u0142em w loop obs\\u0142ugi zdarze\\u0144.\\nZrobi\\u0142em to dlatego, poniewa\\u017C w czasie broadcastowania iterowanie po wszystkich socketach i ich \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lock\"), \"owanie\\nbardzo szybko doprowadza\\u0142o do \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://pl.wikipedia.org/wiki/Zakleszczenie\"\n  }), \"zatrzasku (deadlocka)\"), \" gdy odbiorca by\\u0142 w strukturze.\\nSprawa by\\u0142a oczywista:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Na serwerze znajduj\\u0105 si\\u0119 2 sockety;\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Oba s\\u0105 stale u\\u017Cywane przez sw\\xF3j w\\u0105tek, poniewa\\u017C nas\\u0142uchuj\\u0105 zdarzenia;\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Jeden z nich chce nada\\u0107 wiadomo\\u015B\\u0107 broadcast, wi\\u0119c musi przechwyci\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"sender\"), \" drugiego;\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Operacja ko\\u0144czy si\\u0119 zakleszczeniem, poniewa\\u017C drugi nigdy nie odda socketu, a pierwszy nie odpu\\u015Bci oczekiwania.\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-rust\"\n  }), \"let socket_mutex = Arc::new( Mutex::new( Socket::new( ws_stream, broadcast_adapter ) ) );\\nlet mut socket = socket_mutex.lock().await;\\n\\nloop {\\n  let msg = socket.wait_for_message().await;\\n\\n  ...\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-rust\"\n  }), \"let (sink, mut stream) = ws_stream.split();\\nlet socket_mutex = Arc::new( Mutex::new( Socket::new( sink, broadcast_adapter ) ) );\\n\\nloop {\\n  let msg = stream.next().await.unwrap().unwrap();\\n  let mut socket = socket_mutex.lock().await;\\n\\n  ...\\n\")), mdx(\"p\", null, \"Wydzielaj\\u0105c odbiorc\\u0119 ze struktury socketu wyeliminowa\\u0142em ten problem, lecz szybko pojawi\\u0142 si\\u0119 nast\\u0119pny.\\nNikt/nic (lekko upraszczaj\\u0105c) nie ma wp\\u0142ywu na to, kiedy procesor uzna, \\u017Ce czas pracy w\\u0105tku si\\u0119 sko\\u0144czy\\u0142\\ni kolej jest na nast\\u0119pny. W zwi\\u0105zku z tym dosz\\u0142o do sytuacji przedstawionej na screenie poni\\u017Cej:\"), mdx(\"p\", null, mdx(\"figure\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"341px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/5931ce88c61ebce2128625bfe329036c/4c0ad/zakleszczenie.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"27.599999999999998%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABDUlEQVQY013Qb0+CUBQG8Oe2LBEQQeH+49LUoRCYICmiTm2rdKvv/3m69KK5zn47e3a2582BXIHHhKeEPxGRE3UkYQ19VCeEO4gcYXMX7oisQNk9bYf9QVCA7Vu8AT1g9AL/+VcBP4efwF/AX8KfkyDo3Tbb8qzrToUVM2eS2mk8yA2a2JPMjhNzGvfG8+4460xyzJKHOWc8+FeuUa2wqFBkSPeo9lg3qDYoG5R6V1huUZ6wqTul5CKgnN4A7bq1mR36y7f+emOkA8McGpb3aA5Nq+VYntd3R7YX2JQPNKYcqkmHChdMQbxDXiDORB4gX6E+IQvoD+kcXRFdSPRFdAiPCM9QV6gPRN+Q28cfuqsk78TusP4AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Przykład zakleszczenia. Jeden kolor = działania jednego socketu\",\n    \"title\": \"Przykład zakleszczenia. Jeden kolor = działania jednego socketu\",\n    \"src\": \"/static/5931ce88c61ebce2128625bfe329036c/4c0ad/zakleszczenie.png\",\n    \"srcSet\": [\"/static/5931ce88c61ebce2128625bfe329036c/63868/zakleszczenie.png 250w\", \"/static/5931ce88c61ebce2128625bfe329036c/4c0ad/zakleszczenie.png 341w\"],\n    \"sizes\": \"(max-width: 341px) 100vw, 341px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }), \"Przyk\\u0142ad zakleszczenia. Jeden kolor = dzia\\u0142ania jednego socketu\"), \"\\n  \")), mdx(\"p\", null, \"Normalnie powinien tam wyst\\u0105pi\\u0107 jeszcze log \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"end of lock <id>\"), \" lecz nie wyst\\u0105pi\\u0142.\\nW tym przypadku deadlock pojawi\\u0142 si\\u0119 w podobnej sytuacji co przed zmianami --\\npo zablokowaniu dost\\u0119pu do obu socket\\xF3w i pr\\xF3bie wzajemnego dost\\u0119pu do siebie.\"), mdx(\"p\", null, \"Drugie podej\\u015Bcie zak\\u0142ada\\u0142o stworzenie kana\\u0142u, kt\\xF3rym m\\xF3g\\u0142bym komunikowa\\u0107 sockety\\ni stworzonego specjalnie osobnego \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"taska\"), \" tokio kt\\xF3rego jedynym zadaniem by\\u0142oby\\nnas\\u0142uchiwanie przychodz\\u0105cych \\u017C\\u0105da\\u0144 broadcastu.\\nTo sprawi\\u0142oby, \\u017Ce \\u017Caden socket niemia\\u0142by nic wsp\\xF3lnego z jakimkolwiek innym socketem.\\nW za\\u0142o\\u017Ceniach brzmia\\u0142o pi\\u0119knie, lecz zidentyfikowa\\u0142em jaki\\u015B nieznany mi b\\u0142\\u0105d,\\nkt\\xF3ry zupe\\u0142nie psu\\u0142 poprawne dzia\\u0142anie. Przykra sprawa ;/\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Dzie\\u0144 p\\xF3\\u017Aniej\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"Lekko zrezygnowany i chc\\u0105cy zabra\\u0107 si\\u0119 za co\\u015B innego spr\\xF3bowa\\u0142em dowiedzie\\u0107 si\\u0119 co mo\\u017Ce by\\u0107 nie tak.\\nCo ciekawe, problem le\\u017Ca\\u0142 w \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"block_on( self.sink.send( message ) )\"), \" -- blokowaniu emitera wiadomo\\u015Bci socketu.\\nTak jakby przy broadcastowaniu si\\u0119 nagle blokowa\\u0142 (bo problem dotyczy\\u0142 tylko broadcastu).\\nPrzy czym operacja dobiega ko\\u0144ca -- wiem to, poniewa\\u017C skorzysta\\u0142em z niezawodnego debugowania \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"println\"), \".\\nJak ten problem rozwi\\u0105za\\u0142em? Bardzo s\\u0142abo:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-rust\"\n  }), \"pub fn emit( &mut self, message:&str ) {\\n  let sink_clone = Arc::clone( &self.sink );\\n  let message = String::from( message );\\n\\n  thread::spawn( move || if let Err( err ) = block_on( block_on( sink_clone.lock() ).send( message.into() ) ) {\\n    println!( \\\"Emit error: {}\\\", err );\\n  } );\\n}\\n\")), mdx(\"p\", null, \"Generalnie, to zdaj\\u0119 sobie spraw\\u0119 z tego, \\u017Ce to wymaga refaktoryzacji.\\nPrzy czym aby to zrobi\\u0107, musia\\u0142bym najpewniej napisa\\u0107 serwer http od zera, bez udzia\\u0142u \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"hyper\"), \"a.\\nWtedy m\\xF3g\\u0142bym te\\u017C zrobi\\u0107 nieco bardziej solidny serwer http+ws.\\nBrzmi jak dobry plan, ale motywacji jakby nie za du\\u017Co (to jest jawna sugestia dla czytelnik\\xF3w aby jako\\u015B na mnie wp\\u0142yna\\u0107).\"), mdx(\"p\", null, \"===\"), mdx(\"p\", null, \"Jako, \\u017Ce jest to m\\xF3j projekt rozgrzewkowy do srodowiska, to oczywi\\u015Bcie nie wiem czy moje rozwi\\u0105zanie jest s\\u0142uszne,\\nlecz projektowo uzna\\u0142em,\"), mdx(\"p\", null, \"Sama gra raczej nie zosta\\u0142a przemy\\u015Blana bardzo dobrze. Ot \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"po prostu mia\\u0142a dzia\\u0142a\\u0107\"), \".\\nDlatego te\\u017C nie pokusi\\u0142em si\\u0119 o najlepsze wzorce, przyk\\u0142adowo \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/Memoization\"\n  }), \"memoizacji\"), \"(?)\"), mdx(\"p\", null, \"Nie wykluczam p\\xF3\\u017Aniejszej dalszej aktualizacji tego kodu, poniewa\\u017C my\\u015Bl\\u0119, ze mo\\u017Ce si\\u0119 on komu\\u015B przyda\\u0107.\\nSkoro mi si\\u0119 nie uda\\u0142o znale\\u017A\\u0107 dobrego serwera http+ws i stworzy\\u0142em go samemu, to moze kto\\u015B tak\\u017Ce b\\u0119dzie poszukiwac i tym razem znajdzie ^^.\\nPrzy czym zaznaczam, \\u017Ce kod ten wymaga sporo poprawek/usprawnie\\u0144 aby m\\xF3c z niego swobodnie korzysa\\u0107. Chocia\\u017C mo\\u017Ce pomog\\u0142aby spo\\u0142eczno\\u015B\\u0107 githuba...\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"NieMonopoly","author":"Paweł Stolarski","date":"01-09-2020","categories":["Gry","Projekty","Sprawozdania"],"tags":["cactu","backend","serwer","rust","react"]}}},"pageContext":{"langKey":"en","slug":"/2020-09-01/NieMonopoly","previous":{"fields":{"slug":"/2020-08-07/Jednym_commitem_pisząc-Reinventing_the_wheel_again"},"frontmatter":{"title":"Jednym commitem pisząc: Reinventing the wheel again","tags":["blog"],"categories":["Rozmaitości"]}},"next":null}}