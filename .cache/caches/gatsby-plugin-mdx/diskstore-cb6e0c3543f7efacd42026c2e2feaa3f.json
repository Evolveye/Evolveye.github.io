{"expireTime":9007200857012820000,"key":"gatsby-plugin-mdx-entire-payload-c1f952416666768d38ddef6d50e64954-","val":{"mdast":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"Zanim podejmie się pisania dużego projektu w nowopoznanej technologii,\nwarto jest (moim zdaniem oczywiście) zrobić uprzednio jakiś mniejszy twór (\"kalkualtor\").","position":{"start":{"line":2,"column":1,"offset":2},"end":{"line":3,"column":90,"offset":163},"indent":[1]}}],"position":{"start":{"line":2,"column":1,"offset":2},"end":{"line":3,"column":90,"offset":163},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"W moim przypadku, dużym projektem będzie praca inżynierska.\nMałym zaś, podstawowy backend pod tworzenie gry -- w tym przypadku monopoly.","position":{"start":{"line":5,"column":1,"offset":167},"end":{"line":6,"column":77,"offset":304},"indent":[1]}}],"position":{"start":{"line":5,"column":1,"offset":167},"end":{"line":6,"column":77,"offset":304},"indent":[1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Załozenia projektu","position":{"start":{"line":9,"column":4,"offset":313},"end":{"line":9,"column":22,"offset":331},"indent":[]}}],"position":{"start":{"line":9,"column":1,"offset":310},"end":{"line":9,"column":22,"offset":331},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Skoro gra ta ma pełnić dla mnie rolę rozgrzewki i wstępu do programowania w języku Rust,\nto powinna w sobie zawierać różne elementy uczące korzystania z tego jezyka.\nNie może być to projekt zbyt prosty (alby wręcz zbyt trywialny biedny kalkulatorze),\nponieważ takowy nie nauczy mnie nic w tematach ","position":{"start":{"line":12,"column":1,"offset":337},"end":{"line":15,"column":48,"offset":638},"indent":[1,1,1]}},{"type":"inlineCode","value":"ownership","position":{"start":{"line":15,"column":48,"offset":638},"end":{"line":15,"column":59,"offset":649},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":15,"column":59,"offset":649},"end":{"line":15,"column":61,"offset":651},"indent":[]}},{"type":"inlineCode","value":"borrowing","position":{"start":{"line":15,"column":61,"offset":651},"end":{"line":15,"column":72,"offset":662},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":15,"column":72,"offset":662},"end":{"line":15,"column":74,"offset":664},"indent":[]}},{"type":"inlineCode","value":"lifetime","position":{"start":{"line":15,"column":74,"offset":664},"end":{"line":15,"column":84,"offset":674},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":15,"column":84,"offset":674},"end":{"line":15,"column":86,"offset":676},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"cokolwiek","position":{"start":{"line":15,"column":87,"offset":677},"end":{"line":15,"column":96,"offset":686},"indent":[]}}],"position":{"start":{"line":15,"column":86,"offset":676},"end":{"line":15,"column":97,"offset":687},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":15,"column":97,"offset":687},"end":{"line":15,"column":98,"offset":688},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":337},"end":{"line":15,"column":98,"offset":688},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Postanowiłem więc zrobić sam backend dla gry jaką będzie coś na wzór monopoly.\nFrontent zaś przygotuję z pomocą aplikacji Reacta. Skoro zaś pojawiają się pojęcia ","position":{"start":{"line":17,"column":1,"offset":692},"end":{"line":18,"column":84,"offset":855},"indent":[1]}},{"type":"inlineCode","value":"frontu","position":{"start":{"line":18,"column":84,"offset":855},"end":{"line":18,"column":92,"offset":863},"indent":[]}},{"type":"text","value":" i ","position":{"start":{"line":18,"column":92,"offset":863},"end":{"line":18,"column":95,"offset":866},"indent":[]}},{"type":"inlineCode","value":"backu","position":{"start":{"line":18,"column":95,"offset":866},"end":{"line":18,"column":102,"offset":873},"indent":[]}},{"type":"text","value":",\nto można się łatwo domyśleć, że że projekt będzie wymagać ruchu sieciowego -- tenże również napisze w Ruscie.","position":{"start":{"line":18,"column":102,"offset":873},"end":{"line":19,"column":110,"offset":985},"indent":[1]}}],"position":{"start":{"line":17,"column":1,"offset":692},"end":{"line":19,"column":110,"offset":985},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"I to właśnie na ruchu sieciowym postanwoiłem tak na prawdę pozostać.\nCelem jest nauczyć się poruszać po nowym języku. Tworzenie gry zostawię sobie na inną okazję.\nDoprecyzowujac więc -- chcę zbudować prymitywną wersję serwera http+ws, który obsługiwałby\npoprawnie reactowe aplikacje, oraz który dostarczy obsługi ws podobnej do biblioteki socket.io.\nJednak dla prostoty przekazu będę używać słowa ","position":{"start":{"line":21,"column":1,"offset":989},"end":{"line":25,"column":48,"offset":1390},"indent":[1,1,1,1]}},{"type":"inlineCode","value":"gra","position":{"start":{"line":25,"column":48,"offset":1390},"end":{"line":25,"column":53,"offset":1395},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":25,"column":53,"offset":1395},"end":{"line":25,"column":54,"offset":1396},"indent":[]}}],"position":{"start":{"line":21,"column":1,"offset":989},"end":{"line":25,"column":54,"offset":1396},"indent":[1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Początek prac","position":{"start":{"line":28,"column":4,"offset":1405},"end":{"line":28,"column":17,"offset":1418},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":1402},"end":{"line":28,"column":17,"offset":1418},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Zacząć należy od przygotowań środowiska pracy. Podejść może być pare.\nW jednym podejściu, pliki zarówno frantu jak i backendu mogą być w jednym folderze.\nW drugim zaś podejściu, można te środowiska rozdzielić -- i ja uważam, że to podejscie jest lepsze.\nTrzecim, mogłaby byc hybryda, pliki współdzielone przez serwer i clienta --\ntakie rozwiązanie mogłoby się sprawdzić w projektach gdzie \"zaplecze\" byłoby tworzone w przykładowo Node.js.","position":{"start":{"line":31,"column":1,"offset":1424},"end":{"line":35,"column":109,"offset":1866},"indent":[1,1,1,1]}}],"position":{"start":{"line":31,"column":1,"offset":1424},"end":{"line":35,"column":109,"offset":1866},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Jeśli prace nad grą byłyby prowadzone przez 2 zespoły, nie powinny one sobie wchodzić w drogę.\nStrony clienta i serwera będą tworzone z użyciem zupełnie różnych technologii i różnymi\npodejsciami do zarządzania plikami. Dodatkowo jestem zdania, że backend powinien być dla frontu\nskryty za warstwą abstrakcji i tak na prawdę żadna ze stron nie powinna musieć wiedzieć jak budowana jest ta druga.\nW związku z tym root projektu powinien moim zdaniem wyglądać mniej więcej tak:","position":{"start":{"line":37,"column":1,"offset":1870},"end":{"line":41,"column":79,"offset":2347},"indent":[1,1,1,1]}}],"position":{"start":{"line":37,"column":1,"offset":1870},"end":{"line":41,"column":79,"offset":2347},"indent":[1,1,1,1]}},{"type":"code","lang":null,"meta":null,"value":"root/\n |- backend/\n |- frontend/\n  ` readme.md","position":{"start":{"line":43,"column":1,"offset":2351},"end":{"line":48,"column":4,"offset":2410},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Po utworzeniu takiej struktury, w folderach ","position":{"start":{"line":50,"column":1,"offset":2414},"end":{"line":50,"column":45,"offset":2458},"indent":[]}},{"type":"inlineCode","value":"backend","position":{"start":{"line":50,"column":45,"offset":2458},"end":{"line":50,"column":54,"offset":2467},"indent":[]}},{"type":"text","value":" i ","position":{"start":{"line":50,"column":54,"offset":2467},"end":{"line":50,"column":57,"offset":2470},"indent":[]}},{"type":"inlineCode","value":"frontend","position":{"start":{"line":50,"column":57,"offset":2470},"end":{"line":50,"column":67,"offset":2480},"indent":[]}},{"type":"text","value":" użyłem poleceń kolejno ","position":{"start":{"line":50,"column":67,"offset":2480},"end":{"line":50,"column":91,"offset":2504},"indent":[]}},{"type":"inlineCode","value":"cargo init","position":{"start":{"line":50,"column":91,"offset":2504},"end":{"line":50,"column":103,"offset":2516},"indent":[]}},{"type":"text","value":" oraz ","position":{"start":{"line":50,"column":103,"offset":2516},"end":{"line":50,"column":109,"offset":2522},"indent":[]}},{"type":"inlineCode","value":"npx create-react-app","position":{"start":{"line":50,"column":109,"offset":2522},"end":{"line":50,"column":131,"offset":2544},"indent":[]}},{"type":"text","value":".\nPo tej czynności otrzymałem podstawową strukturę dla obu środowisk.","position":{"start":{"line":50,"column":131,"offset":2544},"end":{"line":51,"column":68,"offset":2614},"indent":[1]}}],"position":{"start":{"line":50,"column":1,"offset":2414},"end":{"line":51,"column":68,"offset":2614},"indent":[1]}},{"type":"code","lang":null,"meta":null,"value":"root/\n |- backend/\n |   |- src/\n |   |- target/\n |   |- .gitignore\n |   |- Cargo.lock\n |    ` Cargo.toml\n |\n |- frontend/\n |   |- build/\n |   |- node_modules/\n |   |- publix/\n |   |- src/\n |   |- .gitignore\n |   |- package.json\n |    ` package-lock.json\n |\n  ` readme.md","position":{"start":{"line":54,"column":1,"offset":2620},"end":{"line":73,"column":4,"offset":2917},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Z taką bazą można przystąpić do pisania kodu. Od czego jednak zacząć?","position":{"start":{"line":75,"column":1,"offset":2921},"end":{"line":75,"column":70,"offset":2990},"indent":[]}}],"position":{"start":{"line":75,"column":1,"offset":2921},"end":{"line":75,"column":70,"offset":2990},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Tak jak z każdym projektem -- moje podejście jest takie, aby budować go od ogółu do szczegółu.\nCo w pierwszej kolejności powinienem mieć, aby robić cokolwiek więcej?\nJak projekt zostanie przedstawiony użytkownikowi? Na czym cały projekt będzie się opierać?\nW obecnym scenariuszu, jest to strona internetowa -- to na niej wszystko będzie się opierać.","position":{"start":{"line":77,"column":1,"offset":2994},"end":{"line":80,"column":93,"offset":3346},"indent":[1,1,1]}}],"position":{"start":{"line":77,"column":1,"offset":2994},"end":{"line":80,"column":93,"offset":3346},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Jednak wpisanie ","position":{"start":{"line":82,"column":1,"offset":3350},"end":{"line":82,"column":17,"offset":3366},"indent":[]}},{"type":"inlineCode","value":"npm start","position":{"start":{"line":82,"column":17,"offset":3366},"end":{"line":82,"column":28,"offset":3377},"indent":[]}},{"type":"text","value":" to w zasadzie nic. Aplikacja Reacta sama stworzy serwer i otworzy stronę w przeglaarce.\nAby podejść do sprawy sensownie, to pliki powinien serwować samodzielnie napisany serwer. Pliki -- właśnie -- jakie.\nJako, ze projekt opiera sie na Reakcie, to hostowane pliki najprościej będzie znaleźć w folderze ","position":{"start":{"line":82,"column":28,"offset":3377},"end":{"line":84,"column":98,"offset":3682},"indent":[1,1]}},{"type":"inlineCode","value":"frontend/build/","position":{"start":{"line":84,"column":98,"offset":3682},"end":{"line":84,"column":115,"offset":3699},"indent":[]}},{"type":"text","value":".\nMając to na uwadze, zamiast startować aplikację, lepiej będzie użyć ","position":{"start":{"line":84,"column":115,"offset":3699},"end":{"line":85,"column":69,"offset":3770},"indent":[1]}},{"type":"inlineCode","value":"npm build","position":{"start":{"line":85,"column":69,"offset":3770},"end":{"line":85,"column":80,"offset":3781},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":85,"column":80,"offset":3781},"end":{"line":85,"column":81,"offset":3782},"indent":[]}}],"position":{"start":{"line":82,"column":1,"offset":3350},"end":{"line":85,"column":81,"offset":3782},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Kolej nadeszła na rozważania nad serwerem. W tym przypadku, backend ma być jednolity -- nie rozbudowwywalny.\nPisząc to mam na myśli to, że ma stanowić jeden zwarty produkt. Nie ma być częścią czegoś innego. Taki monolit.\nNie ma pełnić rolę modułu dla innego projektu. Dodatkowo warto zauważyć, że serwer będzie pełnić funkcję całej aplikacji.\nTo serwer wyśle plik strony którą zinterpretuje przegladarka, to serwer przechwyci rządanie aktualizacji protokołu do WebSocket,\noraz to serwer będzie odbierać i odpowiadać na eventy ws.","position":{"start":{"line":87,"column":1,"offset":3786},"end":{"line":91,"column":58,"offset":4319},"indent":[1,1,1,1]}}],"position":{"start":{"line":87,"column":1,"offset":3786},"end":{"line":91,"column":58,"offset":4319},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Czego by nie zrobić po stronie clienta, to serwer będzie tym zarządzać. Pomysł mam więc taki:\nw pliku ","position":{"start":{"line":93,"column":1,"offset":4323},"end":{"line":94,"column":9,"offset":4426},"indent":[1]}},{"type":"inlineCode","value":"main.rs","position":{"start":{"line":94,"column":9,"offset":4426},"end":{"line":94,"column":18,"offset":4435},"indent":[]}},{"type":"text","value":", (czyli głównym pliku backendu) zaciagnać 2 moduły\n(bo tak wygląda dołączanie innych plików, po prsotu są to moduły) odpowiedzialne za serwer, oraz za grę.\nOba te moduły zintegruje się w \"mainie\" tworząc strukturę serwera, przekazując jej handler zdarzeń ws gry, oraz włączając serwer.","position":{"start":{"line":94,"column":18,"offset":4435},"end":{"line":96,"column":130,"offset":4723},"indent":[1,1]}}],"position":{"start":{"line":93,"column":1,"offset":4323},"end":{"line":96,"column":130,"offset":4723},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"delete","children":[{"type":"text","value":"Zdaję sobie sprawę z tego, ze dużo razy użyłem słowa ","position":{"start":{"line":98,"column":3,"offset":4729},"end":{"line":98,"column":56,"offset":4782},"indent":[]}},{"type":"inlineCode","value":"serwer","position":{"start":{"line":98,"column":56,"offset":4782},"end":{"line":98,"column":64,"offset":4790},"indent":[]}},{"type":"text","value":". Na tym jednak nie koniec.","position":{"start":{"line":98,"column":64,"offset":4790},"end":{"line":98,"column":91,"offset":4817},"indent":[]}}],"position":{"start":{"line":98,"column":1,"offset":4727},"end":{"line":98,"column":93,"offset":4819},"indent":[]}}],"position":{"start":{"line":98,"column":1,"offset":4727},"end":{"line":98,"column":93,"offset":4819},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Frontend z kolei ma pełnić jedynie funkcje interpretacyjne tego co dostał z serwera.\nNie może być po stronie clienta zawarta żadna logika która moze wpłynąć na serwer.\nClient powinien móc jedynie wysyłać sygnały że podjął jakieś działania.","position":{"start":{"line":100,"column":1,"offset":4823},"end":{"line":102,"column":72,"offset":5064},"indent":[1,1]}}],"position":{"start":{"line":100,"column":1,"offset":4823},"end":{"line":102,"column":72,"offset":5064},"indent":[1,1]}},{"type":"jsx","value":"<Aside>\n  Oczywiście jest to spore uproszczenie. Client co prawda nie powinien wykonywac logiki, która wpłwyałaby na serwer, lecz powinien wykopnywać logikę wpływajacą na samego siebie. Jest to bardzo pomocne przy pracy z interfejsami sieciowymi. Umożliwia eliminację lagów.\n</Aside>","position":{"start":{"line":104,"column":1,"offset":5068},"end":{"line":106,"column":9,"offset":5353},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Do rysowania planszy najprościej będzie wykorzystać \"nołdowe\" (node-owe(?)) moduły ","position":{"start":{"line":108,"column":1,"offset":5357},"end":{"line":108,"column":84,"offset":5440},"indent":[]}},{"type":"inlineCode","value":"react-three-fiber","position":{"start":{"line":108,"column":84,"offset":5440},"end":{"line":108,"column":103,"offset":5459},"indent":[]}},{"type":"text","value":" oraz ","position":{"start":{"line":108,"column":103,"offset":5459},"end":{"line":108,"column":109,"offset":5465},"indent":[]}},{"type":"inlineCode","value":"drei","position":{"start":{"line":108,"column":109,"offset":5465},"end":{"line":108,"column":115,"offset":5471},"indent":[]}},{"type":"text","value":".\nModuły te dostarczają kolejnej niesamowitej warstwy abstrakcji do abstrakcji dostarczanej przez three.js,\nktóre z kolei dostarcza jej dla WebGL dostarczajacego abstrakcji wywołaniom systemowym dosta... dość.\nWażne, że można w tej technologii napisać krótki robiący sporo kod dający w rezultacie całkiem wydajną aplikację.","position":{"start":{"line":108,"column":115,"offset":5471},"end":{"line":111,"column":114,"offset":5797},"indent":[1,1,1]}}],"position":{"start":{"line":108,"column":1,"offset":5357},"end":{"line":111,"column":114,"offset":5797},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Warto nadmienić, że pomysł z organizacją serwera i clienta można przedstawić w modelu MVC.\nNa serwerze nie jest prostym mówić o ","position":{"start":{"line":113,"column":1,"offset":5801},"end":{"line":114,"column":38,"offset":5930},"indent":[1]}},{"type":"inlineCode","value":"widoku","position":{"start":{"line":114,"column":38,"offset":5930},"end":{"line":114,"column":46,"offset":5938},"indent":[]}},{"type":"text","value":", lecz załóżmy, że jest to sposób używania modułów w mainie\n(tak na prawdę, powinno się na to patrzeć raczej przez pryzmat odpowiedzi serwera do clienta,\nlecz w tym opisie całkiem odseparowałem backcend od frontendu).\nKontrolerami będą główna struktura serwera oraz gry. Oba one przyjmują informacje i zarządzają modelami,\nktórymi są mp. \"handler\" socketów oraz plansza gry.\nPo stronie clienta zaś komponentem widoku będzie jednocześnie kontrolerem.\nPlik ","position":{"start":{"line":114,"column":46,"offset":5938},"end":{"line":120,"column":6,"offset":6399},"indent":[1,1,1,1,1,1]}},{"type":"inlineCode","value":"App.js","position":{"start":{"line":120,"column":6,"offset":6399},"end":{"line":120,"column":14,"offset":6407},"indent":[]}},{"type":"text","value":" będzie widokiem ponieważ będzie defniować szkielet i styl aplikacji poprzez metodę ","position":{"start":{"line":120,"column":14,"offset":6407},"end":{"line":120,"column":98,"offset":6491},"indent":[]}},{"type":"inlineCode","value":"render","position":{"start":{"line":120,"column":98,"offset":6491},"end":{"line":120,"column":106,"offset":6499},"indent":[]}},{"type":"text","value":",\noraz kontrolerem ponieważ będzie zarządzań połączeniami ws jak i będzie konfigurować ustawienia innych modółów.\nZa model będzie odpowiadać przykładowo ","position":{"start":{"line":120,"column":106,"offset":6499},"end":{"line":122,"column":40,"offset":6654},"indent":[1,1]}},{"type":"inlineCode","value":"Tile.js","position":{"start":{"line":122,"column":40,"offset":6654},"end":{"line":122,"column":49,"offset":6663},"indent":[]}},{"type":"text","value":" odpowiedzialny za pojedynczy kafelek gry.\nZdaję sobie oczywiście sprawę z tego, że nie ejst to wzorcowe podejscie.\nUważam jednak, że jest to podejscie wystarczajaco dobre dla małej, skromnej aplikacji -- warto przypomnieć,\nże koniec końców to nie będzie gra. Front będzie tu jedynie pełnić podstawowe działania komunikacyjne z serwerem.","position":{"start":{"line":122,"column":49,"offset":6663},"end":{"line":125,"column":114,"offset":7003},"indent":[1,1,1]}}],"position":{"start":{"line":113,"column":1,"offset":5801},"end":{"line":125,"column":114,"offset":7003},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"jsx","value":"<Info>\n  Dalszą część wpisu będę kontynuować w czasie przeszłym --\n  tekst do tego momentu był wstępem organizacyjnym pisanym przed przystąpieniem do pracy\n  a jego dalsze części zostały napisane juz po fakcie.\n</Info>","position":{"start":{"line":127,"column":1,"offset":7007},"end":{"line":131,"column":8,"offset":7229},"indent":[1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"To samo słodkie, czyli tworzenie -- ale w skrócie","position":{"start":{"line":134,"column":4,"offset":7238},"end":{"line":134,"column":53,"offset":7287},"indent":[]}}],"position":{"start":{"line":134,"column":1,"offset":7235},"end":{"line":134,"column":53,"offset":7287},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Znalezienie lekkiej i dobrze działającej biblioteki/frameworka dla ruchu http+ws nie jest proste.\nBiblioteki głównie obsługują tylko jeden z tych ruchów sieciowych.\nTak dla przykładu ","position":{"start":{"line":137,"column":1,"offset":7293},"end":{"line":139,"column":19,"offset":7478},"indent":[1,1]}},{"type":"link","title":null,"url":"https://docs.rs/hyper/0.13.7/hyper/","children":[{"type":"text","value":"hyper","position":{"start":{"line":139,"column":20,"offset":7479},"end":{"line":139,"column":25,"offset":7484},"indent":[]}}],"position":{"start":{"line":139,"column":19,"offset":7478},"end":{"line":139,"column":63,"offset":7522},"indent":[]}},{"type":"text","value":" obsługuje ruch http,\nlecz taki ","position":{"start":{"line":139,"column":63,"offset":7522},"end":{"line":140,"column":11,"offset":7555},"indent":[1]}},{"type":"link","title":null,"url":"https://docs.rs/ws/0.9.1/ws/","children":[{"type":"text","value":"ws","position":{"start":{"line":140,"column":12,"offset":7556},"end":{"line":140,"column":14,"offset":7558},"indent":[]}}],"position":{"start":{"line":140,"column":11,"offset":7555},"end":{"line":140,"column":45,"offset":7589},"indent":[]}},{"type":"text","value":" jak nazwa wskazuje potrafi zapanować tylko nad websocketami.\nTo może ","position":{"start":{"line":140,"column":45,"offset":7589},"end":{"line":141,"column":9,"offset":7660},"indent":[1]}},{"type":"link","title":null,"url":"https://actix.rs/","children":[{"type":"text","value":"Actix","position":{"start":{"line":141,"column":10,"offset":7661},"end":{"line":141,"column":15,"offset":7666},"indent":[]}}],"position":{"start":{"line":141,"column":9,"offset":7660},"end":{"line":141,"column":35,"offset":7686},"indent":[]}},{"type":"text","value":"? Potrafi obsługiwać oba ruchy. Jest to prawdą, lecz podobnie jak ","position":{"start":{"line":141,"column":35,"offset":7686},"end":{"line":141,"column":101,"offset":7752},"indent":[]}},{"type":"link","title":null,"url":"https://rocket.rs/","children":[{"type":"text","value":"Rocket","position":{"start":{"line":141,"column":102,"offset":7753},"end":{"line":141,"column":108,"offset":7759},"indent":[]}}],"position":{"start":{"line":141,"column":101,"offset":7752},"end":{"line":141,"column":129,"offset":7780},"indent":[]}},{"type":"text","value":"\nprzeznacozny na ten czas jedynie do http, Actix jest \"kombajnem\". Albo inaczej --\nframeworki te dostarczają takiej abstrakcji, że nienauczyłym się z nich Rusta samego w sobie, czyli tego na czym mi zależy.\nZnalezione rozwiązanie? Użyć ","position":{"start":{"line":141,"column":129,"offset":7780},"end":{"line":144,"column":30,"offset":8019},"indent":[1,1,1]}},{"type":"inlineCode","value":"hyper","position":{"start":{"line":144,"column":30,"offset":8019},"end":{"line":144,"column":37,"offset":8026},"indent":[]}},{"type":"text","value":" wraz z ","position":{"start":{"line":144,"column":37,"offset":8026},"end":{"line":144,"column":45,"offset":8034},"indent":[]}},{"type":"link","title":null,"url":"https://docs.rs/tokio-tungstenite/0.11.0/tokio_tungstenite/","children":[{"type":"text","value":"tokio_tungstenite","position":{"start":{"line":144,"column":46,"offset":8035},"end":{"line":144,"column":63,"offset":8052},"indent":[]}}],"position":{"start":{"line":144,"column":45,"offset":8034},"end":{"line":144,"column":125,"offset":8114},"indent":[]}},{"type":"text","value":".\nDodatkowo (jak z nazwy tego drugiego wynika) trzeba zaciągnać ","position":{"start":{"line":144,"column":125,"offset":8114},"end":{"line":145,"column":63,"offset":8179},"indent":[1]}},{"type":"link","title":null,"url":"https://docs.rs/tokio/0.2.22/tokio/","children":[{"type":"text","value":"tokio","position":{"start":{"line":145,"column":64,"offset":8180},"end":{"line":145,"column":69,"offset":8185},"indent":[]}}],"position":{"start":{"line":145,"column":63,"offset":8179},"end":{"line":145,"column":107,"offset":8223},"indent":[]}},{"type":"text","value":", lecz to nie problem -- nawet wskazane.\nSkoro tokio, to także ","position":{"start":{"line":145,"column":107,"offset":8223},"end":{"line":146,"column":23,"offset":8287},"indent":[1]}},{"type":"link","title":null,"url":"https://docs.rs/futures/0.3.5/futures/","children":[{"type":"text","value":"futures","position":{"start":{"line":146,"column":24,"offset":8288},"end":{"line":146,"column":31,"offset":8295},"indent":[]}}],"position":{"start":{"line":146,"column":23,"offset":8287},"end":{"line":146,"column":72,"offset":8336},"indent":[]}},{"type":"text","value":".\nJako, że do stworzenia aktualizacji protokołu potrzebne są szyfrowanie ","position":{"start":{"line":146,"column":72,"offset":8336},"end":{"line":147,"column":72,"offset":8410},"indent":[1]}},{"type":"link","title":null,"url":"https://docs.rs/sha-1/0.9.1/sha1/","children":[{"type":"text","value":"sha-1","position":{"start":{"line":147,"column":73,"offset":8411},"end":{"line":147,"column":78,"offset":8416},"indent":[]}}],"position":{"start":{"line":147,"column":72,"offset":8410},"end":{"line":147,"column":114,"offset":8452},"indent":[]}},{"type":"text","value":"\noraz kodowanie ","position":{"start":{"line":147,"column":114,"offset":8452},"end":{"line":148,"column":16,"offset":8469},"indent":[1]}},{"type":"link","title":null,"url":"https://docs.rs/base64/0.12.3/base64/","children":[{"type":"text","value":"bash64","position":{"start":{"line":148,"column":17,"offset":8470},"end":{"line":148,"column":23,"offset":8476},"indent":[]}}],"position":{"start":{"line":148,"column":16,"offset":8469},"end":{"line":148,"column":63,"offset":8516},"indent":[]}},{"type":"text","value":" to je takze należało zaciągnać z sieci.","position":{"start":{"line":148,"column":63,"offset":8516},"end":{"line":148,"column":103,"offset":8556},"indent":[]}}],"position":{"start":{"line":137,"column":1,"offset":7293},"end":{"line":148,"column":103,"offset":8556},"indent":[1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Dysponując tymi paczkami stworzyłem serwer http+ws pisząc aktualizację protokołu jak i przechowywanie socketów samodzielnie.\nCiekawa rzecz, chciałem się tego nauczyć lecz bez jakiegoś dużego ciśnienia i teraz miałem okazję to zrobić.\nW celu zrobienia tego poprawnie przydatnym źródłem okazał się ","position":{"start":{"line":150,"column":1,"offset":8560},"end":{"line":152,"column":63,"offset":8858},"indent":[1,1]}},{"type":"link","title":null,"url":"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers","children":[{"type":"text","value":"MDN","position":{"start":{"line":152,"column":64,"offset":8859},"end":{"line":152,"column":67,"offset":8862},"indent":[]}}],"position":{"start":{"line":152,"column":63,"offset":8858},"end":{"line":152,"column":159,"offset":8954},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":152,"column":159,"offset":8954},"end":{"line":152,"column":160,"offset":8955},"indent":[]}}],"position":{"start":{"line":150,"column":1,"offset":8560},"end":{"line":152,"column":160,"offset":8955},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"./mime_types.png","alt":"BARDZO długa lista typów MIME","position":{"start":{"line":154,"column":1,"offset":8959},"end":{"line":154,"column":51,"offset":9009},"indent":[]}}],"position":{"start":{"line":154,"column":1,"offset":8959},"end":{"line":154,"column":51,"offset":9009},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Jednakowoż na początku nie zaimplementowałem rozgłaszania broadcast. Jest ono na tyle nietypowym przypadkiem,\nże poza samym socketem wymaga dostępu do wszystkich innych. Tak więc sam socket powinien mieć jakiś\nbez- lub pośredni dostęp do wektora wszystkich innych socketów.","position":{"start":{"line":156,"column":1,"offset":9013},"end":{"line":158,"column":64,"offset":9288},"indent":[1,1]}}],"position":{"start":{"line":156,"column":1,"offset":9013},"end":{"line":158,"column":64,"offset":9288},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Zabrałem się więc do frontu. W pierwszej kolejnosci poszło ","position":{"start":{"line":160,"column":1,"offset":9292},"end":{"line":160,"column":60,"offset":9351},"indent":[]}},{"type":"inlineCode","value":"npm i three.js react-three.fiber drei","position":{"start":{"line":160,"column":60,"offset":9351},"end":{"line":160,"column":99,"offset":9390},"indent":[]}},{"type":"text","value":".\nW zasadzie front nie jest niczym nadzwyczajnym. Ot zależało mi na wyświetlaniu elementów na ekranie.\nNajważniejszym jednak był dla mnie kontroler WebSocket -- chiałem aby działał podobnie co ","position":{"start":{"line":160,"column":99,"offset":9390},"end":{"line":162,"column":91,"offset":9585},"indent":[1,1]}},{"type":"link","title":null,"url":"https://socket.io/","children":[{"type":"text","value":"socket.io","position":{"start":{"line":162,"column":92,"offset":9586},"end":{"line":162,"column":101,"offset":9595},"indent":[]}}],"position":{"start":{"line":162,"column":91,"offset":9585},"end":{"line":162,"column":122,"offset":9616},"indent":[]}}],"position":{"start":{"line":160,"column":1,"offset":9292},"end":{"line":162,"column":122,"offset":9616},"indent":[1,1]}},{"type":"code","lang":"js","meta":null,"value":"componentDidMount() {\n  this.ws.on( `founded game`, gameData => {\n  this.ws.on( `board update`, boardData => {\n  this.ws.on( `move`, moveData => {\n\n  this.ws.emit( `searchGame`, { square:9 } )\n  setInterval( () => this.ws.emit( `move`, this.player?.boardId ), 1000 )\n\n  window.game = this\n}","position":{"start":{"line":164,"column":1,"offset":9620},"end":{"line":175,"column":4,"offset":9931},"indent":[1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Co prawda teraz przy wpisywaniu powyższego listingu pomyślałem o tym aby wpisać na początku\n","position":{"start":{"line":177,"column":1,"offset":9935},"end":{"line":178,"column":1,"offset":10028},"indent":[1]}},{"type":"inlineCode","value":"const { ws } = this","position":{"start":{"line":178,"column":1,"offset":10028},"end":{"line":178,"column":22,"offset":10049},"indent":[]}},{"type":"text","value":" albo aby metody ","position":{"start":{"line":178,"column":22,"offset":10049},"end":{"line":178,"column":39,"offset":10066},"indent":[]}},{"type":"inlineCode","value":"ws","position":{"start":{"line":178,"column":39,"offset":10066},"end":{"line":178,"column":43,"offset":10070},"indent":[]}},{"type":"text","value":" zwracały swój kontekst\naby można było łańcuchowo używać kolejnych metod. Cóż, moze później.","position":{"start":{"line":178,"column":43,"offset":10070},"end":{"line":179,"column":69,"offset":10163},"indent":[1]}}],"position":{"start":{"line":177,"column":1,"offset":9935},"end":{"line":179,"column":69,"offset":10163},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"./plansza.png","alt":"Wynik tego, co udało mi się zrobić na froncie","position":{"start":{"line":181,"column":1,"offset":10167},"end":{"line":181,"column":64,"offset":10230},"indent":[]}}],"position":{"start":{"line":181,"column":1,"offset":10167},"end":{"line":181,"column":64,"offset":10230},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Mając planszę kolej przyszła na graczy -- skaczące prostopadłościany.\nZrobienie jednego gracza to bułka z masłem -- informacja do serwera, że chcę skoczyć,\n\"rzut kością\" i wysolosowanie nowej pozycji, ","position":{"start":{"line":183,"column":1,"offset":10234},"end":{"line":185,"column":46,"offset":10437},"indent":[1,1]}},{"type":"inlineCode","value":"socket.emit","position":{"start":{"line":185,"column":46,"offset":10437},"end":{"line":185,"column":59,"offset":10450},"indent":[]}},{"type":"text","value":" do clienta, i ustawienie pozycji. Łatwe.","position":{"start":{"line":185,"column":59,"offset":10450},"end":{"line":185,"column":100,"offset":10491},"indent":[]}}],"position":{"start":{"line":183,"column":1,"offset":10234},"end":{"line":185,"column":100,"offset":10491},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Problem jednak zaczął się przy komunikacji większej ilości graczy.\nTo jest moment który mnie zdemotywował do dalszego działania.\nKtoś mógłby powiedzieć \"No przecieć to to samo co dla jednego, tylko że dla wielu\".\nW skrócie tak, to prawda. Obsługa wielu graczy różniłaby się od wersji z pojedynczym graczem tym,\nże wiadomość o skoku konkretnego gracza należałoby \"broadcastować\".","position":{"start":{"line":187,"column":1,"offset":10495},"end":{"line":191,"column":68,"offset":10877},"indent":[1,1,1,1]}}],"position":{"start":{"line":187,"column":1,"offset":10495},"end":{"line":191,"column":68,"offset":10877},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Problem w tym, że zrobienie tego nie jest takie oczywiste. Koncepcyjnie to serwer powinien móc\nwysyłać wiadomości do socketów. W zwiazku z tym, jako że broadcast nomen omen musi komunikować się ze wszystkimi,\nto umieszczenie metody ","position":{"start":{"line":193,"column":1,"offset":10881},"end":{"line":195,"column":24,"offset":11115},"indent":[1,1]}},{"type":"inlineCode","value":"broadcast","position":{"start":{"line":195,"column":24,"offset":11115},"end":{"line":195,"column":35,"offset":11126},"indent":[]}},{"type":"text","value":" w strukturze (albo rustowo -- w cesze(?)) kontrolera WebSocket jest racjonalne.\nCo dalej? Cóż. Programista JSa dałby zwykłą referencję w sockecie do tejze metody. W C++ dałoby radę wskaźnikiem.\nTutaj? Mhmm. Nie chcę używać ","position":{"start":{"line":195,"column":35,"offset":11126},"end":{"line":197,"column":30,"offset":11352},"indent":[1,1]}},{"type":"inlineCode","value":"unsafe","position":{"start":{"line":197,"column":30,"offset":11352},"end":{"line":197,"column":38,"offset":11360},"indent":[]}},{"type":"text","value":" kodu, więc pominę takie elementy.","position":{"start":{"line":197,"column":38,"offset":11360},"end":{"line":197,"column":72,"offset":11394},"indent":[]}}],"position":{"start":{"line":193,"column":1,"offset":10881},"end":{"line":197,"column":72,"offset":11394},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"W pierwszym podejściu wydzieliłem ","position":{"start":{"line":199,"column":1,"offset":11398},"end":{"line":199,"column":35,"offset":11432},"indent":[]}},{"type":"inlineCode","value":"receiver","position":{"start":{"line":199,"column":35,"offset":11432},"end":{"line":199,"column":45,"offset":11442},"indent":[]}},{"type":"text","value":" ze struktury socketa i bezpośrednio jego wrzuciłem w loop obsługi zdarzeń.\nZrobiłem to dlatego, ponieważ w czasie broadcastowania iterowanie po wszystkich socketach i ich ","position":{"start":{"line":199,"column":45,"offset":11442},"end":{"line":200,"column":97,"offset":11615},"indent":[1]}},{"type":"inlineCode","value":"lock","position":{"start":{"line":200,"column":97,"offset":11615},"end":{"line":200,"column":103,"offset":11621},"indent":[]}},{"type":"text","value":"owanie\nbardzo szybko doprowadzało do ","position":{"start":{"line":200,"column":103,"offset":11621},"end":{"line":201,"column":31,"offset":11659},"indent":[1]}},{"type":"link","title":null,"url":"https://pl.wikipedia.org/wiki/Zakleszczenie","children":[{"type":"text","value":"zatrzasku (deadlocka)","position":{"start":{"line":201,"column":32,"offset":11660},"end":{"line":201,"column":53,"offset":11681},"indent":[]}}],"position":{"start":{"line":201,"column":31,"offset":11659},"end":{"line":201,"column":99,"offset":11727},"indent":[]}},{"type":"text","value":" gdy odbiorca był w strukturze.\nSprawa była oczywista:","position":{"start":{"line":201,"column":99,"offset":11727},"end":{"line":202,"column":23,"offset":11782},"indent":[1]}}],"position":{"start":{"line":199,"column":1,"offset":11398},"end":{"line":202,"column":23,"offset":11782},"indent":[1,1,1]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Na serwerze znajdują się 2 sockety;","position":{"start":{"line":203,"column":5,"offset":11788},"end":{"line":203,"column":40,"offset":11823},"indent":[]}}],"position":{"start":{"line":203,"column":5,"offset":11788},"end":{"line":203,"column":40,"offset":11823},"indent":[]}}],"position":{"start":{"line":203,"column":1,"offset":11784},"end":{"line":203,"column":40,"offset":11823},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Oba są stale używane przez swój wątek, ponieważ nasłuchują zdarzenia;","position":{"start":{"line":204,"column":5,"offset":11829},"end":{"line":204,"column":74,"offset":11898},"indent":[]}}],"position":{"start":{"line":204,"column":5,"offset":11829},"end":{"line":204,"column":74,"offset":11898},"indent":[]}}],"position":{"start":{"line":204,"column":1,"offset":11825},"end":{"line":204,"column":74,"offset":11898},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Jeden z nich chce nadać wiadomość broadcast, więc musi przechwycić ","position":{"start":{"line":205,"column":5,"offset":11904},"end":{"line":205,"column":72,"offset":11971},"indent":[]}},{"type":"inlineCode","value":"sender","position":{"start":{"line":205,"column":72,"offset":11971},"end":{"line":205,"column":80,"offset":11979},"indent":[]}},{"type":"text","value":" drugiego;","position":{"start":{"line":205,"column":80,"offset":11979},"end":{"line":205,"column":90,"offset":11989},"indent":[]}}],"position":{"start":{"line":205,"column":5,"offset":11904},"end":{"line":205,"column":90,"offset":11989},"indent":[]}}],"position":{"start":{"line":205,"column":1,"offset":11900},"end":{"line":205,"column":90,"offset":11989},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Operacja kończy się zakleszczeniem, ponieważ drugi nigdy nie odda socketu, a pierwszy nie odpuści oczekiwania.","position":{"start":{"line":206,"column":5,"offset":11995},"end":{"line":206,"column":115,"offset":12105},"indent":[]}}],"position":{"start":{"line":206,"column":5,"offset":11995},"end":{"line":206,"column":115,"offset":12105},"indent":[]}}],"position":{"start":{"line":206,"column":1,"offset":11991},"end":{"line":206,"column":115,"offset":12105},"indent":[]}}],"position":{"start":{"line":203,"column":1,"offset":11784},"end":{"line":206,"column":115,"offset":12105},"indent":[1,1,1]}},{"type":"code","lang":"rust","meta":null,"value":"let socket_mutex = Arc::new( Mutex::new( Socket::new( ws_stream, broadcast_adapter ) ) );\nlet mut socket = socket_mutex.lock().await;\n\nloop {\n  let msg = socket.wait_for_message().await;\n\n  ...","position":{"start":{"line":208,"column":1,"offset":12109},"end":{"line":216,"column":4,"offset":12322},"indent":[1,1,1,1,1,1,1,1]}},{"type":"code","lang":"rust","meta":null,"value":"let (sink, mut stream) = ws_stream.split();\nlet socket_mutex = Arc::new( Mutex::new( Socket::new( sink, broadcast_adapter ) ) );\n\nloop {\n  let msg = stream.next().await.unwrap().unwrap();\n  let mut socket = socket_mutex.lock().await;\n\n  ...","position":{"start":{"line":218,"column":1,"offset":12326},"end":{"line":227,"column":4,"offset":12587},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Wydzielając odbiorcę ze struktury socketu wyeliminowałem ten problem, lecz szybko pojawił się następny.\nNikt/nic (lekko upraszczając) nie ma wpływu na to, kiedy procesor uzna, że czas pracy wątku się skończył\ni kolej jest na następny. W związku z tym doszło do sytuacji przedstawionej na screenie poniżej:","position":{"start":{"line":229,"column":1,"offset":12591},"end":{"line":231,"column":97,"offset":12898},"indent":[1,1]}}],"position":{"start":{"line":229,"column":1,"offset":12591},"end":{"line":231,"column":97,"offset":12898},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"./zakleszczenie.png","alt":"Przykład zakleszczenia. Jeden kolor = działania jednego socketu","position":{"start":{"line":233,"column":1,"offset":12902},"end":{"line":233,"column":88,"offset":12989},"indent":[]}}],"position":{"start":{"line":233,"column":1,"offset":12902},"end":{"line":233,"column":88,"offset":12989},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Normalnie powinien tam wystąpić jeszcze log ","position":{"start":{"line":235,"column":1,"offset":12993},"end":{"line":235,"column":45,"offset":13037},"indent":[]}},{"type":"inlineCode","value":"end of lock <id>","position":{"start":{"line":235,"column":45,"offset":13037},"end":{"line":235,"column":63,"offset":13055},"indent":[]}},{"type":"text","value":" lecz nie wystąpił.\nW tym przypadku deadlock pojawił się w podobnej sytuacji co przed zmianami --\npo zablokowaniu dostępu do obu socketów i próbie wzajemnego dostępu do siebie.","position":{"start":{"line":235,"column":63,"offset":13055},"end":{"line":237,"column":79,"offset":13233},"indent":[1,1]}}],"position":{"start":{"line":235,"column":1,"offset":12993},"end":{"line":237,"column":79,"offset":13233},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Drugie podejście zakładało stworzenie kanału, którym mógłbym komunikować sockety\ni stworzonego specjalnie osobnego ","position":{"start":{"line":239,"column":1,"offset":13237},"end":{"line":240,"column":35,"offset":13353},"indent":[1]}},{"type":"inlineCode","value":"taska","position":{"start":{"line":240,"column":35,"offset":13353},"end":{"line":240,"column":42,"offset":13360},"indent":[]}},{"type":"text","value":" tokio którego jedynym zadaniem byłoby\nnasłuchiwanie przychodzących żądań broadcastu.\nTo sprawiłoby, że żaden socket niemiałby nic wspólnego z jakimkolwiek innym socketem.\nW założeniach brzmiało pięknie, lecz zidentyfikowałem jakiś nieznany mi błąd,\nktóry zupełnie psuł poprawne działanie. Przykra sprawa ;/","position":{"start":{"line":240,"column":42,"offset":13360},"end":{"line":244,"column":58,"offset":13671},"indent":[1,1,1,1]}}],"position":{"start":{"line":239,"column":1,"offset":13237},"end":{"line":244,"column":58,"offset":13671},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"emphasis","children":[{"type":"text","value":"Dzień później","position":{"start":{"line":246,"column":2,"offset":13676},"end":{"line":246,"column":15,"offset":13689},"indent":[]}}],"position":{"start":{"line":246,"column":1,"offset":13675},"end":{"line":246,"column":16,"offset":13690},"indent":[]}},{"type":"break","position":{"start":{"line":246,"column":16,"offset":13690},"end":{"line":247,"column":1,"offset":13694},"indent":[1]}},{"type":"text","value":"Lekko zrezygnowany i chcący zabrać się za coś innego spróbowałem dowiedzieć się co może być nie tak.\nCo ciekawe, problem leżał w ","position":{"start":{"line":247,"column":1,"offset":13694},"end":{"line":248,"column":29,"offset":13824},"indent":[1]}},{"type":"inlineCode","value":"block_on( self.sink.send( message ) )","position":{"start":{"line":248,"column":29,"offset":13824},"end":{"line":248,"column":68,"offset":13863},"indent":[]}},{"type":"text","value":" -- blokowaniu emitera wiadomości socketu.\nTak jakby przy broadcastowaniu się nagle blokował (bo problem dotyczył tylko broadcastu).\nPrzy czym operacja dobiega końca -- wiem to, ponieważ skorzystałem z niezawodnego debugowania ","position":{"start":{"line":248,"column":68,"offset":13863},"end":{"line":250,"column":95,"offset":14092},"indent":[1,1]}},{"type":"inlineCode","value":"println","position":{"start":{"line":250,"column":95,"offset":14092},"end":{"line":250,"column":104,"offset":14101},"indent":[]}},{"type":"text","value":".\nJak ten problem rozwiązałem? Bardzo słabo:","position":{"start":{"line":250,"column":104,"offset":14101},"end":{"line":251,"column":43,"offset":14146},"indent":[1]}}],"position":{"start":{"line":246,"column":1,"offset":13675},"end":{"line":251,"column":43,"offset":14146},"indent":[1,1,1,1,1]}},{"type":"code","lang":"rust","meta":null,"value":"pub fn emit( &mut self, message:&str ) {\n  let sink_clone = Arc::clone( &self.sink );\n  let message = String::from( message );\n\n  thread::spawn( move || if let Err( err ) = block_on( block_on( sink_clone.lock() ).send( message.into() ) ) {\n    println!( \"Emit error: {}\", err );\n  } );\n}","position":{"start":{"line":253,"column":1,"offset":14150},"end":{"line":262,"column":4,"offset":14458},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Generalnie, to zdaję sobie sprawę z tego, że to wymaga refaktoryzacji.\nPrzy czym aby to zrobić, musiałbym najpewniej napisać serwer http od zera, bez udziału ","position":{"start":{"line":264,"column":1,"offset":14462},"end":{"line":265,"column":88,"offset":14621},"indent":[1]}},{"type":"inlineCode","value":"hyper","position":{"start":{"line":265,"column":88,"offset":14621},"end":{"line":265,"column":95,"offset":14628},"indent":[]}},{"type":"text","value":"a.\nWtedy mógłbym też zrobić nieco bardziej solidny serwer http+ws.\nBrzmi jak dobry plan, ale motywacji jakby nie za dużo (to jest jawna sugestia dla czytelników aby jakoś na mnie wpłynać).","position":{"start":{"line":265,"column":95,"offset":14628},"end":{"line":267,"column":122,"offset":14818},"indent":[1,1]}}],"position":{"start":{"line":264,"column":1,"offset":14462},"end":{"line":267,"column":122,"offset":14818},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"===","position":{"start":{"line":270,"column":1,"offset":14824},"end":{"line":270,"column":4,"offset":14827},"indent":[]}}],"position":{"start":{"line":270,"column":1,"offset":14824},"end":{"line":270,"column":4,"offset":14827},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Jako, że jest to mój projekt rozgrzewkowy do srodowiska, to oczywiście nie wiem czy moje rozwiązanie jest słuszne,\nlecz projektowo uznałem,","position":{"start":{"line":273,"column":1,"offset":14833},"end":{"line":274,"column":25,"offset":14973},"indent":[1]}}],"position":{"start":{"line":273,"column":1,"offset":14833},"end":{"line":274,"column":25,"offset":14973},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"Sama gra raczej nie została przemyślana bardzo dobrze. Ot ","position":{"start":{"line":277,"column":1,"offset":14979},"end":{"line":277,"column":59,"offset":15037},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"po prostu miała działać","position":{"start":{"line":277,"column":61,"offset":15039},"end":{"line":277,"column":84,"offset":15062},"indent":[]}}],"position":{"start":{"line":277,"column":59,"offset":15037},"end":{"line":277,"column":86,"offset":15064},"indent":[]}},{"type":"text","value":".\nDlatego też nie pokusiłem się o najlepsze wzorce, przykładowo ","position":{"start":{"line":277,"column":86,"offset":15064},"end":{"line":278,"column":63,"offset":15129},"indent":[1]}},{"type":"link","title":null,"url":"https://en.wikipedia.org/wiki/Memoization","children":[{"type":"text","value":"memoizacji","position":{"start":{"line":278,"column":64,"offset":15130},"end":{"line":278,"column":74,"offset":15140},"indent":[]}}],"position":{"start":{"line":278,"column":63,"offset":15129},"end":{"line":278,"column":118,"offset":15184},"indent":[]}},{"type":"text","value":"(?)","position":{"start":{"line":278,"column":118,"offset":15184},"end":{"line":278,"column":121,"offset":15187},"indent":[]}}],"position":{"start":{"line":277,"column":1,"offset":14979},"end":{"line":278,"column":121,"offset":15187},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"Nie wykluczam późniejszej dalszej aktualizacji tego kodu, ponieważ myślę, ze może się on komuś przydać.\nSkoro mi się nie udało znaleźć dobrego serwera http+ws i stworzyłem go samemu, to moze ktoś także będzie poszukiwac i tym razem znajdzie ^^.\nPrzy czym zaznaczam, że kod ten wymaga sporo poprawek/usprawnień aby móc z niego swobodnie korzysać. Chociaż może pomogłaby społeczność githuba...","position":{"start":{"line":281,"column":1,"offset":15193},"end":{"line":283,"column":147,"offset":15586},"indent":[1,1]}}],"position":{"start":{"line":281,"column":1,"offset":15193},"end":{"line":283,"column":147,"offset":15586},"indent":[1,1]}},{"type":"export","value":"export const _frontmatter = {\"published\":true,\"title\":\"NieMonopoly\",\"author\":\"Paweł Stolarski\",\"date\":\"2020-09-01T00:00:00.000Z\",\"categories\":[\"Gry\",\"Projekty\",\"Sprawozdania\"],\"tags\":[\"cactu\",\"backend\",\"serwer\",\"rust\",\"react\"],\"sneakPeek\":\"\"}","position":{"start":{"line":285,"column":1,"offset":15588},"end":{"line":285,"column":243,"offset":15830},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":285,"column":243,"offset":15830}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"published\": true,\n  \"title\": \"NieMonopoly\",\n  \"author\": \"Paweł Stolarski\",\n  \"date\": \"2020-09-01T00:00:00.000Z\",\n  \"categories\": [\"Gry\", \"Projekty\", \"Sprawozdania\"],\n  \"tags\": [\"cactu\", \"backend\", \"serwer\", \"rust\", \"react\"],\n  \"sneakPeek\": \"\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Aside = makeShortcode(\"Aside\");\nvar Info = makeShortcode(\"Info\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Zanim podejmie si\\u0119 pisania du\\u017Cego projektu w nowopoznanej technologii,\\nwarto jest (moim zdaniem oczywi\\u015Bcie) zrobi\\u0107 uprzednio jaki\\u015B mniejszy tw\\xF3r (\\\"kalkualtor\\\").\"), mdx(\"p\", null, \"W moim przypadku, du\\u017Cym projektem b\\u0119dzie praca in\\u017Cynierska.\\nMa\\u0142ym za\\u015B, podstawowy backend pod tworzenie gry -- w tym przypadku monopoly.\"), mdx(\"h2\", null, \"Za\\u0142ozenia projektu\"), mdx(\"p\", null, \"Skoro gra ta ma pe\\u0142ni\\u0107 dla mnie rol\\u0119 rozgrzewki i wst\\u0119pu do programowania w j\\u0119zyku Rust,\\nto powinna w sobie zawiera\\u0107 r\\xF3\\u017Cne elementy ucz\\u0105ce korzystania z tego jezyka.\\nNie mo\\u017Ce by\\u0107 to projekt zbyt prosty (alby wr\\u0119cz zbyt trywialny biedny kalkulatorze),\\nponiewa\\u017C takowy nie nauczy mnie nic w tematach \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ownership\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"borrowing\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lifetime\"), \", \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"cokolwiek\"), \".\"), mdx(\"p\", null, \"Postanowi\\u0142em wi\\u0119c zrobi\\u0107 sam backend dla gry jak\\u0105 b\\u0119dzie co\\u015B na wz\\xF3r monopoly.\\nFrontent za\\u015B przygotuj\\u0119 z pomoc\\u0105 aplikacji Reacta. Skoro za\\u015B pojawiaj\\u0105 si\\u0119 poj\\u0119cia \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"frontu\"), \" i \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"backu\"), \",\\nto mo\\u017Cna si\\u0119 \\u0142atwo domy\\u015Ble\\u0107, \\u017Ce \\u017Ce projekt b\\u0119dzie wymaga\\u0107 ruchu sieciowego -- ten\\u017Ce r\\xF3wnie\\u017C napisze w Ruscie.\"), mdx(\"p\", null, \"I to w\\u0142a\\u015Bnie na ruchu sieciowym postanwoi\\u0142em tak na prawd\\u0119 pozosta\\u0107.\\nCelem jest nauczy\\u0107 si\\u0119 porusza\\u0107 po nowym j\\u0119zyku. Tworzenie gry zostawi\\u0119 sobie na inn\\u0105 okazj\\u0119.\\nDoprecyzowujac wi\\u0119c -- chc\\u0119 zbudowa\\u0107 prymitywn\\u0105 wersj\\u0119 serwera http+ws, kt\\xF3ry obs\\u0142ugiwa\\u0142by\\npoprawnie reactowe aplikacje, oraz kt\\xF3ry dostarczy obs\\u0142ugi ws podobnej do biblioteki socket.io.\\nJednak dla prostoty przekazu b\\u0119d\\u0119 u\\u017Cywa\\u0107 s\\u0142owa \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gra\"), \".\"), mdx(\"h2\", null, \"Pocz\\u0105tek prac\"), mdx(\"p\", null, \"Zacz\\u0105\\u0107 nale\\u017Cy od przygotowa\\u0144 \\u015Brodowiska pracy. Podej\\u015B\\u0107 mo\\u017Ce by\\u0107 pare.\\nW jednym podej\\u015Bciu, pliki zar\\xF3wno frantu jak i backendu mog\\u0105 by\\u0107 w jednym folderze.\\nW drugim za\\u015B podej\\u015Bciu, mo\\u017Cna te \\u015Brodowiska rozdzieli\\u0107 -- i ja uwa\\u017Cam, \\u017Ce to podejscie jest lepsze.\\nTrzecim, mog\\u0142aby byc hybryda, pliki wsp\\xF3\\u0142dzielone przez serwer i clienta --\\ntakie rozwi\\u0105zanie mog\\u0142oby si\\u0119 sprawdzi\\u0107 w projektach gdzie \\\"zaplecze\\\" by\\u0142oby tworzone w przyk\\u0142adowo Node.js.\"), mdx(\"p\", null, \"Je\\u015Bli prace nad gr\\u0105 by\\u0142yby prowadzone przez 2 zespo\\u0142y, nie powinny one sobie wchodzi\\u0107 w drog\\u0119.\\nStrony clienta i serwera b\\u0119d\\u0105 tworzone z u\\u017Cyciem zupe\\u0142nie r\\xF3\\u017Cnych technologii i r\\xF3\\u017Cnymi\\npodejsciami do zarz\\u0105dzania plikami. Dodatkowo jestem zdania, \\u017Ce backend powinien by\\u0107 dla frontu\\nskryty za warstw\\u0105 abstrakcji i tak na prawd\\u0119 \\u017Cadna ze stron nie powinna musie\\u0107 wiedzie\\u0107 jak budowana jest ta druga.\\nW zwi\\u0105zku z tym root projektu powinien moim zdaniem wygl\\u0105da\\u0107 mniej wi\\u0119cej tak:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"root/\\n |- backend/\\n |- frontend/\\n  ` readme.md\\n\")), mdx(\"p\", null, \"Po utworzeniu takiej struktury, w folderach \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"backend\"), \" i \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"frontend\"), \" u\\u017Cy\\u0142em polece\\u0144 kolejno \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cargo init\"), \" oraz \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npx create-react-app\"), \".\\nPo tej czynno\\u015Bci otrzyma\\u0142em podstawow\\u0105 struktur\\u0119 dla obu \\u015Brodowisk.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"root/\\n |- backend/\\n |   |- src/\\n |   |- target/\\n |   |- .gitignore\\n |   |- Cargo.lock\\n |    ` Cargo.toml\\n |\\n |- frontend/\\n |   |- build/\\n |   |- node_modules/\\n |   |- publix/\\n |   |- src/\\n |   |- .gitignore\\n |   |- package.json\\n |    ` package-lock.json\\n |\\n  ` readme.md\\n\")), mdx(\"p\", null, \"Z tak\\u0105 baz\\u0105 mo\\u017Cna przyst\\u0105pi\\u0107 do pisania kodu. Od czego jednak zacz\\u0105\\u0107?\"), mdx(\"p\", null, \"Tak jak z ka\\u017Cdym projektem -- moje podej\\u015Bcie jest takie, aby budowa\\u0107 go od og\\xF3\\u0142u do szczeg\\xF3\\u0142u.\\nCo w pierwszej kolejno\\u015Bci powinienem mie\\u0107, aby robi\\u0107 cokolwiek wi\\u0119cej?\\nJak projekt zostanie przedstawiony u\\u017Cytkownikowi? Na czym ca\\u0142y projekt b\\u0119dzie si\\u0119 opiera\\u0107?\\nW obecnym scenariuszu, jest to strona internetowa -- to na niej wszystko b\\u0119dzie si\\u0119 opiera\\u0107.\"), mdx(\"p\", null, \"Jednak wpisanie \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm start\"), \" to w zasadzie nic. Aplikacja Reacta sama stworzy serwer i otworzy stron\\u0119 w przeglaarce.\\nAby podej\\u015B\\u0107 do sprawy sensownie, to pliki powinien serwowa\\u0107 samodzielnie napisany serwer. Pliki -- w\\u0142a\\u015Bnie -- jakie.\\nJako, ze projekt opiera sie na Reakcie, to hostowane pliki najpro\\u015Bciej b\\u0119dzie znale\\u017A\\u0107 w folderze \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"frontend/build/\"), \".\\nMaj\\u0105c to na uwadze, zamiast startowa\\u0107 aplikacj\\u0119, lepiej b\\u0119dzie u\\u017Cy\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm build\"), \".\"), mdx(\"p\", null, \"Kolej nadesz\\u0142a na rozwa\\u017Cania nad serwerem. W tym przypadku, backend ma by\\u0107 jednolity -- nie rozbudowwywalny.\\nPisz\\u0105c to mam na my\\u015Bli to, \\u017Ce ma stanowi\\u0107 jeden zwarty produkt. Nie ma by\\u0107 cz\\u0119\\u015Bci\\u0105 czego\\u015B innego. Taki monolit.\\nNie ma pe\\u0142ni\\u0107 rol\\u0119 modu\\u0142u dla innego projektu. Dodatkowo warto zauwa\\u017Cy\\u0107, \\u017Ce serwer b\\u0119dzie pe\\u0142ni\\u0107 funkcj\\u0119 ca\\u0142ej aplikacji.\\nTo serwer wy\\u015Ble plik strony kt\\xF3r\\u0105 zinterpretuje przegladarka, to serwer przechwyci rz\\u0105danie aktualizacji protoko\\u0142u do WebSocket,\\noraz to serwer b\\u0119dzie odbiera\\u0107 i odpowiada\\u0107 na eventy ws.\"), mdx(\"p\", null, \"Czego by nie zrobi\\u0107 po stronie clienta, to serwer b\\u0119dzie tym zarz\\u0105dza\\u0107. Pomys\\u0142 mam wi\\u0119c taki:\\nw pliku \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"main.rs\"), \", (czyli g\\u0142\\xF3wnym pliku backendu) zaciagna\\u0107 2 modu\\u0142y\\n(bo tak wygl\\u0105da do\\u0142\\u0105czanie innych plik\\xF3w, po prsotu s\\u0105 to modu\\u0142y) odpowiedzialne za serwer, oraz za gr\\u0119.\\nOba te modu\\u0142y zintegruje si\\u0119 w \\\"mainie\\\" tworz\\u0105c struktur\\u0119 serwera, przekazuj\\u0105c jej handler zdarze\\u0144 ws gry, oraz w\\u0142\\u0105czaj\\u0105c serwer.\"), mdx(\"p\", null, mdx(\"del\", {\n    parentName: \"p\"\n  }, \"Zdaj\\u0119 sobie spraw\\u0119 z tego, ze du\\u017Co razy u\\u017Cy\\u0142em s\\u0142owa \", mdx(\"inlineCode\", {\n    parentName: \"del\"\n  }, \"serwer\"), \". Na tym jednak nie koniec.\")), mdx(\"p\", null, \"Frontend z kolei ma pe\\u0142ni\\u0107 jedynie funkcje interpretacyjne tego co dosta\\u0142 z serwera.\\nNie mo\\u017Ce by\\u0107 po stronie clienta zawarta \\u017Cadna logika kt\\xF3ra moze wp\\u0142yn\\u0105\\u0107 na serwer.\\nClient powinien m\\xF3c jedynie wysy\\u0142a\\u0107 sygna\\u0142y \\u017Ce podj\\u0105\\u0142 jakie\\u015B dzia\\u0142ania.\"), mdx(Aside, {\n    mdxType: \"Aside\"\n  }, \"Oczywi\\u015Bcie jest to spore uproszczenie. Client co prawda nie powinien wykonywac logiki, kt\\xF3ra wp\\u0142wya\\u0142aby na serwer, lecz powinien wykopnywa\\u0107 logik\\u0119 wp\\u0142ywajac\\u0105 na samego siebie. Jest to bardzo pomocne przy pracy z interfejsami sieciowymi. Umo\\u017Cliwia eliminacj\\u0119 lag\\xF3w.\"), mdx(\"p\", null, \"Do rysowania planszy najpro\\u015Bciej b\\u0119dzie wykorzysta\\u0107 \\\"no\\u0142dowe\\\" (node-owe(?)) modu\\u0142y \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"react-three-fiber\"), \" oraz \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"drei\"), \".\\nModu\\u0142y te dostarczaj\\u0105 kolejnej niesamowitej warstwy abstrakcji do abstrakcji dostarczanej przez three.js,\\nkt\\xF3re z kolei dostarcza jej dla WebGL dostarczajacego abstrakcji wywo\\u0142aniom systemowym dosta... do\\u015B\\u0107.\\nWa\\u017Cne, \\u017Ce mo\\u017Cna w tej technologii napisa\\u0107 kr\\xF3tki robi\\u0105cy sporo kod daj\\u0105cy w rezultacie ca\\u0142kiem wydajn\\u0105 aplikacj\\u0119.\"), mdx(\"p\", null, \"Warto nadmieni\\u0107, \\u017Ce pomys\\u0142 z organizacj\\u0105 serwera i clienta mo\\u017Cna przedstawi\\u0107 w modelu MVC.\\nNa serwerze nie jest prostym m\\xF3wi\\u0107 o \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"widoku\"), \", lecz za\\u0142\\xF3\\u017Cmy, \\u017Ce jest to spos\\xF3b u\\u017Cywania modu\\u0142\\xF3w w mainie\\n(tak na prawd\\u0119, powinno si\\u0119 na to patrze\\u0107 raczej przez pryzmat odpowiedzi serwera do clienta,\\nlecz w tym opisie ca\\u0142kiem odseparowa\\u0142em backcend od frontendu).\\nKontrolerami b\\u0119d\\u0105 g\\u0142\\xF3wna struktura serwera oraz gry. Oba one przyjmuj\\u0105 informacje i zarz\\u0105dzaj\\u0105 modelami,\\nkt\\xF3rymi s\\u0105 mp. \\\"handler\\\" socket\\xF3w oraz plansza gry.\\nPo stronie clienta za\\u015B komponentem widoku b\\u0119dzie jednocze\\u015Bnie kontrolerem.\\nPlik \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"App.js\"), \" b\\u0119dzie widokiem poniewa\\u017C b\\u0119dzie defniowa\\u0107 szkielet i styl aplikacji poprzez metod\\u0119 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"render\"), \",\\noraz kontrolerem poniewa\\u017C b\\u0119dzie zarz\\u0105dza\\u0144 po\\u0142\\u0105czeniami ws jak i b\\u0119dzie konfigurowa\\u0107 ustawienia innych mod\\xF3\\u0142\\xF3w.\\nZa model b\\u0119dzie odpowiada\\u0107 przyk\\u0142adowo \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Tile.js\"), \" odpowiedzialny za pojedynczy kafelek gry.\\nZdaj\\u0119 sobie oczywi\\u015Bcie spraw\\u0119 z tego, \\u017Ce nie ejst to wzorcowe podejscie.\\nUwa\\u017Cam jednak, \\u017Ce jest to podejscie wystarczajaco dobre dla ma\\u0142ej, skromnej aplikacji -- warto przypomnie\\u0107,\\n\\u017Ce koniec ko\\u0144c\\xF3w to nie b\\u0119dzie gra. Front b\\u0119dzie tu jedynie pe\\u0142ni\\u0107 podstawowe dzia\\u0142ania komunikacyjne z serwerem.\"), mdx(Info, {\n    mdxType: \"Info\"\n  }, \"Dalsz\\u0105 cz\\u0119\\u015B\\u0107 wpisu b\\u0119d\\u0119 kontynuowa\\u0107 w czasie przesz\\u0142ym -- tekst do tego momentu by\\u0142 wst\\u0119pem organizacyjnym pisanym przed przyst\\u0105pieniem do pracy a jego dalsze cz\\u0119\\u015Bci zosta\\u0142y napisane juz po fakcie.\"), mdx(\"h2\", null, \"To samo s\\u0142odkie, czyli tworzenie -- ale w skr\\xF3cie\"), mdx(\"p\", null, \"Znalezienie lekkiej i dobrze dzia\\u0142aj\\u0105cej biblioteki/frameworka dla ruchu http+ws nie jest proste.\\nBiblioteki g\\u0142\\xF3wnie obs\\u0142uguj\\u0105 tylko jeden z tych ruch\\xF3w sieciowych.\\nTak dla przyk\\u0142adu \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/hyper/0.13.7/hyper/\"\n  }), \"hyper\"), \" obs\\u0142uguje ruch http,\\nlecz taki \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/ws/0.9.1/ws/\"\n  }), \"ws\"), \" jak nazwa wskazuje potrafi zapanowa\\u0107 tylko nad websocketami.\\nTo mo\\u017Ce \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://actix.rs/\"\n  }), \"Actix\"), \"? Potrafi obs\\u0142ugiwa\\u0107 oba ruchy. Jest to prawd\\u0105, lecz podobnie jak \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://rocket.rs/\"\n  }), \"Rocket\"), \"\\nprzeznacozny na ten czas jedynie do http, Actix jest \\\"kombajnem\\\". Albo inaczej --\\nframeworki te dostarczaj\\u0105 takiej abstrakcji, \\u017Ce nienauczy\\u0142ym si\\u0119 z nich Rusta samego w sobie, czyli tego na czym mi zale\\u017Cy.\\nZnalezione rozwi\\u0105zanie? U\\u017Cy\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"hyper\"), \" wraz z \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/tokio-tungstenite/0.11.0/tokio_tungstenite/\"\n  }), \"tokio_tungstenite\"), \".\\nDodatkowo (jak z nazwy tego drugiego wynika) trzeba zaci\\u0105gna\\u0107 \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/tokio/0.2.22/tokio/\"\n  }), \"tokio\"), \", lecz to nie problem -- nawet wskazane.\\nSkoro tokio, to tak\\u017Ce \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/futures/0.3.5/futures/\"\n  }), \"futures\"), \".\\nJako, \\u017Ce do stworzenia aktualizacji protoko\\u0142u potrzebne s\\u0105 szyfrowanie \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/sha-1/0.9.1/sha1/\"\n  }), \"sha-1\"), \"\\noraz kodowanie \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.rs/base64/0.12.3/base64/\"\n  }), \"bash64\"), \" to je takze nale\\u017Ca\\u0142o zaci\\u0105gna\\u0107 z sieci.\"), mdx(\"p\", null, \"Dysponuj\\u0105c tymi paczkami stworzy\\u0142em serwer http+ws pisz\\u0105c aktualizacj\\u0119 protoko\\u0142u jak i przechowywanie socket\\xF3w samodzielnie.\\nCiekawa rzecz, chcia\\u0142em si\\u0119 tego nauczy\\u0107 lecz bez jakiego\\u015B du\\u017Cego ci\\u015Bnienia i teraz mia\\u0142em okazj\\u0119 to zrobi\\u0107.\\nW celu zrobienia tego poprawnie przydatnym \\u017Ar\\xF3d\\u0142em okaza\\u0142 si\\u0119 \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers\"\n  }), \"MDN\"), \".\"), mdx(\"p\", null, mdx(\"figure\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"873px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/b680064ca8dd95ecb7572bff12c1d73a/35751/mime_types.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"159.2%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAAA7CAAAOwgEVKEqAAAAFEklEQVRIx3VW6VobRxDUI8SAtPcxe9+nLpABOwbbSX7l/R+mUj2LQWDlR3+zWu30VndV1+wqzQukZYe66zEMLbq2QtNPaMcJQ12g7jtkeYk0yZBlGTzPg2lasCxbh1x7no+mafX/K2NjwLB8FP2Aqq1Rdg3SukFStQijAI7twHEcvcnm9Xq9wYZ7ljCxvlnDD0J8f37Ccb/HSt7i2i6KrCOKGC43Wty44cb3m5cwDPNdyDN+EODb01fsdjusBLIkdC0XJldBIy+RzeuzOE9ynlhebDsuDocZWZpgZdtE6Cqk8xcURYkijRGEClEYQrkuYt9DyPVGEJ+hPF9NAuj6Cp5rYyU92hBZfPsDc1Ug8lyW7KJMU9xWKe7qHNsiRaECpIEP8yNCScgcIwkNuFcnNFiumu4xlDkS2SQ9ZT+3eYwxizEwjmWGQ5nqpIL2Y8K+rxG4DhOyZ4btIbn7iQNZLlQI2/VRUwKnOiPKDHkYwOdzErZlXUTYdzW5YMkuH9oQYXJ8xsSSFXtmO55GKMn2RNbE7Cn1Z5HA9aUeMuEw1PA956Vk04ZqOxR5BKV83eQw9FHlinIiYs+G8QHV2/XmtYeeIwjJoCRM5plqTzkVSuswjkL0TYympjYDEfRlHb4iZA91QkeXzATbE3qWGKtF2GkcYSpJSpmgyyJNli6ZiV+DyW5uNrqiti8pv5ceGmQ12n7BWCwsWxRqmSTYZsJ0gjFdVgkhSPQp2pRVZOa6HhE28IVlaWSchCgf/sHd1KPKUoSKyNoGjyNjavHAtSsy1HkGxbmNGOol5FpmeRG2lg17KCVPO1QsT72ULD0c6wQty06SgH10dRimqU1hYywhZcvzuuS3HhL67hvmskDiS8mUTRxjx5JHysdjjzQp69+NQmZZSNmOvW7DwjIRJrs7DC17GAdMSFKSCHNDQqqYQx8gj8XK7N+YXmbZwY7titn/Fx1aiDglaaHghXQdToNPgZf8XZYKQeTB8alFy7xsDswxjfRP330TdtT3dJuITuNpGUQ0g5oJK4byF0alHRdHjwi3c6cltxLK5Y+kz5E1CmHia4QeCchqTkpHDRahvmdenJQloSBU/pnbaB3SbURnDs0hJyn7IsEs+uOasT+a3Yt+KKPXLCUvo8ceNhkPKyKMvaWHgYesDJFXRMko6wi+ci+Tci4bXTITJn2BvGEPfyVkL6su1iUHuY+woIXF7uWSf5GiDVZ0KG4z7NDQQBUTiVAjlj5T2HWmYDoWPdL6UOr7Hs5jp61v5RGhOLSYw9gQZaL0oSNny8TJmesUO7ZD0c5kSuRQOw9JKrMv9uWLsE3DwNXaRHj8iS1JUezD2rBoDjFORYwDj4Ej14Rz+senK1xdXb+LT7wnR0LLjwLL2GA1TzPGeYfTz3/x/PiA28MB83aHh9Md/n78jB/3n/F8f8LD8chzY8TIL4rXmJZ14v6/vvOg322xqusaSVZgePgTh92EuippsgWmocfn/YAT47jtcX8cMdF5Up41afoWSZLqT5UvfGnHvZrla35OhHTmqPDhhjZLWNP2LaQVj846QMz7ceIhUOKdBq6vb15DyhaVzHPP6QrFDylY0SFHr6RVqWg5U4SEMl9GTyLmb0/O8P/5FPn69IitlBzSHMWu/LynW4d6k0PUMikTmR4YOTcEZNDmiwzjPcsiG/nSeHr+iv2e3zbyVRVFEc/UJZHLsZN752Hzvozjpf/kniRs2pYVVvgPBS5z3iJRY7oAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"BARDZO długa lista typów MIME\",\n    \"title\": \"BARDZO długa lista typów MIME\",\n    \"src\": \"/static/b680064ca8dd95ecb7572bff12c1d73a/35751/mime_types.png\",\n    \"srcSet\": [\"/static/b680064ca8dd95ecb7572bff12c1d73a/63868/mime_types.png 250w\", \"/static/b680064ca8dd95ecb7572bff12c1d73a/0b533/mime_types.png 500w\", \"/static/b680064ca8dd95ecb7572bff12c1d73a/35751/mime_types.png 873w\"],\n    \"sizes\": \"(max-width: 873px) 100vw, 873px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }), \"BARDZO d\\u0142uga lista typ\\xF3w MIME\"), \"\\n  \")), mdx(\"p\", null, \"Jednakowo\\u017C na pocz\\u0105tku nie zaimplementowa\\u0142em rozg\\u0142aszania broadcast. Jest ono na tyle nietypowym przypadkiem,\\n\\u017Ce poza samym socketem wymaga dost\\u0119pu do wszystkich innych. Tak wi\\u0119c sam socket powinien mie\\u0107 jaki\\u015B\\nbez- lub po\\u015Bredni dost\\u0119p do wektora wszystkich innych socket\\xF3w.\"), mdx(\"p\", null, \"Zabra\\u0142em si\\u0119 wi\\u0119c do frontu. W pierwszej kolejnosci posz\\u0142o \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm i three.js react-three.fiber drei\"), \".\\nW zasadzie front nie jest niczym nadzwyczajnym. Ot zale\\u017Ca\\u0142o mi na wy\\u015Bwietlaniu element\\xF3w na ekranie.\\nNajwa\\u017Cniejszym jednak by\\u0142 dla mnie kontroler WebSocket -- chia\\u0142em aby dzia\\u0142a\\u0142 podobnie co \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://socket.io/\"\n  }), \"socket.io\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"componentDidMount() {\\n  this.ws.on( `founded game`, gameData => {\\n  this.ws.on( `board update`, boardData => {\\n  this.ws.on( `move`, moveData => {\\n\\n  this.ws.emit( `searchGame`, { square:9 } )\\n  setInterval( () => this.ws.emit( `move`, this.player?.boardId ), 1000 )\\n\\n  window.game = this\\n}\\n\")), mdx(\"p\", null, \"Co prawda teraz przy wpisywaniu powy\\u017Cszego listingu pomy\\u015Bla\\u0142em o tym aby wpisa\\u0107 na pocz\\u0105tku\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"const { ws } = this\"), \" albo aby metody \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ws\"), \" zwraca\\u0142y sw\\xF3j kontekst\\naby mo\\u017Cna by\\u0142o \\u0142a\\u0144cuchowo u\\u017Cywa\\u0107 kolejnych metod. C\\xF3\\u017C, moze p\\xF3\\u017Aniej.\"), mdx(\"p\", null, mdx(\"figure\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1000px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/bcc5603e8f33c95ef6056539ab3f6276/1f05d/plansza.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"37.2%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABtklEQVQY0wGrAVT+ABYaImRVQqSOeZeRlp+ZlpeRjp+ak5iCY0E6NBsdJCMkKCMjJyMjJyQkKCMkJyMjJiQlKCIjJyIjJyEiJgASFBuDe2zdwpyki4OsqW+lpmq3pm/cv5pNS0kYGh8kJSgbHCIVGR4VFiAbFyYfGygVGCAZHCEhIiYlJSkAFBUYd3h9vsaBT7wkQMQwP8kuW54vy7SfREtPHBwfHh8lQj85Z1VXdGNUc3xKeH9MbmBSOjQ3HB0hGBshABITF4B/gcPMi0fBLkjNOT/RN1emOdS9pkhNURsbHx8gI6yppba8hknBNErbME/UL5LNU9vKk7SplG1eTQAUFRl6en29x4Y4vi0/zzQ00jROpDbPtqFHTVEWFho1ODrOzsm5toNtrEih2nfF26LFz7OlpppuamM5NDEAExUZfHh3zMuIfbVAgbxHcrpHh6hI0LibSUxNEBMZZFtQz7SO3baC4tG4y8LFj4aJTERHHRodExQYGh0jABQYIHpnUc+3j8G6o8S7pr2zn8jApMKlfE1EPBAVHq6Sb+e+ia2QbGhcUDIvLxUTFBcXGyAiJiQlKSIjJtnAoNvgtNguAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Wynik tego, co udało mi się zrobić na froncie\",\n    \"title\": \"Wynik tego, co udało mi się zrobić na froncie\",\n    \"src\": \"/static/bcc5603e8f33c95ef6056539ab3f6276/00d43/plansza.png\",\n    \"srcSet\": [\"/static/bcc5603e8f33c95ef6056539ab3f6276/63868/plansza.png 250w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/0b533/plansza.png 500w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/00d43/plansza.png 1000w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/aa440/plansza.png 1500w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/e8950/plansza.png 2000w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/1f05d/plansza.png 2273w\"],\n    \"sizes\": \"(max-width: 1000px) 100vw, 1000px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }), \"Wynik tego, co uda\\u0142o mi si\\u0119 zrobi\\u0107 na froncie\"), \"\\n  \")), mdx(\"p\", null, \"Maj\\u0105c plansz\\u0119 kolej przysz\\u0142a na graczy -- skacz\\u0105ce prostopad\\u0142o\\u015Bciany.\\nZrobienie jednego gracza to bu\\u0142ka z mas\\u0142em -- informacja do serwera, \\u017Ce chc\\u0119 skoczy\\u0107,\\n\\\"rzut ko\\u015Bci\\u0105\\\" i wysolosowanie nowej pozycji, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"socket.emit\"), \" do clienta, i ustawienie pozycji. \\u0141atwe.\"), mdx(\"p\", null, \"Problem jednak zacz\\u0105\\u0142 si\\u0119 przy komunikacji wi\\u0119kszej ilo\\u015Bci graczy.\\nTo jest moment kt\\xF3ry mnie zdemotywowa\\u0142 do dalszego dzia\\u0142ania.\\nKto\\u015B m\\xF3g\\u0142by powiedzie\\u0107 \\\"No przecie\\u0107 to to samo co dla jednego, tylko \\u017Ce dla wielu\\\".\\nW skr\\xF3cie tak, to prawda. Obs\\u0142uga wielu graczy r\\xF3\\u017Cni\\u0142aby si\\u0119 od wersji z pojedynczym graczem tym,\\n\\u017Ce wiadomo\\u015B\\u0107 o skoku konkretnego gracza nale\\u017Ca\\u0142oby \\\"broadcastowa\\u0107\\\".\"), mdx(\"p\", null, \"Problem w tym, \\u017Ce zrobienie tego nie jest takie oczywiste. Koncepcyjnie to serwer powinien m\\xF3c\\nwysy\\u0142a\\u0107 wiadomo\\u015Bci do socket\\xF3w. W zwiazku z tym, jako \\u017Ce broadcast nomen omen musi komunikowa\\u0107 si\\u0119 ze wszystkimi,\\nto umieszczenie metody \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"broadcast\"), \" w strukturze (albo rustowo -- w cesze(?)) kontrolera WebSocket jest racjonalne.\\nCo dalej? C\\xF3\\u017C. Programista JSa da\\u0142by zwyk\\u0142\\u0105 referencj\\u0119 w sockecie do tejze metody. W C++ da\\u0142oby rad\\u0119 wska\\u017Anikiem.\\nTutaj? Mhmm. Nie chc\\u0119 u\\u017Cywa\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"unsafe\"), \" kodu, wi\\u0119c pomin\\u0119 takie elementy.\"), mdx(\"p\", null, \"W pierwszym podej\\u015Bciu wydzieli\\u0142em \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"receiver\"), \" ze struktury socketa i bezpo\\u015Brednio jego wrzuci\\u0142em w loop obs\\u0142ugi zdarze\\u0144.\\nZrobi\\u0142em to dlatego, poniewa\\u017C w czasie broadcastowania iterowanie po wszystkich socketach i ich \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lock\"), \"owanie\\nbardzo szybko doprowadza\\u0142o do \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://pl.wikipedia.org/wiki/Zakleszczenie\"\n  }), \"zatrzasku (deadlocka)\"), \" gdy odbiorca by\\u0142 w strukturze.\\nSprawa by\\u0142a oczywista:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Na serwerze znajduj\\u0105 si\\u0119 2 sockety;\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Oba s\\u0105 stale u\\u017Cywane przez sw\\xF3j w\\u0105tek, poniewa\\u017C nas\\u0142uchuj\\u0105 zdarzenia;\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Jeden z nich chce nada\\u0107 wiadomo\\u015B\\u0107 broadcast, wi\\u0119c musi przechwyci\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"sender\"), \" drugiego;\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Operacja ko\\u0144czy si\\u0119 zakleszczeniem, poniewa\\u017C drugi nigdy nie odda socketu, a pierwszy nie odpu\\u015Bci oczekiwania.\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-rust\"\n  }), \"let socket_mutex = Arc::new( Mutex::new( Socket::new( ws_stream, broadcast_adapter ) ) );\\nlet mut socket = socket_mutex.lock().await;\\n\\nloop {\\n  let msg = socket.wait_for_message().await;\\n\\n  ...\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-rust\"\n  }), \"let (sink, mut stream) = ws_stream.split();\\nlet socket_mutex = Arc::new( Mutex::new( Socket::new( sink, broadcast_adapter ) ) );\\n\\nloop {\\n  let msg = stream.next().await.unwrap().unwrap();\\n  let mut socket = socket_mutex.lock().await;\\n\\n  ...\\n\")), mdx(\"p\", null, \"Wydzielaj\\u0105c odbiorc\\u0119 ze struktury socketu wyeliminowa\\u0142em ten problem, lecz szybko pojawi\\u0142 si\\u0119 nast\\u0119pny.\\nNikt/nic (lekko upraszczaj\\u0105c) nie ma wp\\u0142ywu na to, kiedy procesor uzna, \\u017Ce czas pracy w\\u0105tku si\\u0119 sko\\u0144czy\\u0142\\ni kolej jest na nast\\u0119pny. W zwi\\u0105zku z tym dosz\\u0142o do sytuacji przedstawionej na screenie poni\\u017Cej:\"), mdx(\"p\", null, mdx(\"figure\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"341px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/5931ce88c61ebce2128625bfe329036c/4c0ad/zakleszczenie.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"27.599999999999998%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABDUlEQVQY013Qb0+CUBQG8Oe2LBEQQeH+49LUoRCYICmiTm2rdKvv/3m69KK5zn47e3a2582BXIHHhKeEPxGRE3UkYQ19VCeEO4gcYXMX7oisQNk9bYf9QVCA7Vu8AT1g9AL/+VcBP4efwF/AX8KfkyDo3Tbb8qzrToUVM2eS2mk8yA2a2JPMjhNzGvfG8+4460xyzJKHOWc8+FeuUa2wqFBkSPeo9lg3qDYoG5R6V1huUZ6wqTul5CKgnN4A7bq1mR36y7f+emOkA8McGpb3aA5Nq+VYntd3R7YX2JQPNKYcqkmHChdMQbxDXiDORB4gX6E+IQvoD+kcXRFdSPRFdAiPCM9QV6gPRN+Q28cfuqsk78TusP4AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Przykład zakleszczenia. Jeden kolor = działania jednego socketu\",\n    \"title\": \"Przykład zakleszczenia. Jeden kolor = działania jednego socketu\",\n    \"src\": \"/static/5931ce88c61ebce2128625bfe329036c/4c0ad/zakleszczenie.png\",\n    \"srcSet\": [\"/static/5931ce88c61ebce2128625bfe329036c/63868/zakleszczenie.png 250w\", \"/static/5931ce88c61ebce2128625bfe329036c/4c0ad/zakleszczenie.png 341w\"],\n    \"sizes\": \"(max-width: 341px) 100vw, 341px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }), \"Przyk\\u0142ad zakleszczenia. Jeden kolor = dzia\\u0142ania jednego socketu\"), \"\\n  \")), mdx(\"p\", null, \"Normalnie powinien tam wyst\\u0105pi\\u0107 jeszcze log \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"end of lock <id>\"), \" lecz nie wyst\\u0105pi\\u0142.\\nW tym przypadku deadlock pojawi\\u0142 si\\u0119 w podobnej sytuacji co przed zmianami --\\npo zablokowaniu dost\\u0119pu do obu socket\\xF3w i pr\\xF3bie wzajemnego dost\\u0119pu do siebie.\"), mdx(\"p\", null, \"Drugie podej\\u015Bcie zak\\u0142ada\\u0142o stworzenie kana\\u0142u, kt\\xF3rym m\\xF3g\\u0142bym komunikowa\\u0107 sockety\\ni stworzonego specjalnie osobnego \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"taska\"), \" tokio kt\\xF3rego jedynym zadaniem by\\u0142oby\\nnas\\u0142uchiwanie przychodz\\u0105cych \\u017C\\u0105da\\u0144 broadcastu.\\nTo sprawi\\u0142oby, \\u017Ce \\u017Caden socket niemia\\u0142by nic wsp\\xF3lnego z jakimkolwiek innym socketem.\\nW za\\u0142o\\u017Ceniach brzmia\\u0142o pi\\u0119knie, lecz zidentyfikowa\\u0142em jaki\\u015B nieznany mi b\\u0142\\u0105d,\\nkt\\xF3ry zupe\\u0142nie psu\\u0142 poprawne dzia\\u0142anie. Przykra sprawa ;/\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Dzie\\u0144 p\\xF3\\u017Aniej\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"Lekko zrezygnowany i chc\\u0105cy zabra\\u0107 si\\u0119 za co\\u015B innego spr\\xF3bowa\\u0142em dowiedzie\\u0107 si\\u0119 co mo\\u017Ce by\\u0107 nie tak.\\nCo ciekawe, problem le\\u017Ca\\u0142 w \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"block_on( self.sink.send( message ) )\"), \" -- blokowaniu emitera wiadomo\\u015Bci socketu.\\nTak jakby przy broadcastowaniu si\\u0119 nagle blokowa\\u0142 (bo problem dotyczy\\u0142 tylko broadcastu).\\nPrzy czym operacja dobiega ko\\u0144ca -- wiem to, poniewa\\u017C skorzysta\\u0142em z niezawodnego debugowania \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"println\"), \".\\nJak ten problem rozwi\\u0105za\\u0142em? Bardzo s\\u0142abo:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-rust\"\n  }), \"pub fn emit( &mut self, message:&str ) {\\n  let sink_clone = Arc::clone( &self.sink );\\n  let message = String::from( message );\\n\\n  thread::spawn( move || if let Err( err ) = block_on( block_on( sink_clone.lock() ).send( message.into() ) ) {\\n    println!( \\\"Emit error: {}\\\", err );\\n  } );\\n}\\n\")), mdx(\"p\", null, \"Generalnie, to zdaj\\u0119 sobie spraw\\u0119 z tego, \\u017Ce to wymaga refaktoryzacji.\\nPrzy czym aby to zrobi\\u0107, musia\\u0142bym najpewniej napisa\\u0107 serwer http od zera, bez udzia\\u0142u \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"hyper\"), \"a.\\nWtedy m\\xF3g\\u0142bym te\\u017C zrobi\\u0107 nieco bardziej solidny serwer http+ws.\\nBrzmi jak dobry plan, ale motywacji jakby nie za du\\u017Co (to jest jawna sugestia dla czytelnik\\xF3w aby jako\\u015B na mnie wp\\u0142yna\\u0107).\"), mdx(\"p\", null, \"===\"), mdx(\"p\", null, \"Jako, \\u017Ce jest to m\\xF3j projekt rozgrzewkowy do srodowiska, to oczywi\\u015Bcie nie wiem czy moje rozwi\\u0105zanie jest s\\u0142uszne,\\nlecz projektowo uzna\\u0142em,\"), mdx(\"p\", null, \"Sama gra raczej nie zosta\\u0142a przemy\\u015Blana bardzo dobrze. Ot \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"po prostu mia\\u0142a dzia\\u0142a\\u0107\"), \".\\nDlatego te\\u017C nie pokusi\\u0142em si\\u0119 o najlepsze wzorce, przyk\\u0142adowo \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/Memoization\"\n  }), \"memoizacji\"), \"(?)\"), mdx(\"p\", null, \"Nie wykluczam p\\xF3\\u017Aniejszej dalszej aktualizacji tego kodu, poniewa\\u017C my\\u015Bl\\u0119, ze mo\\u017Ce si\\u0119 on komu\\u015B przyda\\u0107.\\nSkoro mi si\\u0119 nie uda\\u0142o znale\\u017A\\u0107 dobrego serwera http+ws i stworzy\\u0142em go samemu, to moze kto\\u015B tak\\u017Ce b\\u0119dzie poszukiwac i tym razem znajdzie ^^.\\nPrzy czym zaznaczam, \\u017Ce kod ten wymaga sporo poprawek/usprawnie\\u0144 aby m\\xF3c z niego swobodnie korzysa\\u0107. Chocia\\u017C mo\\u017Ce pomog\\u0142aby spo\\u0142eczno\\u015B\\u0107 githuba...\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"published\": true,\n  \"title\": \"NieMonopoly\",\n  \"author\": \"Paweł Stolarski\",\n  \"date\": \"2020-09-01T00:00:00.000Z\",\n  \"categories\": [\"Gry\", \"Projekty\", \"Sprawozdania\"],\n  \"tags\": [\"cactu\", \"backend\", \"serwer\", \"rust\", \"react\"],\n  \"sneakPeek\": \"\"\n};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n      console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n      return <div {...props}/>\n    };\nconst Aside = makeShortcode(\"Aside\");\nconst Info = makeShortcode(\"Info\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`Zanim podejmie się pisania dużego projektu w nowopoznanej technologii,\nwarto jest (moim zdaniem oczywiście) zrobić uprzednio jakiś mniejszy twór (\"kalkualtor\").`}</p>\n    <p>{`W moim przypadku, dużym projektem będzie praca inżynierska.\nMałym zaś, podstawowy backend pod tworzenie gry -- w tym przypadku monopoly.`}</p>\n    <h2>{`Załozenia projektu`}</h2>\n    <p>{`Skoro gra ta ma pełnić dla mnie rolę rozgrzewki i wstępu do programowania w języku Rust,\nto powinna w sobie zawierać różne elementy uczące korzystania z tego jezyka.\nNie może być to projekt zbyt prosty (alby wręcz zbyt trywialny biedny kalkulatorze),\nponieważ takowy nie nauczy mnie nic w tematach `}<inlineCode parentName=\"p\">{`ownership`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`borrowing`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`lifetime`}</inlineCode>{`, `}<em parentName=\"p\">{`cokolwiek`}</em>{`.`}</p>\n    <p>{`Postanowiłem więc zrobić sam backend dla gry jaką będzie coś na wzór monopoly.\nFrontent zaś przygotuję z pomocą aplikacji Reacta. Skoro zaś pojawiają się pojęcia `}<inlineCode parentName=\"p\">{`frontu`}</inlineCode>{` i `}<inlineCode parentName=\"p\">{`backu`}</inlineCode>{`,\nto można się łatwo domyśleć, że że projekt będzie wymagać ruchu sieciowego -- tenże również napisze w Ruscie.`}</p>\n    <p>{`I to właśnie na ruchu sieciowym postanwoiłem tak na prawdę pozostać.\nCelem jest nauczyć się poruszać po nowym języku. Tworzenie gry zostawię sobie na inną okazję.\nDoprecyzowujac więc -- chcę zbudować prymitywną wersję serwera http+ws, który obsługiwałby\npoprawnie reactowe aplikacje, oraz który dostarczy obsługi ws podobnej do biblioteki socket.io.\nJednak dla prostoty przekazu będę używać słowa `}<inlineCode parentName=\"p\">{`gra`}</inlineCode>{`.`}</p>\n    <h2>{`Początek prac`}</h2>\n    <p>{`Zacząć należy od przygotowań środowiska pracy. Podejść może być pare.\nW jednym podejściu, pliki zarówno frantu jak i backendu mogą być w jednym folderze.\nW drugim zaś podejściu, można te środowiska rozdzielić -- i ja uważam, że to podejscie jest lepsze.\nTrzecim, mogłaby byc hybryda, pliki współdzielone przez serwer i clienta --\ntakie rozwiązanie mogłoby się sprawdzić w projektach gdzie \"zaplecze\" byłoby tworzone w przykładowo Node.js.`}</p>\n    <p>{`Jeśli prace nad grą byłyby prowadzone przez 2 zespoły, nie powinny one sobie wchodzić w drogę.\nStrony clienta i serwera będą tworzone z użyciem zupełnie różnych technologii i różnymi\npodejsciami do zarządzania plikami. Dodatkowo jestem zdania, że backend powinien być dla frontu\nskryty za warstwą abstrakcji i tak na prawdę żadna ze stron nie powinna musieć wiedzieć jak budowana jest ta druga.\nW związku z tym root projektu powinien moim zdaniem wyglądać mniej więcej tak:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`root/\n |- backend/\n |- frontend/\n  \\` readme.md\n`}</code></pre>\n    <p>{`Po utworzeniu takiej struktury, w folderach `}<inlineCode parentName=\"p\">{`backend`}</inlineCode>{` i `}<inlineCode parentName=\"p\">{`frontend`}</inlineCode>{` użyłem poleceń kolejno `}<inlineCode parentName=\"p\">{`cargo init`}</inlineCode>{` oraz `}<inlineCode parentName=\"p\">{`npx create-react-app`}</inlineCode>{`.\nPo tej czynności otrzymałem podstawową strukturę dla obu środowisk.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`root/\n |- backend/\n |   |- src/\n |   |- target/\n |   |- .gitignore\n |   |- Cargo.lock\n |    \\` Cargo.toml\n |\n |- frontend/\n |   |- build/\n |   |- node_modules/\n |   |- publix/\n |   |- src/\n |   |- .gitignore\n |   |- package.json\n |    \\` package-lock.json\n |\n  \\` readme.md\n`}</code></pre>\n    <p>{`Z taką bazą można przystąpić do pisania kodu. Od czego jednak zacząć?`}</p>\n    <p>{`Tak jak z każdym projektem -- moje podejście jest takie, aby budować go od ogółu do szczegółu.\nCo w pierwszej kolejności powinienem mieć, aby robić cokolwiek więcej?\nJak projekt zostanie przedstawiony użytkownikowi? Na czym cały projekt będzie się opierać?\nW obecnym scenariuszu, jest to strona internetowa -- to na niej wszystko będzie się opierać.`}</p>\n    <p>{`Jednak wpisanie `}<inlineCode parentName=\"p\">{`npm start`}</inlineCode>{` to w zasadzie nic. Aplikacja Reacta sama stworzy serwer i otworzy stronę w przeglaarce.\nAby podejść do sprawy sensownie, to pliki powinien serwować samodzielnie napisany serwer. Pliki -- właśnie -- jakie.\nJako, ze projekt opiera sie na Reakcie, to hostowane pliki najprościej będzie znaleźć w folderze `}<inlineCode parentName=\"p\">{`frontend/build/`}</inlineCode>{`.\nMając to na uwadze, zamiast startować aplikację, lepiej będzie użyć `}<inlineCode parentName=\"p\">{`npm build`}</inlineCode>{`.`}</p>\n    <p>{`Kolej nadeszła na rozważania nad serwerem. W tym przypadku, backend ma być jednolity -- nie rozbudowwywalny.\nPisząc to mam na myśli to, że ma stanowić jeden zwarty produkt. Nie ma być częścią czegoś innego. Taki monolit.\nNie ma pełnić rolę modułu dla innego projektu. Dodatkowo warto zauważyć, że serwer będzie pełnić funkcję całej aplikacji.\nTo serwer wyśle plik strony którą zinterpretuje przegladarka, to serwer przechwyci rządanie aktualizacji protokołu do WebSocket,\noraz to serwer będzie odbierać i odpowiadać na eventy ws.`}</p>\n    <p>{`Czego by nie zrobić po stronie clienta, to serwer będzie tym zarządzać. Pomysł mam więc taki:\nw pliku `}<inlineCode parentName=\"p\">{`main.rs`}</inlineCode>{`, (czyli głównym pliku backendu) zaciagnać 2 moduły\n(bo tak wygląda dołączanie innych plików, po prsotu są to moduły) odpowiedzialne za serwer, oraz za grę.\nOba te moduły zintegruje się w \"mainie\" tworząc strukturę serwera, przekazując jej handler zdarzeń ws gry, oraz włączając serwer.`}</p>\n    <p><del parentName=\"p\">{`Zdaję sobie sprawę z tego, ze dużo razy użyłem słowa `}<inlineCode parentName=\"del\">{`serwer`}</inlineCode>{`. Na tym jednak nie koniec.`}</del></p>\n    <p>{`Frontend z kolei ma pełnić jedynie funkcje interpretacyjne tego co dostał z serwera.\nNie może być po stronie clienta zawarta żadna logika która moze wpłynąć na serwer.\nClient powinien móc jedynie wysyłać sygnały że podjął jakieś działania.`}</p>\n    <Aside mdxType=\"Aside\">\n  Oczywiście jest to spore uproszczenie. Client co prawda nie powinien wykonywac logiki, która wpłwyałaby na serwer, lecz powinien wykopnywać logikę wpływajacą na samego siebie. Jest to bardzo pomocne przy pracy z interfejsami sieciowymi. Umożliwia eliminację lagów.\n    </Aside>\n    <p>{`Do rysowania planszy najprościej będzie wykorzystać \"nołdowe\" (node-owe(?)) moduły `}<inlineCode parentName=\"p\">{`react-three-fiber`}</inlineCode>{` oraz `}<inlineCode parentName=\"p\">{`drei`}</inlineCode>{`.\nModuły te dostarczają kolejnej niesamowitej warstwy abstrakcji do abstrakcji dostarczanej przez three.js,\nktóre z kolei dostarcza jej dla WebGL dostarczajacego abstrakcji wywołaniom systemowym dosta... dość.\nWażne, że można w tej technologii napisać krótki robiący sporo kod dający w rezultacie całkiem wydajną aplikację.`}</p>\n    <p>{`Warto nadmienić, że pomysł z organizacją serwera i clienta można przedstawić w modelu MVC.\nNa serwerze nie jest prostym mówić o `}<inlineCode parentName=\"p\">{`widoku`}</inlineCode>{`, lecz załóżmy, że jest to sposób używania modułów w mainie\n(tak na prawdę, powinno się na to patrzeć raczej przez pryzmat odpowiedzi serwera do clienta,\nlecz w tym opisie całkiem odseparowałem backcend od frontendu).\nKontrolerami będą główna struktura serwera oraz gry. Oba one przyjmują informacje i zarządzają modelami,\nktórymi są mp. \"handler\" socketów oraz plansza gry.\nPo stronie clienta zaś komponentem widoku będzie jednocześnie kontrolerem.\nPlik `}<inlineCode parentName=\"p\">{`App.js`}</inlineCode>{` będzie widokiem ponieważ będzie defniować szkielet i styl aplikacji poprzez metodę `}<inlineCode parentName=\"p\">{`render`}</inlineCode>{`,\noraz kontrolerem ponieważ będzie zarządzań połączeniami ws jak i będzie konfigurować ustawienia innych modółów.\nZa model będzie odpowiadać przykładowo `}<inlineCode parentName=\"p\">{`Tile.js`}</inlineCode>{` odpowiedzialny za pojedynczy kafelek gry.\nZdaję sobie oczywiście sprawę z tego, że nie ejst to wzorcowe podejscie.\nUważam jednak, że jest to podejscie wystarczajaco dobre dla małej, skromnej aplikacji -- warto przypomnieć,\nże koniec końców to nie będzie gra. Front będzie tu jedynie pełnić podstawowe działania komunikacyjne z serwerem.`}</p>\n    <Info mdxType=\"Info\">\n  Dalszą część wpisu będę kontynuować w czasie przeszłym --\n  tekst do tego momentu był wstępem organizacyjnym pisanym przed przystąpieniem do pracy\n  a jego dalsze części zostały napisane juz po fakcie.\n    </Info>\n    <h2>{`To samo słodkie, czyli tworzenie -- ale w skrócie`}</h2>\n    <p>{`Znalezienie lekkiej i dobrze działającej biblioteki/frameworka dla ruchu http+ws nie jest proste.\nBiblioteki głównie obsługują tylko jeden z tych ruchów sieciowych.\nTak dla przykładu `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.rs/hyper/0.13.7/hyper/\"\n      }}>{`hyper`}</a>{` obsługuje ruch http,\nlecz taki `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.rs/ws/0.9.1/ws/\"\n      }}>{`ws`}</a>{` jak nazwa wskazuje potrafi zapanować tylko nad websocketami.\nTo może `}<a parentName=\"p\" {...{\n        \"href\": \"https://actix.rs/\"\n      }}>{`Actix`}</a>{`? Potrafi obsługiwać oba ruchy. Jest to prawdą, lecz podobnie jak `}<a parentName=\"p\" {...{\n        \"href\": \"https://rocket.rs/\"\n      }}>{`Rocket`}</a>{`\nprzeznacozny na ten czas jedynie do http, Actix jest \"kombajnem\". Albo inaczej --\nframeworki te dostarczają takiej abstrakcji, że nienauczyłym się z nich Rusta samego w sobie, czyli tego na czym mi zależy.\nZnalezione rozwiązanie? Użyć `}<inlineCode parentName=\"p\">{`hyper`}</inlineCode>{` wraz z `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.rs/tokio-tungstenite/0.11.0/tokio_tungstenite/\"\n      }}>{`tokio_tungstenite`}</a>{`.\nDodatkowo (jak z nazwy tego drugiego wynika) trzeba zaciągnać `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.rs/tokio/0.2.22/tokio/\"\n      }}>{`tokio`}</a>{`, lecz to nie problem -- nawet wskazane.\nSkoro tokio, to także `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.rs/futures/0.3.5/futures/\"\n      }}>{`futures`}</a>{`.\nJako, że do stworzenia aktualizacji protokołu potrzebne są szyfrowanie `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.rs/sha-1/0.9.1/sha1/\"\n      }}>{`sha-1`}</a>{`\noraz kodowanie `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.rs/base64/0.12.3/base64/\"\n      }}>{`bash64`}</a>{` to je takze należało zaciągnać z sieci.`}</p>\n    <p>{`Dysponując tymi paczkami stworzyłem serwer http+ws pisząc aktualizację protokołu jak i przechowywanie socketów samodzielnie.\nCiekawa rzecz, chciałem się tego nauczyć lecz bez jakiegoś dużego ciśnienia i teraz miałem okazję to zrobić.\nW celu zrobienia tego poprawnie przydatnym źródłem okazał się `}<a parentName=\"p\" {...{\n        \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers\"\n      }}>{`MDN`}</a>{`.`}</p>\n    <p><figure parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-figure\",\n        \"style\": {}\n      }}>{`\n    `}<span parentName=\"figure\" {...{\n          \"className\": \"gatsby-resp-image-wrapper\",\n          \"style\": {\n            \"position\": \"relative\",\n            \"display\": \"block\",\n            \"marginLeft\": \"auto\",\n            \"marginRight\": \"auto\",\n            \"maxWidth\": \"873px\"\n          }\n        }}>{`\n      `}<a parentName=\"span\" {...{\n            \"className\": \"gatsby-resp-image-link\",\n            \"href\": \"/static/b680064ca8dd95ecb7572bff12c1d73a/35751/mime_types.png\",\n            \"style\": {\n              \"display\": \"block\"\n            },\n            \"target\": \"_blank\",\n            \"rel\": \"noopener\"\n          }}>{`\n    `}<span parentName=\"a\" {...{\n              \"className\": \"gatsby-resp-image-background-image\",\n              \"style\": {\n                \"paddingBottom\": \"159.2%\",\n                \"position\": \"relative\",\n                \"bottom\": \"0\",\n                \"left\": \"0\",\n                \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAAA7CAAAOwgEVKEqAAAAFEklEQVRIx3VW6VobRxDUI8SAtPcxe9+nLpABOwbbSX7l/R+mUj2LQWDlR3+zWu30VndV1+wqzQukZYe66zEMLbq2QtNPaMcJQ12g7jtkeYk0yZBlGTzPg2lasCxbh1x7no+mafX/K2NjwLB8FP2Aqq1Rdg3SukFStQijAI7twHEcvcnm9Xq9wYZ7ljCxvlnDD0J8f37Ccb/HSt7i2i6KrCOKGC43Wty44cb3m5cwDPNdyDN+EODb01fsdjusBLIkdC0XJldBIy+RzeuzOE9ynlhebDsuDocZWZpgZdtE6Cqk8xcURYkijRGEClEYQrkuYt9DyPVGEJ+hPF9NAuj6Cp5rYyU92hBZfPsDc1Ug8lyW7KJMU9xWKe7qHNsiRaECpIEP8yNCScgcIwkNuFcnNFiumu4xlDkS2SQ9ZT+3eYwxizEwjmWGQ5nqpIL2Y8K+rxG4DhOyZ4btIbn7iQNZLlQI2/VRUwKnOiPKDHkYwOdzErZlXUTYdzW5YMkuH9oQYXJ8xsSSFXtmO55GKMn2RNbE7Cn1Z5HA9aUeMuEw1PA956Vk04ZqOxR5BKV83eQw9FHlinIiYs+G8QHV2/XmtYeeIwjJoCRM5plqTzkVSuswjkL0TYympjYDEfRlHb4iZA91QkeXzATbE3qWGKtF2GkcYSpJSpmgyyJNli6ZiV+DyW5uNrqiti8pv5ceGmQ12n7BWCwsWxRqmSTYZsJ0gjFdVgkhSPQp2pRVZOa6HhE28IVlaWSchCgf/sHd1KPKUoSKyNoGjyNjavHAtSsy1HkGxbmNGOol5FpmeRG2lg17KCVPO1QsT72ULD0c6wQty06SgH10dRimqU1hYywhZcvzuuS3HhL67hvmskDiS8mUTRxjx5JHysdjjzQp69+NQmZZSNmOvW7DwjIRJrs7DC17GAdMSFKSCHNDQqqYQx8gj8XK7N+YXmbZwY7titn/Fx1aiDglaaHghXQdToNPgZf8XZYKQeTB8alFy7xsDswxjfRP330TdtT3dJuITuNpGUQ0g5oJK4byF0alHRdHjwi3c6cltxLK5Y+kz5E1CmHia4QeCchqTkpHDRahvmdenJQloSBU/pnbaB3SbURnDs0hJyn7IsEs+uOasT+a3Yt+KKPXLCUvo8ceNhkPKyKMvaWHgYesDJFXRMko6wi+ci+Tci4bXTITJn2BvGEPfyVkL6su1iUHuY+woIXF7uWSf5GiDVZ0KG4z7NDQQBUTiVAjlj5T2HWmYDoWPdL6UOr7Hs5jp61v5RGhOLSYw9gQZaL0oSNny8TJmesUO7ZD0c5kSuRQOw9JKrMv9uWLsE3DwNXaRHj8iS1JUezD2rBoDjFORYwDj4Ej14Rz+senK1xdXb+LT7wnR0LLjwLL2GA1TzPGeYfTz3/x/PiA28MB83aHh9Md/n78jB/3n/F8f8LD8chzY8TIL4rXmJZ14v6/vvOg322xqusaSVZgePgTh92EuippsgWmocfn/YAT47jtcX8cMdF5Up41afoWSZLqT5UvfGnHvZrla35OhHTmqPDhhjZLWNP2LaQVj846QMz7ceIhUOKdBq6vb15DyhaVzHPP6QrFDylY0SFHr6RVqWg5U4SEMl9GTyLmb0/O8P/5FPn69IitlBzSHMWu/LynW4d6k0PUMikTmR4YOTcEZNDmiwzjPcsiG/nSeHr+iv2e3zbyVRVFEc/UJZHLsZN752Hzvozjpf/kniRs2pYVVvgPBS5z3iJRY7oAAAAASUVORK5CYII=')\",\n                \"backgroundSize\": \"cover\",\n                \"display\": \"block\"\n              }\n            }}></span>{`\n  `}<img parentName=\"a\" {...{\n              \"className\": \"gatsby-resp-image-image\",\n              \"alt\": \"BARDZO długa lista typów MIME\",\n              \"title\": \"BARDZO długa lista typów MIME\",\n              \"src\": \"/static/b680064ca8dd95ecb7572bff12c1d73a/35751/mime_types.png\",\n              \"srcSet\": [\"/static/b680064ca8dd95ecb7572bff12c1d73a/63868/mime_types.png 250w\", \"/static/b680064ca8dd95ecb7572bff12c1d73a/0b533/mime_types.png 500w\", \"/static/b680064ca8dd95ecb7572bff12c1d73a/35751/mime_types.png 873w\"],\n              \"sizes\": \"(max-width: 873px) 100vw, 873px\",\n              \"style\": {\n                \"width\": \"100%\",\n                \"height\": \"100%\",\n                \"margin\": \"0\",\n                \"verticalAlign\": \"middle\",\n                \"position\": \"absolute\",\n                \"top\": \"0\",\n                \"left\": \"0\"\n              },\n              \"loading\": \"lazy\"\n            }}></img>{`\n  `}</a>{`\n    `}</span>{`\n    `}<figcaption parentName=\"figure\" {...{\n          \"className\": \"gatsby-resp-image-figcaption\"\n        }}>{`BARDZO długa lista typów MIME`}</figcaption>{`\n  `}</figure></p>\n    <p>{`Jednakowoż na początku nie zaimplementowałem rozgłaszania broadcast. Jest ono na tyle nietypowym przypadkiem,\nże poza samym socketem wymaga dostępu do wszystkich innych. Tak więc sam socket powinien mieć jakiś\nbez- lub pośredni dostęp do wektora wszystkich innych socketów.`}</p>\n    <p>{`Zabrałem się więc do frontu. W pierwszej kolejnosci poszło `}<inlineCode parentName=\"p\">{`npm i three.js react-three.fiber drei`}</inlineCode>{`.\nW zasadzie front nie jest niczym nadzwyczajnym. Ot zależało mi na wyświetlaniu elementów na ekranie.\nNajważniejszym jednak był dla mnie kontroler WebSocket -- chiałem aby działał podobnie co `}<a parentName=\"p\" {...{\n        \"href\": \"https://socket.io/\"\n      }}>{`socket.io`}</a></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`componentDidMount() {\n  this.ws.on( \\`founded game\\`, gameData => {\n  this.ws.on( \\`board update\\`, boardData => {\n  this.ws.on( \\`move\\`, moveData => {\n\n  this.ws.emit( \\`searchGame\\`, { square:9 } )\n  setInterval( () => this.ws.emit( \\`move\\`, this.player?.boardId ), 1000 )\n\n  window.game = this\n}\n`}</code></pre>\n    <p>{`Co prawda teraz przy wpisywaniu powyższego listingu pomyślałem o tym aby wpisać na początku\n`}<inlineCode parentName=\"p\">{`const { ws } = this`}</inlineCode>{` albo aby metody `}<inlineCode parentName=\"p\">{`ws`}</inlineCode>{` zwracały swój kontekst\naby można było łańcuchowo używać kolejnych metod. Cóż, moze później.`}</p>\n    <p><figure parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-figure\",\n        \"style\": {}\n      }}>{`\n    `}<span parentName=\"figure\" {...{\n          \"className\": \"gatsby-resp-image-wrapper\",\n          \"style\": {\n            \"position\": \"relative\",\n            \"display\": \"block\",\n            \"marginLeft\": \"auto\",\n            \"marginRight\": \"auto\",\n            \"maxWidth\": \"1000px\"\n          }\n        }}>{`\n      `}<a parentName=\"span\" {...{\n            \"className\": \"gatsby-resp-image-link\",\n            \"href\": \"/static/bcc5603e8f33c95ef6056539ab3f6276/1f05d/plansza.png\",\n            \"style\": {\n              \"display\": \"block\"\n            },\n            \"target\": \"_blank\",\n            \"rel\": \"noopener\"\n          }}>{`\n    `}<span parentName=\"a\" {...{\n              \"className\": \"gatsby-resp-image-background-image\",\n              \"style\": {\n                \"paddingBottom\": \"37.2%\",\n                \"position\": \"relative\",\n                \"bottom\": \"0\",\n                \"left\": \"0\",\n                \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABtklEQVQY0wGrAVT+ABYaImRVQqSOeZeRlp+ZlpeRjp+ak5iCY0E6NBsdJCMkKCMjJyMjJyQkKCMkJyMjJiQlKCIjJyIjJyEiJgASFBuDe2zdwpyki4OsqW+lpmq3pm/cv5pNS0kYGh8kJSgbHCIVGR4VFiAbFyYfGygVGCAZHCEhIiYlJSkAFBUYd3h9vsaBT7wkQMQwP8kuW54vy7SfREtPHBwfHh8lQj85Z1VXdGNUc3xKeH9MbmBSOjQ3HB0hGBshABITF4B/gcPMi0fBLkjNOT/RN1emOdS9pkhNURsbHx8gI6yppba8hknBNErbME/UL5LNU9vKk7SplG1eTQAUFRl6en29x4Y4vi0/zzQ00jROpDbPtqFHTVEWFho1ODrOzsm5toNtrEih2nfF26LFz7OlpppuamM5NDEAExUZfHh3zMuIfbVAgbxHcrpHh6hI0LibSUxNEBMZZFtQz7SO3baC4tG4y8LFj4aJTERHHRodExQYGh0jABQYIHpnUc+3j8G6o8S7pr2zn8jApMKlfE1EPBAVHq6Sb+e+ia2QbGhcUDIvLxUTFBcXGyAiJiQlKSIjJtnAoNvgtNguAAAAAElFTkSuQmCC')\",\n                \"backgroundSize\": \"cover\",\n                \"display\": \"block\"\n              }\n            }}></span>{`\n  `}<img parentName=\"a\" {...{\n              \"className\": \"gatsby-resp-image-image\",\n              \"alt\": \"Wynik tego, co udało mi się zrobić na froncie\",\n              \"title\": \"Wynik tego, co udało mi się zrobić na froncie\",\n              \"src\": \"/static/bcc5603e8f33c95ef6056539ab3f6276/00d43/plansza.png\",\n              \"srcSet\": [\"/static/bcc5603e8f33c95ef6056539ab3f6276/63868/plansza.png 250w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/0b533/plansza.png 500w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/00d43/plansza.png 1000w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/aa440/plansza.png 1500w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/e8950/plansza.png 2000w\", \"/static/bcc5603e8f33c95ef6056539ab3f6276/1f05d/plansza.png 2273w\"],\n              \"sizes\": \"(max-width: 1000px) 100vw, 1000px\",\n              \"style\": {\n                \"width\": \"100%\",\n                \"height\": \"100%\",\n                \"margin\": \"0\",\n                \"verticalAlign\": \"middle\",\n                \"position\": \"absolute\",\n                \"top\": \"0\",\n                \"left\": \"0\"\n              },\n              \"loading\": \"lazy\"\n            }}></img>{`\n  `}</a>{`\n    `}</span>{`\n    `}<figcaption parentName=\"figure\" {...{\n          \"className\": \"gatsby-resp-image-figcaption\"\n        }}>{`Wynik tego, co udało mi się zrobić na froncie`}</figcaption>{`\n  `}</figure></p>\n    <p>{`Mając planszę kolej przyszła na graczy -- skaczące prostopadłościany.\nZrobienie jednego gracza to bułka z masłem -- informacja do serwera, że chcę skoczyć,\n\"rzut kością\" i wysolosowanie nowej pozycji, `}<inlineCode parentName=\"p\">{`socket.emit`}</inlineCode>{` do clienta, i ustawienie pozycji. Łatwe.`}</p>\n    <p>{`Problem jednak zaczął się przy komunikacji większej ilości graczy.\nTo jest moment który mnie zdemotywował do dalszego działania.\nKtoś mógłby powiedzieć \"No przecieć to to samo co dla jednego, tylko że dla wielu\".\nW skrócie tak, to prawda. Obsługa wielu graczy różniłaby się od wersji z pojedynczym graczem tym,\nże wiadomość o skoku konkretnego gracza należałoby \"broadcastować\".`}</p>\n    <p>{`Problem w tym, że zrobienie tego nie jest takie oczywiste. Koncepcyjnie to serwer powinien móc\nwysyłać wiadomości do socketów. W zwiazku z tym, jako że broadcast nomen omen musi komunikować się ze wszystkimi,\nto umieszczenie metody `}<inlineCode parentName=\"p\">{`broadcast`}</inlineCode>{` w strukturze (albo rustowo -- w cesze(?)) kontrolera WebSocket jest racjonalne.\nCo dalej? Cóż. Programista JSa dałby zwykłą referencję w sockecie do tejze metody. W C++ dałoby radę wskaźnikiem.\nTutaj? Mhmm. Nie chcę używać `}<inlineCode parentName=\"p\">{`unsafe`}</inlineCode>{` kodu, więc pominę takie elementy.`}</p>\n    <p>{`W pierwszym podejściu wydzieliłem `}<inlineCode parentName=\"p\">{`receiver`}</inlineCode>{` ze struktury socketa i bezpośrednio jego wrzuciłem w loop obsługi zdarzeń.\nZrobiłem to dlatego, ponieważ w czasie broadcastowania iterowanie po wszystkich socketach i ich `}<inlineCode parentName=\"p\">{`lock`}</inlineCode>{`owanie\nbardzo szybko doprowadzało do `}<a parentName=\"p\" {...{\n        \"href\": \"https://pl.wikipedia.org/wiki/Zakleszczenie\"\n      }}>{`zatrzasku (deadlocka)`}</a>{` gdy odbiorca był w strukturze.\nSprawa była oczywista:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Na serwerze znajdują się 2 sockety;`}</li>\n      <li parentName=\"ol\">{`Oba są stale używane przez swój wątek, ponieważ nasłuchują zdarzenia;`}</li>\n      <li parentName=\"ol\">{`Jeden z nich chce nadać wiadomość broadcast, więc musi przechwycić `}<inlineCode parentName=\"li\">{`sender`}</inlineCode>{` drugiego;`}</li>\n      <li parentName=\"ol\">{`Operacja kończy się zakleszczeniem, ponieważ drugi nigdy nie odda socketu, a pierwszy nie odpuści oczekiwania.`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-rust\"\n      }}>{`let socket_mutex = Arc::new( Mutex::new( Socket::new( ws_stream, broadcast_adapter ) ) );\nlet mut socket = socket_mutex.lock().await;\n\nloop {\n  let msg = socket.wait_for_message().await;\n\n  ...\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-rust\"\n      }}>{`let (sink, mut stream) = ws_stream.split();\nlet socket_mutex = Arc::new( Mutex::new( Socket::new( sink, broadcast_adapter ) ) );\n\nloop {\n  let msg = stream.next().await.unwrap().unwrap();\n  let mut socket = socket_mutex.lock().await;\n\n  ...\n`}</code></pre>\n    <p>{`Wydzielając odbiorcę ze struktury socketu wyeliminowałem ten problem, lecz szybko pojawił się następny.\nNikt/nic (lekko upraszczając) nie ma wpływu na to, kiedy procesor uzna, że czas pracy wątku się skończył\ni kolej jest na następny. W związku z tym doszło do sytuacji przedstawionej na screenie poniżej:`}</p>\n    <p><figure parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-figure\",\n        \"style\": {}\n      }}>{`\n    `}<span parentName=\"figure\" {...{\n          \"className\": \"gatsby-resp-image-wrapper\",\n          \"style\": {\n            \"position\": \"relative\",\n            \"display\": \"block\",\n            \"marginLeft\": \"auto\",\n            \"marginRight\": \"auto\",\n            \"maxWidth\": \"341px\"\n          }\n        }}>{`\n      `}<a parentName=\"span\" {...{\n            \"className\": \"gatsby-resp-image-link\",\n            \"href\": \"/static/5931ce88c61ebce2128625bfe329036c/4c0ad/zakleszczenie.png\",\n            \"style\": {\n              \"display\": \"block\"\n            },\n            \"target\": \"_blank\",\n            \"rel\": \"noopener\"\n          }}>{`\n    `}<span parentName=\"a\" {...{\n              \"className\": \"gatsby-resp-image-background-image\",\n              \"style\": {\n                \"paddingBottom\": \"27.599999999999998%\",\n                \"position\": \"relative\",\n                \"bottom\": \"0\",\n                \"left\": \"0\",\n                \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABDUlEQVQY013Qb0+CUBQG8Oe2LBEQQeH+49LUoRCYICmiTm2rdKvv/3m69KK5zn47e3a2582BXIHHhKeEPxGRE3UkYQ19VCeEO4gcYXMX7oisQNk9bYf9QVCA7Vu8AT1g9AL/+VcBP4efwF/AX8KfkyDo3Tbb8qzrToUVM2eS2mk8yA2a2JPMjhNzGvfG8+4460xyzJKHOWc8+FeuUa2wqFBkSPeo9lg3qDYoG5R6V1huUZ6wqTul5CKgnN4A7bq1mR36y7f+emOkA8McGpb3aA5Nq+VYntd3R7YX2JQPNKYcqkmHChdMQbxDXiDORB4gX6E+IQvoD+kcXRFdSPRFdAiPCM9QV6gPRN+Q28cfuqsk78TusP4AAAAASUVORK5CYII=')\",\n                \"backgroundSize\": \"cover\",\n                \"display\": \"block\"\n              }\n            }}></span>{`\n  `}<img parentName=\"a\" {...{\n              \"className\": \"gatsby-resp-image-image\",\n              \"alt\": \"Przykład zakleszczenia. Jeden kolor = działania jednego socketu\",\n              \"title\": \"Przykład zakleszczenia. Jeden kolor = działania jednego socketu\",\n              \"src\": \"/static/5931ce88c61ebce2128625bfe329036c/4c0ad/zakleszczenie.png\",\n              \"srcSet\": [\"/static/5931ce88c61ebce2128625bfe329036c/63868/zakleszczenie.png 250w\", \"/static/5931ce88c61ebce2128625bfe329036c/4c0ad/zakleszczenie.png 341w\"],\n              \"sizes\": \"(max-width: 341px) 100vw, 341px\",\n              \"style\": {\n                \"width\": \"100%\",\n                \"height\": \"100%\",\n                \"margin\": \"0\",\n                \"verticalAlign\": \"middle\",\n                \"position\": \"absolute\",\n                \"top\": \"0\",\n                \"left\": \"0\"\n              },\n              \"loading\": \"lazy\"\n            }}></img>{`\n  `}</a>{`\n    `}</span>{`\n    `}<figcaption parentName=\"figure\" {...{\n          \"className\": \"gatsby-resp-image-figcaption\"\n        }}>{`Przykład zakleszczenia. Jeden kolor = działania jednego socketu`}</figcaption>{`\n  `}</figure></p>\n    <p>{`Normalnie powinien tam wystąpić jeszcze log `}<inlineCode parentName=\"p\">{`end of lock <id>`}</inlineCode>{` lecz nie wystąpił.\nW tym przypadku deadlock pojawił się w podobnej sytuacji co przed zmianami --\npo zablokowaniu dostępu do obu socketów i próbie wzajemnego dostępu do siebie.`}</p>\n    <p>{`Drugie podejście zakładało stworzenie kanału, którym mógłbym komunikować sockety\ni stworzonego specjalnie osobnego `}<inlineCode parentName=\"p\">{`taska`}</inlineCode>{` tokio którego jedynym zadaniem byłoby\nnasłuchiwanie przychodzących żądań broadcastu.\nTo sprawiłoby, że żaden socket niemiałby nic wspólnego z jakimkolwiek innym socketem.\nW założeniach brzmiało pięknie, lecz zidentyfikowałem jakiś nieznany mi błąd,\nktóry zupełnie psuł poprawne działanie. Przykra sprawa ;/`}</p>\n    <p><em parentName=\"p\">{`Dzień później`}</em><br parentName=\"p\"></br>{`\n`}{`Lekko zrezygnowany i chcący zabrać się za coś innego spróbowałem dowiedzieć się co może być nie tak.\nCo ciekawe, problem leżał w `}<inlineCode parentName=\"p\">{`block_on( self.sink.send( message ) )`}</inlineCode>{` -- blokowaniu emitera wiadomości socketu.\nTak jakby przy broadcastowaniu się nagle blokował (bo problem dotyczył tylko broadcastu).\nPrzy czym operacja dobiega końca -- wiem to, ponieważ skorzystałem z niezawodnego debugowania `}<inlineCode parentName=\"p\">{`println`}</inlineCode>{`.\nJak ten problem rozwiązałem? Bardzo słabo:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-rust\"\n      }}>{`pub fn emit( &mut self, message:&str ) {\n  let sink_clone = Arc::clone( &self.sink );\n  let message = String::from( message );\n\n  thread::spawn( move || if let Err( err ) = block_on( block_on( sink_clone.lock() ).send( message.into() ) ) {\n    println!( \"Emit error: {}\", err );\n  } );\n}\n`}</code></pre>\n    <p>{`Generalnie, to zdaję sobie sprawę z tego, że to wymaga refaktoryzacji.\nPrzy czym aby to zrobić, musiałbym najpewniej napisać serwer http od zera, bez udziału `}<inlineCode parentName=\"p\">{`hyper`}</inlineCode>{`a.\nWtedy mógłbym też zrobić nieco bardziej solidny serwer http+ws.\nBrzmi jak dobry plan, ale motywacji jakby nie za dużo (to jest jawna sugestia dla czytelników aby jakoś na mnie wpłynać).`}</p>\n    <p>{`===`}</p>\n    <p>{`Jako, że jest to mój projekt rozgrzewkowy do srodowiska, to oczywiście nie wiem czy moje rozwiązanie jest słuszne,\nlecz projektowo uznałem,`}</p>\n    <p>{`Sama gra raczej nie została przemyślana bardzo dobrze. Ot `}<strong parentName=\"p\">{`po prostu miała działać`}</strong>{`.\nDlatego też nie pokusiłem się o najlepsze wzorce, przykładowo `}<a parentName=\"p\" {...{\n        \"href\": \"https://en.wikipedia.org/wiki/Memoization\"\n      }}>{`memoizacji`}</a>{`(?)`}</p>\n    <p>{`Nie wykluczam późniejszej dalszej aktualizacji tego kodu, ponieważ myślę, ze może się on komuś przydać.\nSkoro mi się nie udało znaleźć dobrego serwera http+ws i stworzyłem go samemu, to moze ktoś także będzie poszukiwac i tym razem znajdzie ^^.\nPrzy czym zaznaczam, że kod ten wymaga sporo poprawek/usprawnień aby móc z niego swobodnie korzysać. Chociaż może pomogłaby społeczność githuba...`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}