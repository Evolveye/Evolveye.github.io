{"componentChunkName":"component---src-templates-post-js","path":"/post/2020-09-01/Biedny_panel_do_ładowania_produkcji_CactuJam","result":{"data":{"mdx":{"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"published\": true,\n  \"title\": \"Biedny panel do ładowania produkcji CactuJam\",\n  \"author\": \"Paweł Stolarski\",\n  \"date\": \"2020-09-01T00:00:00.000Z\",\n  \"categories\": [\"Małe projekty\", \"Sprawozdanie\"],\n  \"tags\": [\"JavaScript\", \"Node.js\", \"CactuJam\"],\n  \"sneakPeek\": \"\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Aside = makeShortcode(\"Aside\");\nvar Info = makeShortcode(\"Info\");\nvar Note = makeShortcode(\"Note\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Data zawod\\xF3w to 4 wrze\\u015Bnia 2020. Data posta jest taka jaka jest. A skoro na ka\\u017Cdej edycji zawod\\xF3w jest co\\u015B innego,\\nto przyjemnie by\\u0142oby t\\u0119 tradycj\\u0119 podtrzyma\\u0107. W czasie trwania oceniania prac po ostatniej rywalizacji pad\\u0142a propozycja\\naby zrobi\\u0107 stron\\u0119 do tego przeznaczon\\u0105. Ocenianie porpzez bota nie nale\\u017Cy do najwygodniejszych i to jest fakt --\\nprosze sobie wyobrazi\\u0107, \\u017Ce do oceny jest 6 u\\u017Cytkownik\\xF3w, ka\\u017Cdego trzeba oceni\\u0107 w 3 kategoriach,\\nca\\u0142o\\u015B\\u0107 odbywa si\\u0119 na interfejsie tekstowym. Dodatkowo prace sk\\u0105d\\u015B trzeba pobra\\u0107, wi\\u0119c jeszcze trzeba gdzie\\u015B klika\\u0107, co\\u015B pobiera\\u0107,\\nsprawdza\\u0107 w co gramy.\"), mdx(\"p\", null, \"Tak\\u017Ce decyzja podj\\u0119ta -- prosta (prezentujaca turpizm) strona do obs\\u0142ugiwania produkcji musi powsta\\u0107.\"), mdx(Aside, {\n    mdxType: \"Aside\"\n  }, \"Zdaj\\u0119 sobie spraw\\u0119 z tego, ze znajduje si\\u0119 tu sporo niewyja\\u015Bnionej tre\\u015Bci. Sama tre\\u015B\\u0107 pozostawia te\\u017C sporo do \\u017Cyczenia ale jak zaznaczam -- po prostu ma dzia\\u0142a\\u0107.\"), mdx(\"h2\", null, \"Strona obok bota\"), mdx(\"p\", null, \"Jako \\u017Ce system ma by\\u0107 w pe\\u0142ni zintegrowany z serwerem Discord, trzeba b\\u0119dzie wykorzystac do tego bota.\\nNajprosciej wi\\u0119c b\\u0119dzie zintegrowa\\u0107 panel z botem, kt\\xF3ry zarzadza serwerem.\"), mdx(\"p\", null, \"Pierwsza my\\u015Bl w g\\u0142owie, to otworzy\\u0107 plik, w kt\\xF3rym znajduje si\\u0119 instancja bota i napisa\\u0107 w nim podstawow\\u0105 obs\\u0142ug\\u0119 strony.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import CactuDiscordBot from \\\"./index.js\\\"\\nimport { createServer } from \\\"http\\\"\\nimport fs from \\\"fs\\\"\\n\\n// const cactuBot =\\nnew CactuDiscordBot( {\\n  prefix: `c!`,\\n  prefixSpace: true,\\n  modulesCopying: `315215466215899146`,\\n  token: ` - - - `,\\n} )\\n\\ncreateServer( (req, res) => {\\n  res.writeHead( 200, { \\\"Content-Type\\\": `text/html` } )\\n  res.end( fs.readFileSync( `./priv-index.html` ) )\\n} ).listen( 3000, `127.0.0.1`, () => console.log( `Server is listening` ) )\\n\")), mdx(Info, {\n    mdxType: \"Info\"\n  }, \"Nie jest to poradnik, chocia\\u017C m\\xF3g\\u0142y by\\u0107. Je\\u015Bli zajdzie potrzeba lub ch\\u0119\\u0107 na wyja\\u015Bnienia -- \\u015Bmia\\u0142o mo\\u017Cna zostawi\\u0107 komentarz z pro\\u015Bb\\u0105. Ch\\u0119tnie opisze to co si\\u0119 tutaj dzia\\u0142o chocia\\u017Cby linijka po linijce. Jednakowo\\u017C skoro ma\\u0142o kto odczyta te posty, to nie poczuwam zbytnio sensu rozprawia\\u0107 o tym co dok\\u0142adnie zrobi\\u0142em.\"), mdx(\"p\", null, \"Powy\\u017Cszy kod odpowiada za trzymanie bota online, oraz za wysy\\u0142anie do clienta pliku \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"priv-index.html\"), \"\\npo wej\\u015Bciu na dowoln\\u0105 podstron\\u0119 nas\\u0142uchiwanego adresu. Nast\\u0119pnym krokiem b\\u0119dzie napisanie kodu\\nodpowiedzialnego za przechwycenie od clienta pliku zip oraz wys\\u0142anie go na serwer.\"), mdx(Info, {\n    mdxType: \"Info\"\n  }, mdx(\"p\", null, \"  Je\\u015Bli nazwa pliku lub folderu zaczyna\\u0107 si\\u0119 b\\u0119dzie od \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"priv-\"), \" to oznacza\\u0107 to b\\u0119dzie, \\u017Ce znajduje si\\u0119 w g\\u0142\\xF3wnym folderze projektu (bota).\\nNie chc\\u0119 aby git wykrywa\\u0142 mi te pliki za nowododane, wi\\u0119c wykluczam je za pomoc\\u0105 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".gitignore\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-git\"\n  }), \"# .gitignore\\npriv-*\\n\"))), mdx(\"h2\", null, \"Wysy\\u0142ka\"), mdx(\"p\", null, \"Wysy\\u0142anie danych to standardowo formularz. Pole na dodanie pliku oraz guzik wysy\\u0142ajacy powinny obecnie wystarczy\\u0107.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-html\"\n  }), \"<form method=\\\"post\\\" enctype=\\\"multipart/form-data\\\">\\n  <input type=\\\"file\\\" accept=\\\".zip\\\" >\\n  <input type=\\\"submit\\\" value=\\\"Wy\\u015Blij\\\">\\n</form>\\n\")), mdx(\"p\", null, \"Wys\\u0142ane dane trzeba tez odebra\\u0107. Aby to zrobi\\u0107 zmodyfikowa\\u0142em wcze\\u015Bniej napisan\\u0105 funkcj\\u0119 odpowiedzialn\\u0105 za obs\\u0142ug\\u0119 rz\\u0105da\\u0144.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"createServer( (req, res) => {\\n  switch (req.method) {\\n    case `GET`:\\n      res.writeHead( 200, { \\\"Content-Type\\\": `text/html` } )\\n      res.end( fs.readFileSync( `./priv-index.html` ) )\\n\\n    case `POST`:\\n      if (/multipart\\\\/form-data/.test( req.headers[ `content-type` ] )) {\\n        // multipart body handler\\n      }\\n  }\\n} ).listen( 3000, `127.0.0.1`, () => console.log( `Server is listening` ) )\\n\")), mdx(\"p\", null, \"Zrobi\\u0142em prosty proste rozdzielenie obs\\u0142ugi rz\\u0105da\\u0144 na metod\\u0119 GET oraz POST.\\nNie wa\\u017Cne czego rz\\u0105da client GETem, zostanie wys\\u0142any plik .html.\\nNie wa\\u017Cne co client wy\\u015Ble POSTem, serwer spr\\xF3buje odebra\\u0107 \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://stackoverflow.com/a/19712083/13159243\"\n  }), \"multipart-body\"), \".\"), mdx(Note, {\n    mdxType: \"Note\"\n  }, \"Oczywiscie nie jest to ani dobre a tym bardziej wzorcowe podej\\u015Bcie. W tym przypadku to ma po prostu dzia\\u0142a\\u0107.\"), mdx(\"p\", null, \"Nie przytoczy\\u0142em jednak kodu odpowiedzialnego za obs\\u0142ug\\u0119 tego wielocz\\u0119\\u015Bciwoego-cia\\u0142a.\\nTroch\\u0119 dlatego, poniewa\\u017C ramka z kodem by\\u0142aby nazbyt rozla\\u0142a. G\\u0142\\xF3wnie jednak dlatego, poniewa\\u017C nie jest to tak oczywiste\\njak zwyczajne odes\\u0142anie pliku w przyk\\u0142adzie z GETem.\"), mdx(\"p\", null, \"Typ przesy\\u0142ania \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"multipart-body\"), \" oznacza, \\u017Ce dane b\\u0119d\\u0105 przesy\\u0142ane nomen omen w cz\\u0119\\u015Bciach.\\nG\\u0142\\xF3wne u\\u017Cycie tego formatu spotykane jest w formularzach, w kt\\xF3rych ma si\\u0119 do czynienia z przesy\\u0142\\u0105niem plik\\xF3w.\"), mdx(\"p\", null, \"Jak mo\\u017Cna te cz\\u0119\\u015Bci odebra\\u0107? W ca\\u0142kiem prosty spos\\xF3b. Traktuj\\u0105c rz\\u0105danie jako \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://nodejs.org/api/stream.html#stream_class_stream_readable\"\n  }), \"potok danych\"), \",\\n(oczywi\\u015Bcie m\\xF3wimy o \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"streamie\"), \", ale \\u0107wicz\\u0119 polskie odpowiedniki)\\nmamy do dyspozycji zdarzenia \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://nodejs.org/api/stream.html#stream_event_data\"\n  }), \"data\"), \" oraz \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://nodejs.org/api/stream.html#stream_event_end\"\n  }), \"end\"), \".\\nZdarzenie \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"data\"), \" b\\u0119dzie wywo\\u0142ywane za ka\\u017Cdym razem gdy otrzymamy now\\u0105 porcj\\u0119 danych, natomiest \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"end\"), \" gdy ca\\u0142y proces si\\u0119 zako\\u0144czy (nomen omen).\"), mdx(\"p\", null, \"Tak wi\\u0119c bazuj\\u0105c na tej minimalnej wiedzy mo\\u017Cna w prosty spos\\xF3b napisa\\u0107 kod kt\\xF3ry dane odbiera, zapisuje, i wy\\u015Bwietla po zako\\u0144czeniu.\\nNajpierw jednak poka\\u017Ce Ci jak mo\\u017Cesz si\\u0119 przekona\\u0107 o wielocz\\u0119\\u015Bciowo\\u015Bci rz\\u0105dania:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"if (/multipart\\\\/form-data/.test( req.headers[ `content-type` ] )) {\\n  req.on( `data`, () => console.log( `123` ) )\\n}\\n\")), mdx(\"p\", null, \"Kod powy\\u017Cej b\\u0119dzie wy\\u015Bwietla\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"123\"), \" przy ka\\u017Cdej odebranej paczce z danymi.\\nAby si\\u0119 o tym przekona\\u0107, stw\\xF3rz archiwum .zip z ma\\u0142ym plikiem tekstowym (z jednym wyrazem, przyk\\u0142adowo \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"test\"), \"),\\noraz drugie archiwum .zip a plikiem graficznym (takim kt\\xF3ry ma przynajmniej te kiladziesi\\u0105t kilobajt\\xF3w).\\nPo w\\u0142\\u0105czeniu serwera wy\\u015Blij najpierw jeden, potem drugi plik.\\nPrzy pliku tekstowym w konsoli powinno si\\u0119 wy\\u015Bwietli\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"123\"), \" tylko raz. Przy grafice przynajmniej dwa razy.\"), mdx(\"p\", null, \"Aby zobaczy\\u0107 zebrane ju\\u017C dane (w ca\\u0142o\\u015Bci jak i linia po linii) pos\\u0142uzy\\u0142em si\\u0119 tym kodem:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const body = []\\n\\nreq.on( `data`, chunk => body.push( chunk ) )\\nreq.on( `end`, () => {\\n  const buffer = Buffer.concat( body )\\n\\n  console.log( buffer.toString() )\\n\\n  for (let i=0, j=0;  i != -1;  i=j) {\\n    j = buffer.indexOf( `\\\\n`, i + 1 )\\n    console.log( `---\\\\n`, i, j, buffer.slice( i, j ).toString() )\\n  }\\n} )\\n\")), mdx(\"p\", null, \"Jednakowo\\u017C pora na plot tiwst. Samodzielna tego obs\\u0142uga by\\u0142aby zbyt czasoch\\u0142onna.\\nOczywi\\u015Bcie, przekaza\\u0142em podstawy dzia\\u0142ania. Teraz nale\\u017Ca\\u0142by wyodr\\u0119bnia\\u0107 dane przesy\\u0142\\u0105nego pliku\\ni go z tych fragment\\xF3w zbudowa\\u0107.\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://nodejs.org/en/knowledge/HTTP/servers/how-to-handle-multipart-form-data/\"\n  }), \"Kierujac si\\u0119 stron\\u0105 nodejs.org\"), \",\\nskorzystam z modu\\u0142u formidable.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"if (/multipart\\\\/form-data/.test( req.headers[ `content-type` ] )) {\\n  const form = new formidable.IncomingForm()\\n\\n  form.parse( req )\\n  form.on( `fileBegin`, (_, file) => file.path = `./priv-uploads/${file.name}` )\\n  form.on( `file`, (_, file) => console.log( `Uploaded: ${file.name}` ) )\\n\\n  res.writeHead( 200, { \\\"Content-Type\\\": `text/html` } )\\n  res.end( fs.readFileSync( `./priv-index.html` ) )\\n}\\n\")), mdx(\"p\", null, \"Kod przypomina to, co mo\\u017Cna by\\u0142o zobaczy\\u0107 przy okazji u\\u017Cywania \\\"czystych\\\" listener\\xF3w requesta.\\nTen fragment wystarczy, aby zapisa\\u0107 przes\\u0142ane pliki.\"), mdx(\"h2\", null, \"Listing\"), mdx(\"p\", null, \"Majac pliki na serwerze, mo\\u017Cnaby je by\\u0142o jeszcze w jaki\\u015B spos\\xF3b wylistowa\\u0107. jak to zrobi\\u0107?\\nC\\xF3\\u017C, najprosciej by\\u0142oby wyedytowa\\u0107 plik .html i w nim umie\\u015Bci\\u0107 dane.\\nTylko, ze robienie tego za ka\\u017Cdym razem gdy kto\\u015B otwiera stron\\u0119 to s\\u0142aby pomys\\u0142. S\\u0142aby, i \\u015Brednio wydajny.\\nZamiast tego mo\\u017Cna stworzy\\u0107 proste API, do kt\\xF3rego strona b\\u0119dzie si\\u0119 odnosi\\u0107 aby pobra\\u0107 dane o plikach.\"), mdx(\"p\", null, \"Zacz\\u0105\\u0107 wi\\u0119c nale\\u017Ca\\u0142oby od modyfikacji wcze\\u015Bniej utworzonego switcha i doda\\u0107 za GETem kolejnego switcha do obs\\u0142ugi r\\xF3\\u017Cnych podstron.\\nBrzmi strasznie zagnie\\u017Cd\\u017Cajaco. Mi by si\\u0119 to rozwi\\u0105zanie srednio podoba\\u0142o. Zrobi\\u0119 wiec inaczej. ka\\u017Cda strona b\\u0119dzie osobn\\u0105 funkcj\\u0105:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"http.createServer( (req, res) => {\\n  const url = req.url.split( `?` )[ 0 ]\\n\\n  if (!/\\\\./.test( url ) && url in pages) pages[ url ]( req, res )\\n} ).listen( 3000, `127.0.0.1`, () => console.log( `Server is listening` ) )\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const pages = {\\n  /**\\n   * @param {http.IncomingMessage} req\\n   * @param {http.ServerResponse} res\\n   */\\n  \\\"/\\\"( req, res ) {\\n    if (req.method === `GET`) {\\n        res.writeHead( 200, { \\\"Content-Type\\\": `text/html` } )\\n        res.end( fs.readFileSync( `./priv-index.html` ) )\\n    } else if (req.method === `POST`) {\\n      if (/multipart\\\\/form-data/.test( req.headers[ `content-type` ] )) {\\n        const form = new formidable.IncomingForm()\\n\\n        form.parse( req )\\n        form.on( `fileBegin`, (_, file) => file.path = `./priv-uploads/${file.name}` )\\n        form.on( `file`, (_, file) => console.log( `Uploaded: ${file.name}` ) )\\n\\n        res.writeHead( 200, { \\\"Content-Type\\\": `text/html` } )\\n        res.end( fs.readFileSync( `./priv-index.html` ) )\\n      }\\n    }\\n  },\\n\\n  /**\\n   * @param {http.IncomingMessage} req\\n   * @param {http.ServerResponse} res\\n   */\\n  \\\"/api\\\"( req, res ) {\\n    if (req.method !== `GET`) return res.end()\\n\\n    const query = new URLSearchParams( req.url.split( `?` )[ 1 ] || `` )\\n\\n    res.writeHead( 200, { \\\"Content-Type\\\": `application/json` } )\\n    res.end( `[ \\\"abc\\\" ]` )\\n\\n    console.log( query )\\n  },\\n}\\n\")), mdx(\"p\", null, mdx(\"figure\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"491px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/be4921f854c0c8b0a400b3ddb04e3e20/13566/fetch.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"36.8%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7CAAAOwgEVKEqAAAABOElEQVQozz1R7XKEIBC7V6kiAot8CFy12pm+/0ulEe/ux04WN8RkeYQQ8HMcaDlgjw4r8dgDXMxw3iLnhFYcUgqcObTqUWvD81lRVgtjZozj+KmHiMdBwfM84Sme8ooQI0Y1QXWS6sSho+o49O/DS0RBKYVpmno9lmXBQbEcPLZlRrYK4mZsT4ENCeIdcqLLKnR7uRTUcrtsrdGlg7XmI0qHgn3f8cPKKZJY6DKTpG+XJGoStSbqy8UbZ6LmjC7JGYaR3PEWPI6TDgqCM4isQIdm1vAyw4mFNveuhL33hj1RNJy7zgt721NNk8Yj0dV5/mJrBcca8Pe94qyRonyQZBGjYHa+X0ppYUShiDA6fx4DSqlchUcIV2xGttb2yNu2wzjuwwlRetQrRo/yesH3+e7f868bX4/zDwLn0nqWgVPGAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Wywoływanie APi poprzez isntrukcję funkcję fetch\",\n    \"title\": \"Wywoływanie APi poprzez isntrukcję funkcję fetch\",\n    \"src\": \"/static/be4921f854c0c8b0a400b3ddb04e3e20/13566/fetch.png\",\n    \"srcSet\": [\"/static/be4921f854c0c8b0a400b3ddb04e3e20/63868/fetch.png 250w\", \"/static/be4921f854c0c8b0a400b3ddb04e3e20/13566/fetch.png 491w\"],\n    \"sizes\": \"(max-width: 491px) 100vw, 491px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }), \"Wywo\\u0142ywanie APi poprzez isntrukcj\\u0119 funkcj\\u0119 fetch\"), \"\\n  \"), \"\\n\", mdx(\"figure\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"394px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/476ebfba6a45302201458e640650be6f/cc097/fetch_log.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"21.999999999999996%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAArUlEQVQI122Oaw6DIBCEvYPyMCIoYmJrpUnrA4XF3sDe/zRF7Y/+aPJlM5vszGzUtp334BxMo7HLAn41Zu6ffZ5lKEEYkz+Qr4ia5uoA1vU1z3b1EMzDOFVlgTqJLqWSNRM541xwgTChNCWEBk4RaX2H4AnNk3HWWgfDMBZc4EeNblJJxQqeMUaUYFWpComUwFpJKYM/2rZ31+k4Ts6wfZ7x9OCnZyd8nO4H9Fg/NsohSBp9GKIAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Logi spowodowane wywoływaniem API\",\n    \"title\": \"Logi spowodowane wywoływaniem API\",\n    \"src\": \"/static/476ebfba6a45302201458e640650be6f/cc097/fetch_log.png\",\n    \"srcSet\": [\"/static/476ebfba6a45302201458e640650be6f/63868/fetch_log.png 250w\", \"/static/476ebfba6a45302201458e640650be6f/cc097/fetch_log.png 394w\"],\n    \"sizes\": \"(max-width: 394px) 100vw, 394px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }), \"Logi spowodowane wywo\\u0142ywaniem API\"), \"\\n  \")), mdx(\"p\", null, \"Takie podejscie sprawia, \\u017Ce \\\"logika\\\" ka\\u017Cdej strony jest odseparowana, przez co zarz\\u0105dzanie proejktem jest wygodniejsze.\\nZwr\\xF3\\u0107 uwag\\u0119, \\u017Ce w takiej formie dzia\\u0142aj\\u0105 frameworki. S\\u0142ynny \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://expressjs.com/en/starter/hello-world.html\"\n  }), \"express\"), \"\\nczy \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/uNetworking/uWebSockets.js#bulb-familiar-face\"\n  }), \"uWS\"), \" u\\u017Cywaj\\u0105 sk\\u0142adni \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".metoda( <adres>, <handler> )\"), \".\\nW srodowisku Rusta taki Rocket.rs \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://rocket.rs/v0.4/overview/\"\n  }), \"u\\u017Cywa makr do\\u0142\\u0105czoanych do osobnych funkcji\"), \",\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://actix.rs/docs/getting-started/\"\n  }), \"Actix\"), \" z kolei tworzy obs\\u0142ug\\u0119 ruchu na stronach za pomoc\\u0105 konstruktor\\xF3w opartych o przekazane --\\nkto by si\\u0119 spodziewa\\u0142 -- funkcje.\"), mdx(\"p\", null, \"Maj\\u0105c ju\\u017C biedne-API napisz\\u0119 kod odpowiedzialny za odes\\u0142anie listy przes\\u0142anych plik\\xF3w. I znow\\xF3w -- my\\u015Bl wyprzedza kod.\\nOd razu do g\\u0142owy przysz\\u0142o mi u\\u017Cycie paczki \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"fs\"), \" w celu odczytania zawarto\\u015Bci folderu, oraz odes\\u0142anie do clienta\\ntablicy z nazwami odczytanych plik\\xF3w.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"// wn\\u0119trze funkcji \\\"/api\\\"\\nconst zips = fs.readdirSync( `./priv-uploads`, { encoding:`utf-8`, withFileTypes:true } )\\n  .filter( dirent => dirent.isFile() )\\n  .filter( ({ name }) => name.endsWith( `.zip` ) )\\n  .map( ({ name }) => name )\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-html\"\n  }), \"<!-- client side -->\\n<ul id=\\\"files-listing\\\"></ul>\\n\\n<script>\\n  const listingWrapper = document.querySelector( `#files-listing` )\\n\\n  fetch( `./api?files` ).then( res => res.json() ).then( files => files.forEach( file => {\\n    const li = document.createElement( `li` )\\n    const a = document.createElement( `a` )\\n\\n    a.download = true\\n    a.textContent = file\\n    a.href = `/api?getFile=${file}`\\n\\n    li.appendChild( a )\\n    listingWrapper.appendChild( li )\\n  } ) )\\n</script>\\n\")), mdx(\"p\", null, \"Jak mo\\u017Cna zauwa\\u017Cy\\u0107, listing tworza linki. A aby linki dzia\\u0142a\\u0142y, nale\\u017Cy obs\\u0142uzy\\u0107 je na serwrze.\\nDlatego te\\u017C pozostaje na koniec tej sekcji wpisu doda\\u0107 obs\\u0142ug\\u0119 zapytania \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getFile\"), \" w utworzonym API.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"if (query.has( `getFile` )) {\\n  const file = query.get( `getFile` )\\n\\n  if (fs.existsSync( `./priv-uploads/${file}` )) {\\n    res.writeHead( 200, {\\n      \\\"Content-Type\\\": `application/zip`,\\n      \\\"Content-disposition\\\": `attachment; filename=${file}`,\\n    } )\\n    res.end( fs.readFileSync( `./priv-uploads/${file}` ) )\\n  }\\n}\\n\")), mdx(\"h2\", null, \"Intagracja z Discordem\"), mdx(\"p\", null, \"Aby unikna\\u0107 zasmiecania serwera przez spemer\\xF3w, oraz aby przeprowadzi\\u0107 uczciwe g\\u0142osowanie\\nnale\\u017Cy uwierzytelni\\u0107 w jakis spos\\xF3 osoby kt\\xF3re dodaj\\u0105 pliki jak i g\\u0142osuj\\u0105.\\nSkoro zawody odbywaj\\u0105 si\\u0119 na serwerze Discord, to najpro\\u015Bciej b\\u0119dzie skorzysta\\u0107 z formy\\nautoryzacji dostarczanej przez t\\u0119 platform\\u0119.\"), mdx(\"p\", null, mdx(\"figure\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1000px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/37c994f0fe927911affb9d8a646fa993/d5b59/discord.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"72%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABlklEQVQoz3WSaW7bMBCFeSFbshau4qbNiaUEdtwazr8CvUNyiR66b0RbNQwU+DB4HHFmHkmx4+kS4l6ZqG2nG9Aa2xnb35fQlCT9L99y6QHj8VUNb2aYmjjq0CvfESQedfekuY2Aucs5fF789Ryu5+bHuzge5Gn6P3NCfRBseJmN66SJypKxBGl3F0RLGm6Vf4T5YYr7GYZr7bjxtXGEpihtVA1o0TrxXHz5/ef9+l1yUwn7RC3dE7gkimvxy/xzP33046waMpaQKS6jhA5gHQ6wvBV3w6EbJ+sHaYLUC+YGPIf+YMPY+OF2Ha4zrl8Pz7AJLwkzu0oVtSaqhCq5PX5++f4oNW29m3+8sDiibFeqtaysDaBeWNZ2+SqXJLWm5R3Wj5PQfpNV27xO5IXg0lbYV4pNVmY7vs2rWjQNPNu2rNQ2q7K8BqziBq6wYwVz8LdK7SBSBh3RzvoeMS+WZCEAEwoPYNexaTLaKRPwfikDX5ihm4iLgKZ2WbnJdgwnwRCh7BKJVIl4x6lFrJ+Kkutwal9//QVj08QiSiSCqgAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Panel OAuth2 apliakcji Discord\",\n    \"title\": \"Panel OAuth2 apliakcji Discord\",\n    \"src\": \"/static/37c994f0fe927911affb9d8a646fa993/00d43/discord.png\",\n    \"srcSet\": [\"/static/37c994f0fe927911affb9d8a646fa993/63868/discord.png 250w\", \"/static/37c994f0fe927911affb9d8a646fa993/0b533/discord.png 500w\", \"/static/37c994f0fe927911affb9d8a646fa993/00d43/discord.png 1000w\", \"/static/37c994f0fe927911affb9d8a646fa993/d5b59/discord.png 1370w\"],\n    \"sizes\": \"(max-width: 1000px) 100vw, 1000px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", _extends({\n    parentName: \"figure\"\n  }, {\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }), \"Panel OAuth2 apliakcji Discord\"), \"\\n  \")), mdx(\"p\", null, \"Ustawiaj\\u0105c w panelu adres przekierowania na localhost i wybieraj\\u0105c zakres dost\\u0119pno\\u015Bci autoryzacji\\notrzyma\\u0142em link niezb\\u0119dny do przeprowadzenia tego procesu. Majac link, pora przyst\\u0105pi\\u0107 do czytania dokuemntacji.\\nS\\u0105 w niej zawarte informacje kt\\xF3re przydadz\\u0105 si\\u0119 do napisania poprawnej komunikacji z API Discorda.\"), mdx(\"p\", null, \"Istniej\\u0105 dwa sposoby na to aby autoryzowa\\u0107 discordow\\u0105 apliakcj\\u0119 z kontem discord.\\nPierwszy z nich jest domy\\u015Blnym -- automatycznie wygenerowany na stronie link otworzy do niego furtk\\u0119.\"), mdx(\"h3\", null, \"Metoda 1: code\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const params = new URLSearchParams()\\n\\nparams.append(     `client_id`, `<id>` )\\nparams.append( `client_secret`, `<secret>` )\\nparams.append(    `grant_type`, `authorization_code` )\\nparams.append(          `code`, `<kod z URI przekierowania>` )\\nparams.append(  `redirect_uri`, `<adres przekierowania>` )\\nparams.append(         `scope`, `identify` )\\n\\nfetch( `https://discord.com/api/oauth2/token`, {\\n    method: `post`,\\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\\n    body: params\\n} ).then( res => res.json() ).then( console.log )\\n\")), mdx(\"p\", null, \"Napisany powy\\u017Cej kod ustanawia po\\u0142aczenie z API i wy\\u015Bwietla otrzymana odpowied\\u017A.\\nJe\\u015Bli wszystko zosta\\u0142o przeprowadzone poprawnie, to powinien ukazac si\\u0119 obiekt JSON\\nzgodny z tym co mo\\u017Cna zobaczy\\u0107 \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://discord.com/developers/docs/topics/oauth2#authorization-code-grant-access-token-response\"\n  }), \"w dokumentacji\"), \".\"), mdx(\"h3\", null, \"Metoda 2: token\"), mdx(\"p\", null, \"Korzystajac z drugiej emtody nie trzeba martwi\\u0107 si\\u0119 zupe\\u0142nie o komunikaj\\u0107e z API. Wystarczy sam link, kt\\xF3ry domy\\u015Blnie wyglada tak:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"https://discord.com/api/oauth2/authorize?client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPES\\n\")), mdx(\"p\", null, \"W powy\\u017Cszym linki nie podmieni\\u0142em na \\\"zmienn\\u0105\\\" tylko jednej pozycji -- response_type.\\nW domy\\u015Blnej wersji wygl\\u0105da jak wyglada. Warto\\u015B\\u0107 tego typu jest r\\xF3wna \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"code\"), \".\\nAby skorzysta\\u0107 ze skr\\xF3conej wersji autoryzowania aplikacji nale\\u017Cy zmieni\\u0107 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"code\"), \" na \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"token\"), \". Nowy adres b\\u0119dzie wi\\u0119c wygl\\u0105da\\u0107 tak:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"https://discord.com/api/oauth2/authorize?client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&response_type=token&scope=SCOPES\\n\")), mdx(\"p\", null, \"Autoryzuj\\u0105c apliakcj\\u0119 t\\u0105 metod\\u0105 wszystkie dane kt\\xF3re normalnie zosta\\u0142yby nam przes\\u0142ane w odpowiedzi funkcji fetch,\\npowinny znale\\u017A\\u0107 si\\u0119 w adresie przegladarki. Prosze zwr\\xF3ci\\u0107 uwage na to, \\u017Ce nie jest to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"query\"), \" a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"hash\"), \".\"), mdx(\"h3\", null, \"Zidentyfikowane po\\u0142\\u0105czenie\"), mdx(\"p\", null, \"M\\xF3g\\u0142ym skorzysta\\u0107 z drugiej metody z racji tego, ze jest prostsza w u\\u017Cyciu, lecz to implikuje bardzo du\\u017C\\u0105 podatno\\u015B\\u0107 na\\nnieporzadanie \\u015Bmieszki -- wszystkie dane identyfikujace by\\u0142yby po stronie clienta, wiec \\u0142atwo by\\u0142oby si\\u0119 pod kogo\\u015B podszy\\u0107.\\nDlatego w\\u0142a\\u015Bnie lepsz\\u0105 metod\\u0105 b\\u0119dzie metoda pierwsza.\"), mdx(\"p\", null, \"Je\\u015Bli client nie zostanie zidentyfikowany po wejsciu na stron\\u0119, b\\u0119dzie musia\\u0142 zosta\\u0107 poproszony o autoryzacj\\u0119.\\nPo autoryzacji otrzymany kod z adresu serwer b\\u0119die m\\xF3g\\u0142 odebra\\u0107 i wymiani\\u0107 informacje z APi Discorda.\\nPo tej czynno\\u015Bci serwer b\\u0119dzie m\\xF3g\\u0142 odes\\u0142\\u0105\\u0107 potrzebne dane -- te, kt\\xF3re odes\\u0142a\\u0142by gdyby client zosta\\u0142 rozpoznany zaraz\\npo wej\\u015Bciu na stron\\u0119.\"), mdx(\"p\", null, \"Po kod w tym zakresie odsy\\u0142am Ci\\u0119 do swojego \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://discordjs.guide/oauth2/#oauth2-flows\"\n  }), \"\\u017Ar\\xF3d\\u0142a\")), mdx(\"p\", null, \"W tym przypadku, jako ze projekt jest klejony na szybko i ma \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"po prostu dzia\\u0142\\u0105\\u0107\"), \" kod zostanie przes\\u0142any za pomoc\\u0105 fetcha\\ni GETa do api. To ode\\u015Ble potrzebne do wy\\u015Bwietlenia dane.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-html\"\n  }), \"<a class=\\\"authorize_link\\\" href=\\\"<d\\u0142uga\\u015Bny link>\\\">\\n  Autoryzuj bota\\n</a>\\n\\n<div class=\\\"infobox\\\" style=\\\"display:none\\\">\\n  <p class=\\\"infobox-discord_user\\\"></p>\\n\\n  <button\\n    onclick=\\\"localStorage.removeItem( `discordUserInfo` ); window.location.reload()\\\"\\n  >Wyloguj</button>\\n\\n  <form method=\\\"post\\\" enctype=\\\"multipart/form-data\\\">\\n    <input name=\\\"token\\\" type=\\\"hidden\\\" >\\n    <input name=\\\"file\\\" type=\\\"file\\\" >\\n    <input type=\\\"submit\\\" value=\\\"Wy\\u015Blij\\\">\\n  </form>\\n</div>\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const discordUserInfo = localStorage.getItem( `discordUserInfo` )\\nconst nodes = {\\n  infobox: document.querySelector( `.infobox` ),\\n  authorizeLink: document.querySelector( `.authorize_link` ),\\n  discordUser: document.querySelector( `.infobox-discord_user` ),\\n  tokenInput: document.querySelector( `input[name=\\\"token\\\"]` ),\\n}\\n\\n// (...)\\n\\nif (discordUserInfo) {\\n  let parsedDiscordUserInfo = null\\n\\n  try {\\n    parsedDiscordUserInfo = JSON.parse( discordUserInfo )\\n  } catch (err) {\\n    console.log( err )\\n    nodes.discordUser.textContent = `Wyst\\u0105pi\\u0142 b\\u0142\\u0105d. Prosz\\u0119, autoryzuj aplikacj\\u0119 ponownie`\\n    localStorage.removeItem( `discordUserInfo` )\\n  }\\n\\n  if (parsedDiscordUserInfo) {\\n    const { username, discriminator } = parsedDiscordUserInfo\\n\\n    nodes.discordUser.textContent = `Witaj ${username}#${discriminator}`\\n    nodes.authorizeLink.style.display = `none`\\n    nodes.infobox.style.display = `block`\\n    nodes.tokenInput.value = secret\\n  }\\n} else if (searchParams.has( `code` )) {\\n  fetch(`/api?discordAuthCode=${searchParams.get( `code` )}`)\\n    .then( res => res.text() )\\n    .then( json => localStorage.setItem( `discordUserInfo`, json ) )\\n    .then( () => window.location.href = `/` )\\n    .catch( console.error )\\n}\\n\")), mdx(\"p\", null, \"Dodatkowo warto nadmieni\\u0107, \\u017Ce gdyby przesy\\u0142\\u0105nie plik\\xF3w zosta\\u0142o takie jakie jest, to ka\\u017Cdy tak na prawd\\u0119 m\\xF3g\\u0142y\\nwysy\\u0142a\\u0107 ich nieograniczon\\u0105 ilo\\u015B\\u0107. Dlatego te\\u017C, trzeba zasymulowa\\u0107 co\\u015B typu sesja.\\nDo tego celu po stronie serwera postanowi\\u0142em wygenerowa\\u0107 pseudolosowy ciag liczb i doda\\u0107 go do obiektu clienta\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"response = await fetch( `https://discordapp.com/api/users/@me`, {\\n  headers: { authorization: `${discordResponse.token_type} ${discordResponse.access_token}` }\\n} ).then( res => res.json() ).catch( console.error )\\n\\nresponse.secret = `${Math.random()}`.slice( 2 )\\nresponse = JSON.stringify( response )\\n\")), mdx(\"p\", null, \"Powy\\u017Csze pole z sekretem zosta\\u0142o juz uwzglednione w wyzej przedstawionym listingu kodu.\"), mdx(\"h2\", null, \"Podpisane pliki\"), mdx(\"p\", null, \"Ka\\u017Cda paczka powinna by\\u0107 w jaki\\u015B spos\\xF3b naznaczona autorem (a by\\u0107 moze w przysz\\u0142osci takze czym\\u015B innym).\\nW zwi\\u0105zku z tym ka\\u017Cd\\u0105 prac\\u0119 m\\xF3g\\u0142ym przechowywa\\u0107 w osobnym folderze wraz z dodatkowymi plikami --\\nprzyk\\u0142adowo \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".json\"), \"em przechowujacym metadane. Meta- poniewa\\u017C b\\u0119d\\u0105 to dane o przes\\u0142anych danych.\"), mdx(\"p\", null, \"Aby to uczyni\\u0107, po stronie serwera trzeba zacz\\u0105\\u0107 przechowywa\\u0107 u\\u017Cytkownik\\xF3w.\\nSkoro opieram si\\u0119 o identyfikatorze u\\u017Cytkownika Discord, to najpro\\u015Bciej b\\u0119dzie gdy jego informacje\\nzostan\\u0105 zapisane po ID. Tylko je\\u015Bli z serwer komunikuje si\\u0119 z clientem poprzez sekret, to moze lepiej po tym\\u017Ce kluczu?\\nNajpro\\u015Bciej b\\u0119dzie przechowywa\\u0107 ca\\u0142\\u0119 te obiekty w tablicy. W razie konieczno\\u015Bci przeszuka\\u0107 tablic\\u0119 po polu obiektu,\\nkt\\xF3re pos\\u0142uzy wtedy za filtr.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const clients = JSON.parse( fs.readFileSync( `./priv-clients.json` ) )\\n\\n// (...)\\n\\nresponse.secret = `${Math.random()}`.slice( 2 )\\n\\nlet clientIndex = clients.indexOf( ({ id }) => id === response.id )\\nif (clientIndex != -1) clients.slice( clientIndex, clientIndex + 1 )\\nclients.push( response )\\nfs.writeFile( `./priv-clients.json`, JSON.stringify( clients ), () => {} )\\n\\nresponse = JSON.stringify( response )\\n\")), mdx(\"p\", null, \"Nast\\u0119pnym krokiem jest zmodyfikowanie kodu odpowiadajacego za zapis pliku.\\nWst\\u0119pnie postanowi\\u0142em wy\\u015Bwietli\\u0107 pola formularza kt\\xF3re odbiera serwer i bez mojego zaskoczenia zobaczy\\u0142em token\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"{ \\\"token\\\": \\\"6507342250350916\\\" }\\n\")), mdx(\"p\", null, \"W kwestii zapisywania plik\\xF3w pozosta\\u0142o ju\\u017C tylko zmodyfikowa\\u0107 uploader:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"new formidable.IncomingForm().parse( req, (_, fields, files) => {\\n  const file = files.file\\n  const clientObj = clients.find( ({ secret }) => secret == fields.token )\\n\\n  if (!clientObj) return\\n\\n  const clientPath = `./priv-uploads/${clientObj.id}`\\n\\n  if (!fs.existsSync( clientPath )) fs.mkdirSync( clientPath )\\n\\n  fs.writeFileSync( `${clientPath}/meta.json`, JSON.stringify( clientObj ) )\\n  fs.renameSync( file.path, `${clientPath}/file.${file.name.split( `.` ).slice( -1 )}` )\\n} )\\n\")), mdx(\"p\", null, \"a w listowaniu brakuje jeszcze, c\\xF3\\u017C, podpisanych paczek\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"if (query.has( `files` )) {\\n  res.writeHead( 200, { \\\"Content-Type\\\": `application/json` } )\\n\\n  const folders = fs.readdirSync( `./priv-uploads`, { encoding:`utf-8`, withFileTypes:true } )\\n    .filter( dirent => !dirent.isFile() )\\n    .map( ({ name }) => name )\\n\\n  const data = folders.map( name => {\\n    const { username, id } = JSON.parse( fs.readFileSync( `./priv-uploads/${name}/meta.json` ) )\\n\\n    return { username, id }\\n  } )\\n\\n  res.end( JSON.stringify( data ) )\\n} else if (query.has( `getFile` )) {\\n  const id = query.get( `getFile` )\\n\\n  if (fs.existsSync( `./priv-uploads/${id}` )) {\\n    res.writeHead( 200, {\\n      \\\"Content-Type\\\": `application/zip`,\\n      \\\"Content-disposition\\\": `attachment; filename=file.zip`,\\n    } )\\n    res.end( fs.readFileSync( `./priv-uploads/${id}/file.zip` ) )\\n  }\\n}\\n\")), mdx(\"h2\", null, \"Podsumowanie\"), mdx(\"p\", null, \"Loader w wersji ubogiej dzia\\u0142a. Mam tylko nadziej\\u0119, ze b\\u0119dzie dzia\\u0142\\u0105\\u0107 na zawodach,\\ngdy ca\\u0142os\\u0107 b\\u0119dzie obs\\u0142ugiwana przez r\\xF3zne osoby. W przysz\\u0142o\\u015Bci b\\u0119dzie trzeba oczywi\\u015Bcie usprawni\\u0107\\nstron\\u0119 wizualn\\u0105 -- zar\\xF3wno prezencji formularza, jak i samego kodu, kt\\xF3ry \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"po prostu ma dzia\\u0142\\u0105\\u0107\"), \".\"), mdx(\"p\", null, \"Tak oto, po wielu nieopisanych i powyrywanych z kontekstu blokach kodu dobrn\\u0119li\\u015Bmy do ko\\u0144ca.\\nZar\\xF3wno ja -- pisz\\u0105c zar\\xF3wno ten wpis jak i ko\\u0144cz\\u0105c sw\\xF3j biedny projekt --\\noraz Ty -- czytaj\\u0105c efekt mojej pracy. By\\u0107 mog\\u0142o si\\u0119 te\\u017C tak zda\\u017Cy\\u0107, prze przewin\\u0105\\u0142e\\u015B\\nca\\u0142y post i czytasz tylko to zako\\u0144czenie. Bez wzgl\\u0119du na to -- wiedz, \\u017Ce jest mi mi\\u0142o,\\n\\u017Ce w og\\xF3le tutaj zajrza\\u0142e\\u015B. \\u015Al\\u0119 rewerencje czytelniku :wave:\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"Biedny panel do ładowania produkcji CactuJam","author":"Paweł Stolarski","date":"01-09-2020","categories":["Małe projekty","Sprawozdanie"],"tags":["JavaScript","Node.js","CactuJam"]}}},"pageContext":{"slug":"/2020-09-01/Biedny_panel_do_ładowania_produkcji_CactuJam","previous":{"fields":{"slug":"/2020-08-07/Jednym_commitem_pisząc-Reinventing_the_wheel_again"},"frontmatter":{"title":"Jednym commitem pisząc: Reinventing the wheel again","tags":["blog"],"categories":["Rozmaitości"]}},"next":null}},"staticQueryHashes":["2407117678","63159454"]}